<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.8.1: http://docutils.sourceforge.net/" />
<title></title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7056 2011-06-17 10:50:48Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<p><a class="reference external" href="index.ca.html">Inici</a> :  Guia avançada de Bash-Scripting</p>
<p><a class="reference external" href="external.ca.html">Amunt</a> : Capítol 10. Manipulació de variables</p>
<p><a class="reference external" href="string-manipulation.html">Anterior</a> : Manipulació de strings</p>
<p><a class="reference external" href="loops.ca.html">Següent</a> : Bucles i branques</p>
<hr class="docutils" />
<div class="section" id="substitucio-de-parametres">
<h1>10.2. Substitució de paràmetres</h1>
<p><strong>Manipulació i/o expansió de variables</strong></p>
<p><tt class="docutils literal">${parametre}</tt></p>
<blockquote>
<p>El mateix que <tt class="docutils literal">$parametre</tt>, És a dir, el valor de la variable
<tt class="docutils literal">parametre</tt>. En certs contextos, només funciona la forma menys
ambigua de <tt class="docutils literal">${parametre}</tt>.</p>
<p>Es pot utilitzar per concatenar variables amb strings.</p>
<pre class="literal-block">
el_teu_id=${USER}-a-${HOSTNAME}
echo &quot;$el_teu_id&quot;
#
echo &quot;Antic \$PATH = $PATH&quot;
PATH=${PATH}:/opt/bin  # Afegeix /opt/bin a $PATH durant l'execució del script.
echo &quot;Nou \$PATH = $PATH&quot;
</pre>
</blockquote>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">${parametre-perdefecte}</span></tt>, <tt class="docutils literal"><span class="pre">${parametre:-perdefecte}</span></tt></dt>
<dd><p class="first">En cas que el paràmetre no estigui assignat, es fa servir el valor
per defecte.</p>
<pre class="literal-block">
var1=1
var2=2
# var3 no està assignada.

echo ${var1-$var2}   # 1
echo ${var3-$var2}   # 2
#           ^          Atenció al prefix $.



echo ${username-`whoami`}
# Mostra el resultat de `whoami` si la variable $username no està assignada.
</pre>
<p><em>Atenció</em>: <tt class="docutils literal"><span class="pre">${parametre-perdefecte}</span></tt> i
<tt class="docutils literal"><span class="pre">${parametre:-perdefecte}</span></tt> són pràcticament equivalents. Els :
extra només tenen sentit quan <tt class="docutils literal">parametre</tt> està declarat però té
assignat nul.</p>
<pre class="literal-block">
#!/bin/bash
# param-sub.sh

#  El fet que una variable estigui o no declarada
#+ suposa l'activació de l'opció per defecte
#+ fins i tot quan el valor és nul.

username0=
echo &quot;username0 està declarat però té assignat el valor nul.&quot;
echo &quot;username0 = ${username0-`whoami`}&quot;
# No mostrarà res.

echo

echo username1 no està declarat.
echo &quot;username1 = ${username1-`whoami`}&quot;
# Mostra el valor per defecte (resultat de whoami).

username2=
echo &quot;username2 està declarat però té assignat nul.&quot;
echo &quot;username2 = ${username2:-`whoami`}&quot;
#                            ^
# Mostra el valor per defecte donat que hem posat a la condició :- en comptes de un simple - .
# Compara amb la primera instància, per sobre.


#

# Un cop més:

variable=
# variable està declarada però assignada a nul.

echo &quot;${variable-0}&quot;    # (sense sortida)
echo &quot;${variable:-1}&quot;   # 1
#               ^

unset variable

echo &quot;${variable-2}&quot;    # 2
echo &quot;${variable:-3}&quot;   # 3

exit 0
</pre>
<p>Aquesta funcionalitat de <em>paràmetre per defecte</em> és útil quan cal
definir paràmetres &quot;no indicats&quot; a la línia de comandes de la crida
al script.</p>
<pre class="literal-block">
DEFAULT_FILENAME=generic.data
filename=${1:-$DEFAULT_FILENAME}
#  En cas que no s'indiqui el contrari, les comandes al següent bloc actuen
#+ sobre el fitxer &quot;generic.data&quot;.
#  Inici del bloc de comandes
#  ...
#  ...
#  ...
#  Final del bloc de comandes



#  De l'exemple &quot;hanoi2.bash&quot;:
DISKS=${1:-E_NOPARAM}   # Cal especificar el nombre de discos.
#  Assigna $DISKS al paràmetre de línia de comanda $1,
#+ o bé a $E_NOPARAM en cas que $1 no estigui especificat.
</pre>
<p>Mira també <a class="reference external" href="http://tldp.org/LDP/abs/html/special-chars.html#EX58">Exemple
3-4</a>,
<a class="reference external" href="http://tldp.org/LDP/abs/html/zeros.html#EX73">Exemple 30-2</a>, i
<a class="reference external" href="http://tldp.org/LDP/abs/html/contributed-scripts.html#COLLATZ">Exemple
A-6</a>.</p>
<p class="last">Compara aquest mètode amb l'<a class="reference external" href="http://tldp.org/LDP/abs/html/list-cons.html#ANDDEFAULT">ús d'una*llista &quot;and&quot;* per a suplir un
argument de línia de comandes per
defecte</a>.</p>
</dd>
</dl>
<p><tt class="docutils literal">${parametre=perdefecte}</tt>, <tt class="docutils literal"><span class="pre">${parametre:=perdefecte}</span></tt></p>
<blockquote>
<p>En cas que el paràmetre no estigui assignat, assigna'l a
<em>perdefecte</em>.</p>
<p>Les dues formes són pràcticament equivalents. El funcionament amb
els : només es diferencia quan <tt class="docutils literal">$parametre</tt> està declarat i
assignat a nul <a class="footnote-reference" href="#id2" id="id1">[1]</a> com passava més amunt.</p>
<pre class="literal-block">
echo ${var=abc}   # abc
echo ${var=xyz}   # abc
# $var ja se li a assignat abc i per tant no canvia.
</pre>
</blockquote>
<dl class="docutils">
<dt><tt class="docutils literal">${parametre+altre_valor}</tt>, <tt class="docutils literal"><span class="pre">${parametre:+altre_valor}</span></tt></dt>
<dd><p class="first">Si el paràmetre està assignat, canvia el valor a <tt class="docutils literal">altre_valor</tt>,
altrament fes servir el string nul.</p>
<p>Les dues formes són pràcticament equivalents. El funcionament amb
els : només es diferencia quan <tt class="docutils literal">parametre</tt> està declarat i
assignat a nul (mira més amunt).</p>
<pre class="last literal-block">
echo &quot;###### \${parametre+altre_valor} ########&quot;
echo

a=${param1+xyz}
echo &quot;a = $a&quot;      # a =

param2=
a=${param2+xyz}
echo &quot;a = $a&quot;      # a = xyz
&lt;t0&gt;&lt;b1&gt;${parameter=default}&lt;/b1&gt;&lt;/t0&gt;, &lt;t2&gt;&lt;b3&gt;${parameter:=default}&lt;/b3&gt;&lt;/t2&gt;
&lt;t0&gt;&lt;b1&gt;${parametre=perdefecte}&lt;/b1&gt;&lt;/t0&gt;, &lt;t2&gt;&lt;b3&gt;${parametre:=perdefecte}&lt;/b3&gt;&lt;/t2&gt;
(50%, 50%, 82%)


param3=123
a=${param3+xyz}
echo &quot;a = $a&quot;      # a = xyz

echo
echo &quot;###### \${parametre:+altre_valor} ########&quot;
echo

a=${param4:+xyz}
echo &quot;a = $a&quot;      # a =

param5=
a=${param5:+xyz}
echo &quot;a = $a&quot;      # a =
# Resultat diferent de a=${param5+xyz}

param6=123
a=${param6:+xyz}
echo &quot;a = $a&quot;      # a = xyz
</pre>
</dd>
<dt><tt class="docutils literal"><span class="pre">${parametre?msg_err}</span></tt>, <tt class="docutils literal"><span class="pre">${parametre:?msg_err}</span></tt></dt>
<dd><p class="first">Si el paràmetre està assignat fes servir el seu valor, altrament
mostra el missatge msg_err i finalitza l'execució del script amb
<a class="reference external" href="exit-status.ca.html">valor de sortida</a> 1.</p>
<p class="last">Les dues formes són pràcticament equivalents. El funcionament amb
els : només es diferencia quan <tt class="docutils literal">$parametre</tt> està declarat i
assignat a nul com passava més amunt.</p>
</dd>
</dl>
<p><strong>Exemple 10-7. Ús de la substitució de paràmetres i els missatges
d'error</strong></p>
<pre class="literal-block">
#!/bin/bash

#  Comprovació d'algunes variables d'entorn del sistema.
#  És una bona pràctica de manteniment preventiu.
#  Si, per exemple, la variable d'entorn $USER (el nom de la persona logada a la consola), no està assignada,
#+ la màquina no et podrà reconèixer!.

: ${HOSTNAME?} ${USER?} ${HOME?} ${MAIL?}
  echo
  echo &quot;El nom de la màquina és $HOSTNAME.&quot;
  echo &quot;Tu ets $USER.&quot;
  echo &quot;El teu directori d'inici és $HOME.&quot;
  echo &quot;La teva carpeta d'entrada de correu es troba a $MAIL.&quot;
  echo
  echo &quot;Si pots llegir aquest missatge, &quot;
  echo &quot;vol dir que les variables d'entorn crítiques estan definides.&quot;
  echo
  echo

# ------------------------------------------------------

#  L'expressió ${variablename?} també pot consultar
#+ si una variable està assignada dins el script.

AquestaVar=Valor-daquesta-var
#  Fixat, per cert, que una variable pot ser assignada
#+ a strings amb caràcters que no estan permesos en el seu nom.
: ${AquestaVar?}
echo &quot;El valor de AquestaVar és $AquestaVar&quot;.

echo; echo


: ${ZZXy23AB?&quot;ZZXy23AB no està assignada.&quot;}
#  Donat que ZZXy23AB no està assignada,
#+ el script finalitza amb un missatge d'error.

# Es pot especificar el missatge d'error.
# : ${nomvariable?&quot;MISSATGE D'ERROR&quot;}


# El mateix resultat que amb:   altravariable=${ZZXy23AB?}
#                     altravariable=${ZZXy23AB?&quot;ZXy23AB no està assignada.&quot;}
#
#                     echo ${ZZXy23AB?} &gt;/dev/null

#  Compara aquests mètodes de comprovar si una variable ha estat assignada
#+ amb &quot;set -u&quot; . . .



echo &quot;Aquest missatge no es mostrarà perquè hores d'ara el script ja haurà terminat.&quot;

HERE=0
exit $HERE   # NO finalitzarà aquí!.

# De fet, el script retornarà 1 com a resultat d'execució (echo $?).
</pre>
<p><strong>Exemple 10-8. Ús de la substitució de paràmetres i els missatges
d'&quot;informació&quot;</strong></p>
<pre class="literal-block">
#!/bin/bash
# usage-message.sh

: ${1?&quot;Ús: $0 ARGUMENT&quot;}
#  El script finalitza aquí si falta el 1er paràmetre de línia de comandes.
#+ Mostrarà el següent missatge d'error:
#    usage-message.sh: 1: Ús: usage-message.sh ARGUMENT

echo &quot;Aquestes dues línies només s'executaran si s'ha especificat el paràmetre per línia de comandes.&quot;
echo &quot;Paràmetre de línia de comanda = \&quot;$1\&quot;&quot;

exit 0  # Finalitzarà aquí només si s'ha especificar el primer paràmetre per línia de comandes.

# Pots comprovar el resultat de sortida tant passant-li el primer paràmetre per línia de comandes com no.
# Si li passes el paràmetre, &quot;$?&quot; serà 0.
# En cas contrari, &quot;$?&quot; serà 1.
</pre>
<p><strong>Ús de la substitució de paràmetres i/o l'expansió.**Les expressions
següents complementen les operacions de strings que consideren la
**coincidència</strong> <tt class="docutils literal">amb</tt> <strong>expressió</strong> (mira l'<a class="reference external" href="http://tldp.org/LDP/abs/html/moreadv.html#EX45">Exemple
16-9</a>). Aquestes en
concret es fan servir majoritàriament en l'anàlisi de camins (path)
d'arxius.</p>
<p><strong>Longitud de variables / Eliminació de substrings</strong></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">${#var}</span></tt></dt>
<dd><p class="first"><tt class="docutils literal">Longitud del string</tt> (nombre de caràcters a <tt class="docutils literal">$var</tt>). Per a un
<a class="reference external" href="http://tldp.org/LDP/abs/html/arrays.html#ARRAYREF">array</a>,
<strong>${#array}</strong> correspon a la longitud del primer element de l'array.</p>
<p>Excepcions:</p>
<ul class="simple">
<li><strong>${#*}</strong> i <strong>${#&#64;}</strong> retornen el <em>nombre de paràmetres</em>.</li>
<li>En cas d'array, <strong>${#array[*]}</strong> i <strong>${#array[&#64;]}</strong> retornen el
nombre d'elements que conté l'array.</li>
</ul>
<p><strong>Exemple 10-9. Durada d'una variable</strong></p>
<pre class="last literal-block">
#!/bin/bash
# length.sh

E_NO_ARGS=65

if [ $# -eq 0 ]  # Per a aquesta demo cal que hi hagi arguments a la línia de comandes.
then
  echo &quot;Crideu aquest script amb un o més arguments.&quot;
  exit $E_NO_ARGS
fi

var01=abcdEFGH28ij
echo &quot;var01 = ${var01}&quot;
echo &quot;Longitud de var01 = ${#var01}&quot;
# Intentem-ho ara amb un espai entre els caràcters.
var02=&quot;abcd EFGH28ij&quot;
echo &quot;var02 = ${var02}&quot;
echo &quot;Longitud de var02 = ${#var02}&quot;

echo &quot;Nombre d'arguments de línia de comandes passats al script = ${#&#64;}&quot;
echo &quot;Nombre d'arguments de línia de comandes passats al script = ${#*}&quot;

exit 0
</pre>
</dd>
</dl>
<p><tt class="docutils literal">${var#Patró}</tt>, <tt class="docutils literal"><span class="pre">${var##Patró}</span></tt></p>
<blockquote>
<p><strong>${var#Patró}</strong> Elimina de <tt class="docutils literal">$var</tt> la part <em>més curta</em> del patró
que coincideixi <tt class="docutils literal">des de l'inici</tt> amb el contingut de <tt class="docutils literal">$var</tt>.
NdT. No he pogut comprovar aquest funcionament. A les meves proves,
${var#patró} elimina la cadena &quot;Patró&quot; de l'inici de $var en cas que
coincideixi perfectament.</p>
<p><strong>${var##Patríó}</strong> Elimina de <tt class="docutils literal">$var</tt> la part <em>més llarga</em> de
<tt class="docutils literal">$Patró</tt> que coincideixi <tt class="docutils literal">des de l'inici</tt> amb el contingut de
<tt class="docutils literal">$var</tt>. NdT. No he pogut comprovar aquest funcionament. A les
meves proves, ${var##Patró} es comporta idènticament a ${var#Patró}
excepte en el cas que s'afegeixi el caràcter *. Ex. ${var#*Patró}
no sempre resulta igual a ${var##*Patró}.</p>
<p>Veiem un exemple d'ús a l'<a class="reference external" href="http://tldp.org/LDP/abs/html/contributed-scripts.html#DAYSBETWEEN">Exemple
A-7</a>:</p>
<pre class="literal-block">
# Una funció de l'exemple &quot;days-between.sh&quot;.
# Elimina els zeros inicials de l'argument.

strip_leading_zero () #  Elimina un possible zero inicial
{                     #+ del paràmetre.
  return=${1#0}       #  El &quot;1&quot; correspon al argument &quot;$1&quot;.
}                     #  El &quot;0&quot; és el que volem eliminar de &quot;$1&quot;.
</pre>
<p>Una versió de Manfred Schwarb amb una variació més elaborada de
l'anterior:</p>
<pre class="literal-block">
strip_leading_zero2 () # Elimina els possibles zeros inicials de manera que
{                      # Bash no els interpreti com a valors en octal.
  shopt -s extglob     # Activa l'expansió (globbing) estesa.
  local val=${1##+(0)} # Guarda a la variable local val el resultat d'eliminar els 0's inicials.
  shopt -u extglob     # Desactiva l'expansió estesa.
  _strip_leading_zero2=${val:-0}
                       # En cas que l'entrada fos 0, retorna un 0 en comptes de &quot;&quot;.
}
</pre>
<p>Un altre exemple d'ús:</p>
<pre class="literal-block">
echo `basename $PWD`        # Nom del directori de treball actual (incloent el camí absolut).
echo &quot;${PWD##*/}&quot;           # Nom del directori de treball actual (només el nom)
echo
echo `basename $0`          # Nom del script.
echo $0                     # Nom del script.
echo &quot;${0##*/}&quot;             # Nom del script.
echo
nomfitxer=test.data
echo &quot;${nomfitxer##*.}&quot;      # dades
                            # Extensió del fitxer nomfitxer.
</pre>
</blockquote>
<p><tt class="docutils literal">${var%Pattern}</tt>, <tt class="docutils literal"><span class="pre">${var%%Pattern}</span></tt></p>
<blockquote>
<p><strong>${var%Pattern}</strong> elimina de <tt class="docutils literal">$var</tt> la part <em>més curta</em> del patró
<tt class="docutils literal">$Pattern</tt> que coincideixi amb la <tt class="docutils literal">part final</tt> de <tt class="docutils literal">$var</tt>.</p>
<p><strong>${var%%Pattern}</strong> elimina de <tt class="docutils literal">$var</tt> la part <em>més llarga</em> de
<tt class="docutils literal">$Pattern</tt> que coincideixi amb la <tt class="docutils literal">part final</tt> de <tt class="docutils literal">$var</tt>.</p>
</blockquote>
<p>La <a class="reference external" href="http://tldp.org/LDP/abs/html/bashver2.html#BASH2REF">versió 2</a> de
Bash va afegir noves opcions.</p>
<p><strong>Exemple 10-10. Patrons a la substitució de paràmetres</strong></p>
<pre class="literal-block">
#!/bin/bash
# patt-matching.sh

# Patrons fent servir els operadors de substitució de paràmetres  # ## % %% .

var1=abcd12345abc6789
pattern1=a*c  # * (comodí) coincideix amb qualsevol cosa entre a - c.

echo
echo &quot;var1 = $var1&quot;           # abcd12345abc6789
echo &quot;var1 = ${var1}&quot;         # abcd12345abc6789
                              # (forma alternativa)
echo &quot;Nombre de caràcters en ${var1} = ${#var1}&quot;
echo

echo &quot;pattern1 = $pattern1&quot;   # a*c  (qualsevol cosa entre 'a' i 'c')
echo &quot;--------------&quot;
echo '${var1#$pattern1}  =' &quot;${var1#$pattern1}&quot;    #         d12345abc6789
# La coincidència més curta possible. Elimina els tres primers caràcters abcd12345abc6789 (NdT. No l'he pogut replicar)
#                                     ^^^^^               |-|
echo '${var1##$pattern1} =' &quot;${var1##$pattern1}&quot;   #                  6789
# La coincidència més llarga possible. Elimina els primers 12 caràcters abcd12345abc6789 (NdT. No l'he pogut replicar)
#                                    ^^^^^                |----------|

echo; echo; echo

pattern2=b*9            # qualsevol cosa entre 'b' i '9'
echo &quot;var1 = $var1&quot;     # es manté abcd12345abc6789
echo
echo &quot;pattern2 = $pattern2&quot;
echo &quot;--------------&quot;
echo '${var1%pattern2}  =' &quot;${var1%$pattern2}&quot;     #     abcd12345a
# La coincidència més curta possible. Elimina els darrers 6 caràcters  abcd12345abc6789
#                                     ^^^^                         |----|
echo '${var1%%pattern2} =' &quot;${var1%%$pattern2}&quot;    #     a
# La coincidència més llarga possible. Elimina els darrers 12 caràcters  abcd12345abc6789
#                                    ^^^^                 |-------------|

# Recordem, # i ## actuen d'esquerra a dreta (des de l'inici) de la cadena,
#           % i %% actuen de dreta a esquerra (des del final) de la cadena.

echo

exit 0
</pre>
<p><strong>Exemple 10-11. Canvi d'extensió d'un fitxer:</strong></p>
<pre class="literal-block">
#!/bin/bash
# rfe.sh: Canvi d'extensió d'un fitxer
#
#         rfe extensio_anterior extensio_nova
#
# Exemple:
# per canviar tots els *.gif del directori actual per *.jpg,
#          rfe gif jpg


E_BADARGS=65

case $# in
  0|1)             # Aquí la barra vertical significa disjunció &quot;o&quot; (&quot;or&quot;).
  echo &quot;Ús: `basename $0` sufix_antic sufix_nou&quot;
  exit $E_BADARGS  # En cas de 0 o 1 arguments.
  ;;
esac


for nomfitxer in *.$1
# Ordre invers de la llista de fitxers, tot començant amb el primer argument.
do
  mv $nomfitxer ${nomfitxer%$1}$2
  #  Elimina la part del fitxer que coincideixi amb el primer argument, i
  #+ a continuació afegeix el segon argument.
done

exit 0
</pre>
<p><strong>Expansió de variables / substitució de substrings</strong></p>
<blockquote>
Les següents funcions van ser adoptades del <em>ksh</em>.</blockquote>
<dl class="docutils">
<dt><tt class="docutils literal">${var:pos}</tt></dt>
<dd>Variable <tt class="docutils literal">var</tt> expandida, començant des de la posició <tt class="docutils literal">pos</tt>.</dd>
<dt><tt class="docutils literal">${var:pos:len}</tt></dt>
<dd>Expansió de <tt class="docutils literal">len</tt> caràcters de la variable <tt class="docutils literal">var</tt> començant des
de la posició <tt class="docutils literal">pos</tt>. A l'<a class="reference external" href="http://tldp.org/LDP/abs/html/contributed-scripts.html#PW">Exemple
A-13</a> es
troba un exemple (creatiu) d'ús d'aquest operador.</dd>
<dt><tt class="docutils literal">${var/Patró/Substitució}</tt></dt>
<dd><p class="first">Substitueix la primera aparició del <tt class="docutils literal">Patró</tt>, a la variable <tt class="docutils literal">var</tt>
per <tt class="docutils literal">Substitució</tt>.</p>
<p class="last">En cas que no s'especifiqui <tt class="docutils literal">Substitució</tt>, la primera ocurrència
de <tt class="docutils literal">Patró</tt> es substitueix per <em>no res</em>. És a dir, elimina aquesta
part de la variable.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">${var//Patró/Substitució}</span></tt></dt>
<dd><p class="first"><strong>Substitució global.</strong> Substitueix totes les aparicions de
<tt class="docutils literal">Patró</tt> de la variable <tt class="docutils literal">var</tt> per <tt class="docutils literal">Substitució</tt>.</p>
<p>Com abans, si no s'especifica <tt class="docutils literal">Substitució</tt> es substitueixen totes
les ocurrències de <tt class="docutils literal">Patró</tt> per <em>no res</em>. És a dir, són eliminades.</p>
<p><strong>Exemple 10-12. Anàlisi de strings arbitraris</strong></p>
<pre class="last literal-block">
empty string.
#!/bin/bash

var1=abcd-1234-defg
echo &quot;var1 = $var1&quot;

t=${var1#*-*}
echo &quot;var1 (un cop eliminat la part inicial fins al primer - ) = $t&quot;
#  t=${var1#*-}  el string buit fa exactament el mateix,
#+ donat que # coincideix amb el string més curt,
#+ i * coincideix amb qualsevol cosa (incloent res) que precedeixi el string buit.
# (Agraïment per Stephane Chazelas)

t=${var1##*-*}
echo &quot;si var1 conté un  \&quot;-\&quot; retornarà la cadena buida...   var1 = $t&quot;


t=${var1%*-*}
echo &quot;var1 (un cop eliminat el contingut des del darrer - fins al final) = $t&quot;

echo

# -------------------------------------------
path_name=/home/bozo/ideas/thoughts.for.today
# -------------------------------------------
echo &quot;path_name = $path_name&quot;
t=${path_name##/*/}
echo &quot;path_name un cop eliminat els prefixos = $t&quot;
# En aquest cas, ofereix el mateix resultat que t=`basename $path_name`.
#  t=${path_name%/}; t=${t##*/}   és una solució més general,
#+ però encara falla de vegades.
#  En cas que $path_name acabi amb salt de línia, no funcionarà `basename $path_name`,
#+ mentre que l'expressió anterior continuarà funcionant.
# (Gràcies  S.C.)

t=${path_name%/*.*}
# El mateix resultat que t=`dirname $path_name`
echo &quot;path_name, sense l'extensió= $t&quot;
# Fallarà en alguns casos, com ara amb &quot;../&quot;, &quot;/foo////&quot;, # &quot;foo/&quot;, &quot;/&quot;.
#  L'eliminació de sufixos es complica especialment quan el nom base no té extensió
#+ però el directori que el conté sí que en té.
# (Agraïment per S.C.)

echo

t=${path_name:11}
echo &quot;$path_name sense els primers 11 caràcters = $t&quot;
t=${path_name:11:5}
echo &quot;$path_name sense els primers 11 caràcters i amb 5 de longitud = $t&quot;

echo

t=${path_name/bozo/clown}
echo &quot;$path_name on \&quot;bozo\&quot; ha estat substituït per \&quot;clown\&quot; = $t&quot;
t=${path_name/today/}
echo &quot;$path_name on \&quot;today\&quot; ha estat eliminat = $t&quot;
t=${path_name//o/O}
echo &quot;$path_name on s'ha passat totes les &quot;o&quot; a majúscules = $t&quot;
t=${path_name//o/}
echo &quot;$path_name sense cap &quot;o&quot; = $t&quot;

exit 0
</pre>
</dd>
<dt><tt class="docutils literal"><span class="pre">${var/#Patró/Substitució}</span></tt></dt>
<dd>Quan l'<em>inici</em> de <tt class="docutils literal">var</tt> coincideix amb <tt class="docutils literal">Patró</tt>, llavors
<tt class="docutils literal">Substitució</tt> apareix en comptes de <tt class="docutils literal">Patró</tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">${var/%Patró/Substitució}</span></tt></dt>
<dd><p class="first">Quan el <em>final</em> de <tt class="docutils literal">var</tt> coincideix amb <tt class="docutils literal">Patró</tt>, llavors
<tt class="docutils literal">Substitució</tt> apareix en comptes de <tt class="docutils literal">Patró</tt>.</p>
<p><strong>Exemple 10-13. Coincidència de patrons a l'inici o al final d'un
string</strong></p>
<pre class="last literal-block">
#!/bin/bash
# var-match.sh:
# Demostració de la substitució del patró a l'inici/final d'un string.

v0=abc1234zip1234abc    # Variable original.
echo &quot;v0 = $v0&quot;         # abc1234zip1234abc
echo

# Coincideix amb l'inici del string.
v1=${v0/#abc/ABCDEF}    # abc1234zip1234abc
                        # |-|
echo &quot;v1 = $v1&quot;         # ABCDEF1234zip1234abc
                        # |----|

# Coincideix amb el final del string.
v2=${v0/%abc/ABCDEF}    # abc1234zip123abc
                        #              |-|
echo &quot;v2 = $v2&quot;         # abc1234zip1234ABCDEF
                        #               |----|

echo

#  ----------------------------------------------------
#  Cal que coincideixi extactament amb l'inici/final del string.
#+ Altrament no es realitza cap canvi.
#  ----------------------------------------------------
v3=${v0/#123/000}       # Coincideix però no amb l'inici.
echo &quot;v3 = $v3&quot;         # abc1234zip1234abc
                        # CAP CANVI.
v4=${v0/%123/000}       # Coincideix però no amb el final.
echo &quot;v4 = $v4&quot;         # abc1234zip1234abc
                        # CAP CANVI.

exit 0
</pre>
</dd>
<dt><tt class="docutils literal"><span class="pre">${!varprefix*}</span></tt>, <tt class="docutils literal"><span class="pre">${!varprefix&#64;}</span></tt></dt>
<dd><p class="first">Coincideix amb els <em>noms</em> de totes les variables declarades que
comencen per <tt class="docutils literal">varprefix</tt>.</p>
<pre class="last literal-block">
# Es tracta d'una variació d'una referència directa que fa servir  * o &#64;.
# Aquesta funcionalitat està disponible en Bash des de la versió 2.04.

xyz23=elquesigui
xyz24=

a=${!xyz*}         #  Expandeix als *noms* de les variables declarades
# ^ ^   ^           + que comencen per &quot;xyz&quot;.
echo &quot;a = $a&quot;      #  a = xyz23 xyz24
a=${!xyz&#64;}         #  Com abans.
echo &quot;a = $a&quot;      #  a = xyz23 xyz24

echo &quot;---&quot;

abc23=algunaaltracosa
b=${!abc*}
echo &quot;b = $b&quot;      #  b = abc23
c=${!b}            #  Aquesta és la manera més habitual de fer una referència indirecta.
echo $c            #  una_altra_cosa
</pre>
</dd>
</dl>
<div class="section" id="notes">
<h2>Notes</h2>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Quan a un script no interactiu $parametre és null, l'execució
finalitza amb codi de sortida <cite>127</cite> (codi d'error de Bash que
indica <em>No es troba la comanda</em>).</td></tr>
</tbody>
</table>
<hr class="docutils" />
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="35%" />
<col width="25%" />
</colgroup>
<tbody valign="top">
<tr><td><a class="reference external" href="string-manipulation.html">Prev</a></td>
<td><a class="reference external" href="index.html">Home</a></td>
<td><a class="reference external" href="loops.html">Next</a></td>
</tr>
<tr><td>Manipulating Strings</td>
<td><a class="reference external" href="manipulatingvars.html">Up</a></td>
<td>Loops and Branches</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</body>
</html>
