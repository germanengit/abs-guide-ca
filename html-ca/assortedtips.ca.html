<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.8.1: http://docutils.sourceforge.net/" />
<title></title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7056 2011-06-17 10:50:48Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">rst-ca/assortedtips.ca.rst</tt>, line 1)</p>
<p>Malformed table.</p>
<pre class="literal-block">
+----------------------------------+--------------------------+---------------------------------+
| Advanced Bash-Scripting Guide:   |
+==================================+==========================+=================================+
| `Prev &lt;optimizations.html&gt;`_     | Chapter 36. Miscellany   | `Next &lt;securityissues.html&gt;`_   |
+----------------------------------+--------------------------+---------------------------------+
</pre>
</div>
<hr class="docutils" />
<div class="section" id="assorted-tips">
<h1>36.7. Assorted Tips</h1>
<div class="section" id="ideas-for-more-powerful-scripts">
<h2>36.7.1. Ideas for more powerful scripts</h2>
<ul>
<li><p class="first">You have a problem that you want to solve by writing a Bash script.
Unfortunately, you don't know quite where to start. One method is to
plunge right in and code those parts of the script that come easily,
and write the hard parts as <em>pseudo-code</em>.</p>
<pre class="literal-block">
#!/bin/bash

ARGCOUNT=1                     # Need name as argument.
E_WRONGARGS=65

if [ number-of-arguments is-not-equal-to &quot;$ARGCOUNT&quot; ]
#    ^^^^^^^^^^^^^^^^^^^ ^^^^^^^^^^^^^^^
#  Can't figure out how to code this . . .
#+ . . . so write it in pseudo-code.

then
  echo &quot;Usage: name-of-script name&quot;
  #            ^^^^^^^^^^^^^^     More pseudo-code.
  exit $E_WRONGARGS
fi

. . .

exit 0


# Later on, substitute working code for the pseudo-code.

# Line 6 becomes:
if [ $# -ne &quot;$ARGCOUNT&quot; ]

# Line 12 becomes:
  echo &quot;Usage: `basename $0` name&quot;
</pre>
<p>For an example of using pseudo-code, see the <a class="reference external" href="writingscripts.html#NEWTONSQRT">Square
Root</a> exercise.</p>
</li>
<li><p class="first">To keep a record of which user scripts have run during a particular
session or over a number of sessions, add the following lines to each
script you want to keep track of. This will keep a continuing file
record of the script names and invocation times.</p>
<pre class="literal-block">
# Append (&gt;&gt;) following to end of each script tracked.

whoami&gt;&gt; $SAVE_FILE    # User invoking the script.
echo $0&gt;&gt; $SAVE_FILE   # Script name.
date&gt;&gt; $SAVE_FILE      # Date and time.
echo&gt;&gt; $SAVE_FILE      # Blank line as separator.

#  Of course, SAVE_FILE defined and exported as environmental variable in ~/.bashrc
#+ (something like ~/.scripts-run)
</pre>
</li>
<li><p class="first">The &gt;&gt; operator <em>appends</em> lines to a file. What if you wish to
<em>prepend</em> a line to an existing file, that is, to paste it in at the
beginning?</p>
<pre class="literal-block">
file=data.txt
title=&quot;***This is the title line of data text file***&quot;

echo $title | cat - $file &gt;$file.new
# &quot;cat -&quot; concatenates stdout to $file.
#  End result is
#+ to write a new file with $title appended at *beginning*.
</pre>
<p>This is a simplified variant of the <a class="reference external" href="x17700.html#PREPENDEX">Example
19-13</a> script given earlier. And, of course,
<a class="reference external" href="sedawk.html#SEDREF">sed</a> can also do this.</p>
</li>
<li><p class="first">A shell script may act as an embedded command inside another shell
script, a <em>Tcl</em> or <em>wish</em> script, or even a
<a class="reference external" href="filearchiv.html#MAKEFILEREF">Makefile</a>. It can be invoked as an
external shell command in a C program using the <tt class="docutils literal">system()</tt> call,
i.e., <tt class="docutils literal"><span class="pre">system(&quot;script_name&quot;);</span></tt>.</p>
</li>
<li><p class="first">Setting a variable to the contents of an embedded <em>sed</em> or <em>awk</em>
script increases the readability of the surrounding <a class="reference external" href="wrapper.html#SHWRAPPER">shell
wrapper</a>. See <a class="reference external" href="contributed-scripts.html#MAILFORMAT">Example
A-1</a> and <a class="reference external" href="internal.html#COLTOTALER3">Example
15-20</a>.</p>
</li>
<li><p class="first">Put together files containing your favorite and most useful
definitions and functions. As necessary, &quot;include&quot; one or more of
these &quot;library files&quot; in scripts with either the
<a class="reference external" href="special-chars.html#DOTREF">dot</a> (<strong>.</strong>) or
<a class="reference external" href="internal.html#SOURCEREF">source</a> command.</p>
<pre class="literal-block">
# SCRIPT LIBRARY
# ------ -------

# Note:
# No &quot;#!&quot; here.
# No &quot;live code&quot; either.


# Useful variable definitions

ROOT_UID=0             # Root has $UID 0.
E_NOTROOT=101          # Not root user error.
MAXRETVAL=255          # Maximum (positive) return value of a function.
SUCCESS=0
FAILURE=-1



# Functions

Usage ()               # &quot;Usage:&quot; message.
{
  if [ -z &quot;$1&quot; ]       # No arg passed.
  then
    msg=filename
  else
    msg=$&#64;
  fi

  echo &quot;Usage: `basename $0` &quot;$msg&quot;&quot;
}


Check_if_root ()       # Check if root running script.
{                      # From &quot;ex39.sh&quot; example.
  if [ &quot;$UID&quot; -ne &quot;$ROOT_UID&quot; ]
  then
    echo &quot;Must be root to run this script.&quot;
    exit $E_NOTROOT
  fi
}


CreateTempfileName ()  # Creates a &quot;unique&quot; temp filename.
{                      # From &quot;ex51.sh&quot; example.
  prefix=temp
  suffix=`eval date +%s`
  Tempfilename=$prefix.$suffix
}


isalpha2 ()            # Tests whether *entire string* is alphabetic.
{                      # From &quot;isalpha.sh&quot; example.
  [ $# -eq 1 ] || return $FAILURE

  case $1 in
  *[!a-zA-Z]*|&quot;&quot;) return $FAILURE;;
  *) return $SUCCESS;;
  esac                 # Thanks, S.C.
}


abs ()                           # Absolute value.
{                                # Caution: Max return value = 255.
  E_ARGERR=-999999

  if [ -z &quot;$1&quot; ]                 # Need arg passed.
  then
    return $E_ARGERR             # Obvious error value returned.
  fi

  if [ &quot;$1&quot; -ge 0 ]              # If non-negative,
  then                           #
    absval=$1                    # stays as-is.
  else                           # Otherwise,
    let &quot;absval = (( 0 - $1 ))&quot;  # change sign.
  fi

  return $absval
}


tolower ()             #  Converts string(s) passed as argument(s)
{                      #+ to lowercase.

  if [ -z &quot;$1&quot; ]       #  If no argument(s) passed,
  then                 #+ send error message
    echo &quot;(null)&quot;      #+ (C-style void-pointer error message)
    return             #+ and return from function.
  fi

  echo &quot;$&#64;&quot; | tr A-Z a-z
  # Translate all passed arguments ($&#64;).

  return

# Use command substitution to set a variable to function output.
# For example:
#    oldvar=&quot;A seT of miXed-caSe LEtTerS&quot;
#    newvar=`tolower &quot;$oldvar&quot;`
#    echo &quot;$newvar&quot;    # a set of mixed-case letters
#
# Exercise: Rewrite this function to change lowercase passed argument(s)
#           to uppercase ... toupper()  [easy].
}
</pre>
</li>
<li><p class="first">Use special-purpose comment headers to increase clarity and
legibility in scripts.</p>
<pre class="literal-block">
## Caution.
rm -rf *.zzy   ##  The &quot;-rf&quot; options to &quot;rm&quot; are very dangerous,
               ##+ especially with wild cards.

#+ Line continuation.
#  This is line 1
#+ of a multi-line comment,
#+ and this is the final line.

#* Note.

#o List item.

#&gt; Another point of view.
while [ &quot;$var1&quot; != &quot;end&quot; ]    #&gt; while test &quot;$var1&quot; != &quot;end&quot;
</pre>
</li>
<li><p class="first">Dotan Barak contributes template code for a <em>progress bar</em> in a
script.</p>
<p><strong>Example 36-15. A Progress Bar</strong></p>
<pre class="literal-block">
#!/bin/bash
# progress-bar.sh

# Author: Dotan Barak (very minor revisions by ABS Guide author).
# Used in ABS Guide with permission (thanks!).


BAR_WIDTH=50
BAR_CHAR_START=&quot;[&quot;
BAR_CHAR_END=&quot;]&quot;
BAR_CHAR_EMPTY=&quot;.&quot;
BAR_CHAR_FULL=&quot;=&quot;
BRACKET_CHARS=2
LIMIT=100

print_progress_bar()
{
        # Calculate how many characters will be full.
        let &quot;full_limit = ((($1 - $BRACKET_CHARS) * $2) / $LIMIT)&quot;

        # Calculate how many characters will be empty.
        let &quot;empty_limit = ($1 - $BRACKET_CHARS) - ${full_limit}&quot;

        # Prepare the bar.
        bar_line=&quot;${BAR_CHAR_START}&quot;
        for ((j=0; j&lt;full_limit; j++)); do
                bar_line=&quot;${bar_line}${BAR_CHAR_FULL}&quot;
        done

        for ((j=0; j&lt;empty_limit; j++)); do
                bar_line=&quot;${bar_line}${BAR_CHAR_EMPTY}&quot;
        done

        bar_line=&quot;${bar_line}${BAR_CHAR_END}&quot;

        printf &quot;%3d%% %s&quot; $2 ${bar_line}
}

# Here is a sample of code that uses it.
MAX_PERCENT=100
for ((i=0; i&lt;=MAX_PERCENT; i++)); do
        #
        usleep 10000
        # ... Or run some other commands ...
        #
        print_progress_bar ${BAR_WIDTH} ${i}
        echo -en &quot;\r&quot;
done

echo &quot;&quot;

exit
</pre>
</li>
<li><p class="first">A particularly clever use of
<a class="reference external" href="testconstructs.html#TESTCONSTRUCTS1">if-test</a> constructs is for
comment blocks.</p>
<pre class="literal-block">
#!/bin/bash

COMMENT_BLOCK=
#  Try setting the above variable to some value
#+ for an unpleasant surprise.

if [ $COMMENT_BLOCK ]; then

Comment block --
=================================
This is a comment line.
This is another comment line.
This is yet another comment line.
=================================

echo &quot;This will not echo.&quot;

Comment blocks are error-free! Whee!

fi

echo &quot;No more comments, please.&quot;

exit 0
</pre>
<p>Compare this with <a class="reference external" href="here-docs.html#CBLOCK1">using here documents to comment out code
blocks</a>.</p>
</li>
<li><p class="first">Using the <a class="reference external" href="internalvariables.html#XSTATVARREF">$? exit status
variable</a>, a script may test if
a parameter contains only digits, so it can be treated as an integer.</p>
<pre class="literal-block">
#!/bin/bash

SUCCESS=0
E_BADINPUT=85

test &quot;$1&quot; -ne 0 -o &quot;$1&quot; -eq 0 2&gt;/dev/null
# An integer is either equal to 0 or not equal to 0.
# 2&gt;/dev/null suppresses error message.

if [ $? -ne &quot;$SUCCESS&quot; ]
then
  echo &quot;Usage: `basename $0` integer-input&quot;
  exit $E_BADINPUT
fi

let &quot;sum = $1 + 25&quot;             # Would give error if $1 not integer.
echo &quot;Sum = $sum&quot;

# Any variable, not just a command-line parameter, can be tested this way.

exit 0
</pre>
</li>
<li><p class="first">The 0 - 255 range for function return values is a severe limitation.
Global variables and other workarounds are often problematic. An
alternative method for a function to communicate a value back to the
main body of the script is to have the function write to <tt class="docutils literal">stdout</tt>
(usually with <a class="reference external" href="internal.html#ECHOREF">echo</a>) the &quot;return value,&quot;
and assign this to a variable. This is actually a variant of <a class="reference external" href="commandsub.html#COMMANDSUBREF">command
substitution.</a></p>
<p><strong>Example 36-16. Return value trickery</strong></p>
<pre class="literal-block">
#!/bin/bash
# multiplication.sh

multiply ()                     # Multiplies params passed.
{                               # Will accept a variable number of args.

  local product=1

  until [ -z &quot;$1&quot; ]             # Until uses up arguments passed...
  do
    let &quot;product *= $1&quot;
    shift
  done

  echo $product                 #  Will not echo to stdout,
}                               #+ since this will be assigned to a variable.

mult1=15383; mult2=25211
val1=`multiply $mult1 $mult2`
# Assigns stdout (echo) of function to the variable val1.
echo &quot;$mult1 X $mult2 = $val1&quot;                   # 387820813

mult1=25; mult2=5; mult3=20
val2=`multiply $mult1 $mult2 $mult3`
echo &quot;$mult1 X $mult2 X $mult3 = $val2&quot;          # 2500

mult1=188; mult2=37; mult3=25; mult4=47
val3=`multiply $mult1 $mult2 $mult3 $mult4`
echo &quot;$mult1 X $mult2 X $mult3 X $mult4 = $val3&quot; # 8173300

exit 0
</pre>
<p>The same technique also works for alphanumeric strings. This means
that a function can &quot;return&quot; a non-numeric value.</p>
<pre class="literal-block">
capitalize_ichar ()          #  Capitalizes initial character
{                            #+ of argument string(s) passed.

  string0=&quot;$&#64;&quot;               # Accepts multiple arguments.

  firstchar=${string0:0:1}   # First character.
  string1=${string0:1}       # Rest of string(s).

  FirstChar=`echo &quot;$firstchar&quot; | tr a-z A-Z`
                             # Capitalize first character.

  echo &quot;$FirstChar$string1&quot;  # Output to stdout.

}

newstring=`capitalize_ichar &quot;every sentence should start with a capital letter.&quot;`
echo &quot;$newstring&quot;          # Every sentence should start with a capital letter.
</pre>
<p>It is even possible for a function to &quot;return&quot; multiple values with
this method.</p>
<p><strong>Example 36-17. Even more return value trickery</strong></p>
<pre class="literal-block">
#!/bin/bash
# sum-product.sh
# A function may &quot;return&quot; more than one value.

sum_and_product ()   # Calculates both sum and product of passed args.
{
  echo $(( $1 + $2 )) $(( $1 * $2 ))
# Echoes to stdout each calculated value, separated by space.
}

echo
echo &quot;Enter first number &quot;
read first

echo
echo &quot;Enter second number &quot;
read second
echo

retval=`sum_and_product $first $second`      # Assigns output of function.
sum=`echo &quot;$retval&quot; | awk '{print $1}'`      # Assigns first field.
product=`echo &quot;$retval&quot; | awk '{print $2}'`  # Assigns second field.

echo &quot;$first + $second = $sum&quot;
echo &quot;$first * $second = $product&quot;
echo

exit 0
</pre>
<div class="figure align-center">
<img alt="Caution" src="http://tldp.org/LDP/abs/images/caution.gif" />
<p class="caption">Caution</p>
</div>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/assortedtips.ca.rst</tt>, line 486)</p>
<p>Explicit markup ends without a blank line; unexpected unindent.</p>
</div>
<p>There can be only <strong>one</strong> <em>echo</em> statement in the function for this
to work. If you alter the previous example:</p>
<pre class="literal-block">
sum_and_product ()
{
  echo &quot;This is the sum_and_product function.&quot; # This messes things up!
  echo $(( $1 + $2 )) $(( $1 * $2 ))
}
...
retval=`sum_and_product $first $second`      # Assigns output of function.
# Now, this will not work correctly.
</pre>
</li>
<li><p class="first">Next in our bag of tricks are techniques for passing an
<a class="reference external" href="arrays.html#ARRAYREF">array</a> to a
<a class="reference external" href="functions.html#FUNCTIONREF">function</a>, then &quot;returning&quot; an array
back to the main body of the script.</p>
<p>Passing an array involves loading the space-separated elements of the
array into a variable with <a class="reference external" href="commandsub.html#COMMANDSUBREF">command
substitution</a>. Getting an array back
as the &quot;return value&quot; from a function uses the previously mentioned
strategem of <a class="reference external" href="internal.html#ECHOREF">echoing</a> the array in the
function, then invoking command substitution and the <strong>( ... )</strong>
operator to assign it to an array.</p>
<p><strong>Example 36-18. Passing and returning arrays</strong></p>
<pre class="literal-block">
#!/bin/bash
# array-function.sh: Passing an array to a function and ...
#                   &quot;returning&quot; an array from a function


Pass_Array ()
{
  local passed_array   # Local variable!
  passed_array=( `echo &quot;$1&quot;` )
  echo &quot;${passed_array[&#64;]}&quot;
  #  List all the elements of the new array
  #+ declared and set within the function.
}


original_array=( element1 element2 element3 element4 element5 )

echo
echo &quot;original_array = ${original_array[&#64;]}&quot;
#                      List all elements of original array.


# This is the trick that permits passing an array to a function.
# **********************************
argument=`echo ${original_array[&#64;]}`
# **********************************
#  Pack a variable
#+ with all the space-separated elements of the original array.
#
# Attempting to just pass the array itself will not work.


# This is the trick that allows grabbing an array as a &quot;return value&quot;.
# *****************************************
returned_array=( `Pass_Array &quot;$argument&quot;` )
# *****************************************
# Assign 'echoed' output of function to array variable.

echo &quot;returned_array = ${returned_array[&#64;]}&quot;

echo &quot;=============================================================&quot;

#  Now, try it again,
#+ attempting to access (list) the array from outside the function.
Pass_Array &quot;$argument&quot;

# The function itself lists the array, but ...
#+ accessing the array from outside the function is forbidden.
echo &quot;Passed array (within function) = ${passed_array[&#64;]}&quot;
# NULL VALUE since the array is a variable local to the function.

echo

############################################

# And here is an even more explicit example:

ret_array ()
{
  for element in {11..20}
  do
    echo &quot;$element &quot;   #  Echo individual elements
  done                 #+ of what will be assembled into an array.
}

arr=( $(ret_array) )   #  Assemble into array.

echo &quot;Capturing array \&quot;arr\&quot; from function ret_array () ...&quot;
echo &quot;Third element of array \&quot;arr\&quot; is ${arr[2]}.&quot;   # 13  (zero-indexed)
echo -n &quot;Entire array is: &quot;
echo ${arr[&#64;]}                # 11 12 13 14 15 16 17 18 19 20

echo

exit 0
</pre>
<p>For a more elaborate example of passing arrays to functions, see
<a class="reference external" href="contributed-scripts.html#LIFESLOW">Example A-10</a>.</p>
</li>
<li><p class="first">Using the <a class="reference external" href="dblparens.html">double-parentheses construct</a>, it is
possible to use C-style syntax for setting and
incrementing/decrementing variables and in
<a class="reference external" href="loops1.html#FORLOOPREF1">for</a> and
<a class="reference external" href="loops1.html#WHILELOOPREF">while</a> loops. See <a class="reference external" href="loops1.html#FORLOOPC">Example
11-12</a> and <a class="reference external" href="loops1.html#WHLOOPC">Example
11-17</a>.</p>
</li>
<li><p class="first">Setting the <a class="reference external" href="internalvariables.html#PATHREF">path</a> and
<a class="reference external" href="system.html#UMASKREF">umask</a> at the beginning of a script makes it
more <a class="reference external" href="portabilityissues.html">portable</a> -- more likely to run on a
&quot;foreign&quot; machine whose user may have bollixed up the <tt class="docutils literal">$PATH</tt> and
<strong>umask</strong>.</p>
<pre class="literal-block">
#!/bin/bash
PATH=/bin:/usr/bin:/usr/local/bin ; export PATH
umask 022   # Files that the script creates will have 755 permission.

# Thanks to Ian D. Allen, for this tip.
</pre>
</li>
<li><p class="first">A useful scripting technique is to <em>repeatedly</em> feed the output of a
filter (by piping) back to the <em>same filter</em>, but with a different
set of arguments and/or options. Especially suitable for this are
<a class="reference external" href="textproc.html#TRREF">tr</a> and <a class="reference external" href="textproc.html#GREPREF">grep</a>.</p>
<pre class="literal-block">
# From &quot;wstrings.sh&quot; example.

wlist=`strings &quot;$1&quot; | tr A-Z a-z | tr '[:space:]' Z | \
tr -cs '[:alpha:]' Z | tr -s '\173-\377' Z | tr Z ' '`
</pre>
<p><strong>Example 36-19. Fun with anagrams</strong></p>
<pre class="literal-block">
#!/bin/bash
# agram.sh: Playing games with anagrams.

# Find anagrams of...
LETTERSET=etaoinshrdlu
FILTER='.......'       # How many letters minimum?
#       1234567

anagram &quot;$LETTERSET&quot; | # Find all anagrams of the letterset...
grep &quot;$FILTER&quot; |       # With at least 7 letters,
grep '^is' |           # starting with 'is'
grep -v 's$' |         # no plurals
grep -v 'ed$'          # no past tense verbs
# Possible to add many combinations of conditions and filters.

#  Uses &quot;anagram&quot; utility
#+ that is part of the author's &quot;yawl&quot; word list package.
#  http://ibiblio.org/pub/Linux/libs/yawl-0.3.2.tar.gz
#  http://bash.deta.in/yawl-0.3.2.tar.gz

exit 0                 # End of code.


bash$ sh agram.sh
islander
isolate
isolead
isotheral



#  Exercises:
#  ---------
#  Modify this script to take the LETTERSET as a command-line parameter.
#  Parameterize the filters in lines 11 - 13 (as with $FILTER),
#+ so that they can be specified by passing arguments to a function.

#  For a slightly different approach to anagramming,
#+ see the agram2.sh script.
</pre>
<p>See also <a class="reference external" href="procref1.html#CONSTAT">Example 29-4</a>, <a class="reference external" href="textproc.html#CRYPTOQUOTE">Example
16-25</a>, and <a class="reference external" href="contributed-scripts.html#SOUNDEX">Example
A-9</a>.</p>
</li>
<li><p class="first">Use &quot;<a class="reference external" href="here-docs.html#ANONHEREDOC0">anonymous here documents</a>&quot; to
comment out blocks of code, to save having to individually comment
out each line with a #. See <a class="reference external" href="here-docs.html#COMMENTBLOCK">Example
19-11</a>.</p>
</li>
<li><p class="first">Running a script on a machine that relies on a command that might not
be installed is dangerous. Use <a class="reference external" href="filearchiv.html#WHATISREF">whatis</a>
to avoid potential problems with this.</p>
<pre class="literal-block">
CMD=command1                 # First choice.
PlanB=command2               # Fallback option.

command_test=$(whatis &quot;$CMD&quot; | grep 'nothing appropriate')
#  If 'command1' not found on system , 'whatis' will return
#+ &quot;command1: nothing appropriate.&quot;
#
#  A safer alternative is:
#     command_test=$(whereis &quot;$CMD&quot; | grep \/)
#  But then the sense of the following test would have to be reversed,
#+ since the $command_test variable holds content only if
#+ the $CMD exists on the system.
#     (Thanks, bojster.)


if [[ -z &quot;$command_test&quot; ]]  # Check whether command present.
then
  $CMD option1 option2       #  Run command1 with options.
else                         #  Otherwise,
  $PlanB                     #+ run command2.
fi
</pre>
</li>
<li><p class="first">An <a class="reference external" href="testconstructs.html#IFGREPREF">if-grep test</a> may not return
expected results in an error case, when text is output to <tt class="docutils literal">stderr</tt>,
rather that <tt class="docutils literal">stdout</tt>.</p>
<pre class="literal-block">
if ls -l nonexistent_filename | grep -q 'No such file or directory'
  then echo &quot;File \&quot;nonexistent_filename\&quot; does not exist.&quot;
fi
</pre>
<p><a class="reference external" href="io-redirection.html#IOREDIRREF">Redirecting</a> <tt class="docutils literal">stderr</tt> to
<tt class="docutils literal">stdout</tt> fixes this.</p>
<pre class="literal-block">
if ls -l nonexistent_filename 2&gt;&amp;1 | grep -q 'No such file or directory'
#                             ^^^^
  then echo &quot;File \&quot;nonexistent_filename\&quot; does not exist.&quot;
fi

# Thanks, Chris Martin, for pointing this out.
</pre>
</li>
<li><p class="first">If you absolutely must access a subshell variable outside the
subshell, here's a way to do it.</p>
<pre class="literal-block">
TMPFILE=tmpfile                  # Create a temp file to store the variable.

(   # Inside the subshell ...
inner_variable=Inner
echo $inner_variable
echo $inner_variable &gt;&gt;$TMPFILE  # Append to temp file.
)

    # Outside the subshell ...

echo; echo &quot;-----&quot;; echo
echo $inner_variable             # Null, as expected.
echo &quot;-----&quot;; echo

# Now ...
read inner_variable &lt;$TMPFILE    # Read back shell variable.
rm -f &quot;$TMPFILE&quot;                 # Get rid of temp file.
echo &quot;$inner_variable&quot;           # It's an ugly kludge, but it works.
</pre>
</li>
<li><p class="first">The <a class="reference external" href="extmisc.html#RUNPARTSREF">run-parts</a> command is handy for
running a set of command scripts in a particular sequence, especially
in combination with <a class="reference external" href="system.html#CRONREF">cron</a> or
<a class="reference external" href="timedate.html#ATREF">at</a>.</p>
</li>
<li><p class="first">For doing multiple revisions on a complex script, use the <em>rcs</em>
Revision Control System package.</p>
<p>Among other benefits of this is automatically updated ID header tags.
The <strong>co</strong> command in <em>rcs</em> does a parameter replacement of certain
reserved key words, for example, replacing <tt class="docutils literal"># $Id$</tt> in a script
with something like:</p>
<pre class="literal-block">
# $Id: hello-world.sh,v 1.1 2004/10/16 02:43:05 bozo Exp $
</pre>
</li>
</ul>
</div>
<div class="section" id="widgets">
<h2>36.7.2. Widgets</h2>
<p>It would be nice to be able to invoke X-Windows widgets from a shell
script. There happen to exist several packages that purport to do so,
namely <em>Xscript</em>, <em>Xmenu</em>, and <em>widtools</em>. The first two of these no
longer seem to be maintained. Fortunately, it is still possible to
obtain <em>widtools</em>
<a class="reference external" href="http://www.batse.msfc.nasa.gov/~mallozzi/home/software/xforms/src/widtools-2.0.tgz">here</a>.</p>
<div class="figure align-center">
<img alt="Caution" src="http://tldp.org/LDP/abs/images/caution.gif" />
<p class="caption">Caution</p>
</div>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/assortedtips.ca.rst</tt>, line 807)</p>
Explicit markup ends without a blank line; unexpected unindent.</div>
<p>The <em>widtools</em> (widget tools) package requires the <em>XForms</em> library to
be installed. Additionally, the
<a class="reference external" href="filearchiv.html#MAKEFILEREF">Makefile</a> needs some judicious editing
before the package will build on a typical Linux system. Finally, three
of the six widgets offered do not work (and, in fact, segfault).</p>
<p>The <em>dialog</em> family of tools offers a method of calling &quot;dialog&quot; widgets
from a shell script. The original <em>dialog</em> utility works in a text
console, but its successors, <em>gdialog</em>, <em>Xdialog</em>, and <em>kdialog</em> use
X-Windows-based widget sets.</p>
<p><strong>Example 36-20. Widgets invoked from a shell script</strong></p>
<pre class="literal-block">
#!/bin/bash
# dialog.sh: Using 'gdialog' widgets.

# Must have 'gdialog' installed on your system to run this script.
# Or, you can replace all instance of 'gdialog' below with 'kdialog' ...
# Version 1.1 (corrected 04/05/05)

# This script was inspired by the following article.
#     &quot;Scripting for X Productivity,&quot; by Marco Fioretti,
#      LINUX JOURNAL, Issue 113, September 2003, pp. 86-9.
# Thank you, all you good people at LJ.


# Input error in dialog box.
E_INPUT=65
# Dimensions of display, input widgets.
HEIGHT=50
WIDTH=60

# Output file name (constructed out of script name).
OUTFILE=$0.output

# Display this script in a text widget.
gdialog --title &quot;Displaying: $0&quot; --textbox $0 $HEIGHT $WIDTH



# Now, we'll try saving input in a file.
echo -n &quot;VARIABLE=&quot; &gt; $OUTFILE
gdialog --title &quot;User Input&quot; --inputbox &quot;Enter variable, please:&quot; \
$HEIGHT $WIDTH 2&gt;&gt; $OUTFILE


if [ &quot;$?&quot; -eq 0 ]
# It's good practice to check exit status.
then
  echo &quot;Executed \&quot;dialog box\&quot; without errors.&quot;
else
  echo &quot;Error(s) in \&quot;dialog box\&quot; execution.&quot;
        # Or, clicked on &quot;Cancel&quot;, instead of &quot;OK&quot; button.
  rm $OUTFILE
  exit $E_INPUT
fi



# Now, we'll retrieve and display the saved variable.
. $OUTFILE   # 'Source' the saved file.
echo &quot;The variable input in the \&quot;input box\&quot; was: &quot;$VARIABLE&quot;&quot;


rm $OUTFILE  # Clean up by removing the temp file.
             # Some applications may need to retain this file.

exit $?

# Exercise: Rewrite this script using the 'zenity' widget set.
</pre>
<p>The <a class="reference external" href="extmisc.html#XMESSAGEREF">xmessage</a> command is a simple method of
popping up a message/query window. For example:</p>
<pre class="literal-block">
xmessage Fatal error in script! -button exit
</pre>
<p>The latest entry in the widget sweepstakes is
<a class="reference external" href="extmisc.html#ZENITYREF">zenity</a>. This utility pops up <em>GTK+</em> dialog
widgets-and-windows, and it works very nicely within a script.</p>
<pre class="literal-block">
get_info ()
{
  zenity --entry       #  Pops up query window . . .
                       #+ and prints user entry to stdout.

                       #  Also try the --calendar and --scale options.
}

answer=$( get_info )   #  Capture stdout in $answer variable.

echo &quot;User entered: &quot;$answer&quot;&quot;
</pre>
<p>For other methods of scripting with widgets, try <em>Tk</em> or <em>wish</em> (<em>Tcl</em>
derivatives), <em>PerlTk</em> (<em>Perl</em> with <em>Tk</em> extensions), <em>tksh</em> (<em>ksh</em> with
<em>Tk</em> extensions), <em>XForms4Perl</em> (<em>Perl</em> with <em>XForms</em> extensions),
<em>Gtk-Perl</em> (<em>Perl</em> with <em>Gtk</em> extensions), or <em>PyQt</em> (<em>Python</em> with <em>Qt</em>
extensions).</p>
<hr class="docutils" />
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="29%" />
<col width="36%" />
</colgroup>
<tbody valign="top">
<tr><td><a class="reference external" href="optimizations.html">Prev</a></td>
<td><a class="reference external" href="index.html">Home</a></td>
<td><a class="reference external" href="securityissues.html">Next</a></td>
</tr>
<tr><td>Optimizations</td>
<td><a class="reference external" href="miscellany.html">Up</a></td>
<td>Security Issues</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</body>
</html>
