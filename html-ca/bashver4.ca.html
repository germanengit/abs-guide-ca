<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.8.1: http://docutils.sourceforge.net/" />
<title></title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7056 2011-06-17 10:50:48Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">rst-ca/bashver4.ca.rst</tt>, line 1)</p>
<p>Malformed table.</p>
<pre class="literal-block">
+----------------------------------+------------------------------------------+---------------------------+
| Advanced Bash-Scripting Guide:   |
+==================================+==========================================+===========================+
| `Prev &lt;bashver3.html&gt;`_          | Chapter 37. Bash, versions 2, 3, and 4   | `Next &lt;endnotes.html&gt;`_   |
+----------------------------------+------------------------------------------+---------------------------+
</pre>
</div>
<hr class="docutils" />
<div class="section" id="bash-version-4">
<h1>37.3. Bash, version 4</h1>
<p>Chet Ramey announced Version 4 of Bash on the 20th of February, 2009.
This release has a number of significant new features, as well as some
important bugfixes.</p>
<p>Among the new goodies:</p>
<ul>
<li><p class="first">Associative arrays. <a class="reference external" href="bashver4.html#FTN.AEN20834">[1]</a></p>
<p>An <em>associative</em> array can be thought of as a set of two linked
arrays -- one holding the <em>data</em>, and the other the <em>keys</em> that index
the individual elements of the <em>data</em> array.</p>
<p><strong>Example 37-5. A simple address database</strong></p>
<pre class="literal-block">
#!/bin/bash4
# fetch_address.sh

declare -A address
#       -A option declares associative array.

address[Charles]=&quot;414 W. 10th Ave., Baltimore, MD 21236&quot;
address[John]=&quot;202 E. 3rd St., New York, NY 10009&quot;
address[Wilma]=&quot;1854 Vermont Ave, Los Angeles, CA 90023&quot;


echo &quot;Charles's address is ${address[Charles]}.&quot;
# Charles's address is 414 W. 10th Ave., Baltimore, MD 21236.
echo &quot;Wilma's address is ${address[Wilma]}.&quot;
# Wilma's address is 1854 Vermont Ave, Los Angeles, CA 90023.
echo &quot;John's address is ${address[John]}.&quot;
# John's address is 202 E. 3rd St., New York, NY 10009.

echo

echo &quot;${!address[*]}&quot;   # The array indices ...
# Charles John Wilma
</pre>
<p><strong>Example 37-6. A somewhat more elaborate address database</strong></p>
<pre class="literal-block">
#!/bin/bash4
# fetch_address-2.sh
# A more elaborate version of fetch_address.sh.

SUCCESS=0
E_DB=99    # Error code for missing entry.

declare -A address
#       -A option declares associative array.


store_address ()
{
  address[$1]=&quot;$2&quot;
  return $?
}


fetch_address ()
{
  if [[ -z &quot;${address[$1]}&quot; ]]
  then
    echo &quot;$1's address is not in database.&quot;
    return $E_DB
  fi

  echo &quot;$1's address is ${address[$1]}.&quot;
  return $?
}


store_address &quot;Lucas Fayne&quot; &quot;414 W. 13th Ave., Baltimore, MD 21236&quot;
store_address &quot;Arvid Boyce&quot; &quot;202 E. 3rd St., New York, NY 10009&quot;
store_address &quot;Velma Winston&quot; &quot;1854 Vermont Ave, Los Angeles, CA 90023&quot;
#  Exercise:
#  Rewrite the above store_address calls to read data from a file,
#+ then assign field 1 to name, field 2 to address in the array.
#  Each line in the file would have a format corresponding to the above.
#  Use a while-read loop to read from file, sed or awk to parse the fields.

fetch_address &quot;Lucas Fayne&quot;
# Lucas Fayne's address is 414 W. 13th Ave., Baltimore, MD 21236.
fetch_address &quot;Velma Winston&quot;
# Velma Winston's address is 1854 Vermont Ave, Los Angeles, CA 90023.
fetch_address &quot;Arvid Boyce&quot;
# Arvid Boyce's address is 202 E. 3rd St., New York, NY 10009.
fetch_address &quot;Bozo Bozeman&quot;
# Bozo Bozeman's address is not in database.

exit $?   # In this case, exit code = 99, since that is function return.
</pre>
<p>See <a class="reference external" href="contributed-scripts.html#SAMORSE">Example A-53</a> for an
interesting usage of an <em>associative array</em>.</p>
<div class="figure align-center">
<img alt="Caution" src="http://tldp.org/LDP/abs/images/caution.gif" />
<p class="caption">Caution</p>
</div>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/bashver4.ca.rst</tt>, line 114)</p>
<p>Explicit markup ends without a blank line; unexpected unindent.</p>
</div>
<p>Elements of the <em>index</em> array may include embedded <a class="reference external" href="special-chars.html#WHITESPACEREF">space
characters</a>, or even leading
and/or trailing space characters. However, index array elements
containing <em>only</em> <em>whitespace</em> are <em>not</em> permitted.</p>
<pre class="literal-block">
address[   ]=&quot;Blank&quot;   # Error!
</pre>
</li>
<li><p class="first">Enhancements to the <a class="reference external" href="testbranch.html#CASEESAC1">case</a> construct:
the <tt class="docutils literal">;;&amp;</tt> and <tt class="docutils literal">;&amp;</tt> terminators.</p>
<p><strong>Example 37-7. Testing characters</strong></p>
<pre class="literal-block">
#!/bin/bash4

test_char ()
{
  case &quot;$1&quot; in
    [[:print:]] )  echo &quot;$1 is a printable character.&quot;;;&amp;       # |
    # The ;;&amp; terminator continues to the next pattern test.      |
    [[:alnum:]] )  echo &quot;$1 is an alpha/numeric character.&quot;;;&amp;  # v
    [[:alpha:]] )  echo &quot;$1 is an alphabetic character.&quot;;;&amp;     # v
    [[:lower:]] )  echo &quot;$1 is a lowercase alphabetic character.&quot;;;&amp;
    [[:digit:]] )  echo &quot;$1 is an numeric character.&quot;;&amp;         # |
    # The ;&amp; terminator executes the next statement ...         # |
    %%%&#64;&#64;&#64;&#64;&#64;    )  echo &quot;********************************&quot;;;    # v
#   ^^^^^^^^  ... even with a dummy pattern.
  esac
}

echo

test_char 3
# 3 is a printable character.
# 3 is an alpha/numeric character.
# 3 is an numeric character.
# ********************************
echo

test_char m
# m is a printable character.
# m is an alpha/numeric character.
# m is an alphabetic character.
# m is a lowercase alphabetic character.
echo

test_char /
# / is a printable character.

echo

# The ;;&amp; terminator can save complex if/then conditions.
# The ;&amp; is somewhat less useful.
</pre>
</li>
<li><p class="first">The new <strong>coproc</strong> builtin enables two parallel
<a class="reference external" href="special-chars.html#PROCESSREF">processes</a> to communicate and
interact. As Chet Ramey states in the <a class="reference external" href="biblio.html#BASHFAQ">Bash
FAQ</a> <a class="reference external" href="bashver4.html#FTN.AEN20876">[2]</a> ,
ver. 4.01:</p>
<blockquote>
<dl class="docutils">
<dt>There is a new 'coproc' reserved word that specifies a coprocess:</dt>
<dd><p class="first last">an asynchronous command run with two pipes connected to the</p>
</dd>
<dt>creating</dt>
<dd><p class="first last">shell. Coprocs can be named. The input and output file</p>
</dd>
<dt>descriptors</dt>
<dd><p class="first last">and the PID of the coprocess are available to the calling shell</p>
</dd>
<dt>in</dt>
<dd><p class="first last">variables with coproc-specific names.
George Dimitriu explains,
&quot;... coproc ... is a feature used in Bash process substitution,
which now is made publicly available.&quot;
This means it can be explicitly invoked in a script, rather than
just being a behind-the-scenes mechanism used by Bash.
See</p>
</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/bashver4.ca.rst</tt>, line 191)</p>
<p>Definition list ends without a blank line; unexpected unindent.</p>
</div>
<p><a class="reference external" href="http://linux010.blogspot.com/2008/12/bash-process-substitution.html">http://linux010.blogspot.com/2008/12/bash-process-substitution.html</a>.</p>
</blockquote>
<p>Coprocesses use <em>file descriptors</em>. <a class="reference external" href="io-redirection.html#FDREF2">File descriptors enable
processes and pipes to communicate</a>.</p>
<pre class="literal-block">
#!/bin/bash4
# A coprocess communicates with a while-read loop.


coproc { cat mx_data.txt; sleep 2; }
#                         ^^^^^^^
# Try running this without &quot;sleep 2&quot; and see what happens.

while read -u ${COPROC[0]} line    #  ${COPROC[0]} is the
do                                 #+ file descriptor of the coprocess.
  echo &quot;$line&quot; | sed -e 's/line/NOT-ORIGINAL-TEXT/'
done

kill $COPROC_PID                   #  No longer need the coprocess,
                                   #+ so kill its PID.
</pre>
<p>But, be careful!</p>
<pre class="literal-block">
#!/bin/bash4

echo; echo
a=aaa
b=bbb
c=ccc

coproc echo &quot;one two three&quot;
while read -u ${COPROC[0]} a b c;  #  Note that this loop
do                                 #+ runs in a subshell.
  echo &quot;Inside while-read loop: &quot;;
  echo &quot;a = $a&quot;; echo &quot;b = $b&quot;; echo &quot;c = $c&quot;
  echo &quot;coproc file descriptor: ${COPROC[0]}&quot;
done

# a = one
# b = two
# c = three
# So far, so good, but ...

echo &quot;-----------------&quot;
echo &quot;Outside while-read loop: &quot;
echo &quot;a = $a&quot;  # a =
echo &quot;b = $b&quot;  # b =
echo &quot;c = $c&quot;  # c =
echo &quot;coproc file descriptor: ${COPROC[0]}&quot;
echo
#  The coproc is still running, but ...
#+ it still doesn't enable the parent process
#+ to &quot;inherit&quot; variables from the child process, the while-read loop.

#  Compare this to the &quot;badread.sh&quot; script.
</pre>
<div class="figure align-center">
<img alt="Caution" src="http://tldp.org/LDP/abs/images/caution.gif" />
<p class="caption">Caution</p>
</div>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/bashver4.ca.rst</tt>, line 256)</p>
<p>Explicit markup ends without a blank line; unexpected unindent.</p>
</div>
<p>The coprocess is <em>asynchronous</em>, and this might cause a problem. It
may terminate before another process has finished communicating with
it.</p>
<pre class="literal-block">
#!/bin/bash4

coproc cpname { for i in {0..10}; do echo &quot;index = $i&quot;; done; }
#      ^^^^^^ This is a *named* coprocess.
read -u ${cpname[0]}
echo $REPLY         #  index = 0
echo ${COPROC[0]}   #+ No output ... the coprocess timed out
#  after the first loop iteration.



# However, George Dimitriu has a partial fix.

coproc cpname { for i in {0..10}; do echo &quot;index = $i&quot;; done; sleep 1;
echo hi &gt; myo; cat - &gt;&gt; myo; }
#       ^^^^^ This is a *named* coprocess.

echo &quot;I am main&quot;$'\04' &gt;&amp;${cpname[1]}
myfd=${cpname[0]}
echo myfd=$myfd

### while read -u $myfd
### do
###   echo $REPLY;
### done

echo $cpname_PID

#  Run this with and without the commented-out while-loop, and it is
#+ apparent that each process, the executing shell and the coprocess,
#+ waits for the other to finish writing in its own write-enabled pipe.
</pre>
</li>
<li><p class="first">The new <strong>mapfile</strong> builtin makes it possible to load an array with
the contents of a text file without using a loop or <a class="reference external" href="arrays.html#ARRAYINITCS">command
substitution</a>.</p>
<pre class="literal-block">
#!/bin/bash4

mapfile Arr1 &lt; $0
# Same result as     Arr1=( $(cat $0) )
echo &quot;${Arr1[&#64;]}&quot;  # Copies this entire script out to stdout.

echo &quot;--&quot;; echo

# But, not the same as   read -a   !!!
read -a Arr2 &lt; $0
echo &quot;${Arr2[&#64;]}&quot;  # Reads only first line of script into the array.

exit
</pre>
</li>
<li><p class="first">The <a class="reference external" href="internal.html#READREF">read</a> builtin got a minor facelift. The
<tt class="docutils literal"><span class="pre">-t</span></tt> <a class="reference external" href="internal.html#READTIMED">timeout</a> option now accepts
(decimal) fractional values <a class="reference external" href="bashver4.html#FTN.AEN20904">[3]</a> and
the <tt class="docutils literal"><span class="pre">-i</span></tt> option permits preloading the edit buffer.
<a class="reference external" href="bashver4.html#FTN.AEN20909">[4]</a> Unfortunately, these enhancements
are still a work in progress and not (yet) usable in scripts.</p>
</li>
<li><p class="first"><a class="reference external" href="parameter-substitution.html#PARAMSUBREF">Parameter substitution</a>
gets <em>case-modification</em> operators.</p>
<pre class="literal-block">
#!/bin/bash4

var=veryMixedUpVariable
echo ${var}            # veryMixedUpVariable
echo ${var^}           # VeryMixedUpVariable
#         *              First char --&gt; uppercase.
echo ${var^^}          # VERYMIXEDUPVARIABLE
#         **             All chars  --&gt; uppercase.
echo ${var,}           # veryMixedUpVariable
#         *              First char --&gt; lowercase.
echo ${var,,}          # verymixedupvariable
#         **             All chars  --&gt; lowercase.
</pre>
</li>
<li><p class="first">The <a class="reference external" href="declareref.html">declare</a> builtin now accepts the <tt class="docutils literal"><span class="pre">-l</span></tt>
<em>lowercase</em> and <tt class="docutils literal"><span class="pre">-c</span></tt> <em>capitalize</em> options.</p>
<pre class="literal-block">
#!/bin/bash4

declare -l var1            # Will change to lowercase
var1=MixedCaseVARIABLE
echo &quot;$var1&quot;               # mixedcasevariable
# Same effect as             echo $var1 | tr A-Z a-z

declare -c var2            # Changes only initial char to uppercase.
var2=originally_lowercase
echo &quot;$var2&quot;               # Originally_lowercase
# NOT the same effect as     echo $var2 | tr a-z A-Z
</pre>
</li>
<li><p class="first"><a class="reference external" href="special-chars.html#BRACEEXPREF">Brace expansion</a> has more options.</p>
<p><em>Increment/decrement</em>, specified in the final term within braces.</p>
<pre class="literal-block">
#!/bin/bash4

echo {40..60..2}
# 40 42 44 46 48 50 52 54 56 58 60
# All the even numbers, between 40 and 60.

echo {60..40..2}
# 60 58 56 54 52 50 48 46 44 42 40
# All the even numbers, between 40 and 60, counting backwards.
# In effect, a decrement.
echo {60..40..-2}
# The same output. The minus sign is not necessary.

# But, what about letters and symbols?
echo {X..d}
# X Y Z [  ] ^ _ ` a b c d
# Does not echo the \ which escapes a space.
</pre>
<p><em>Zero-padding</em>, specified in the first term within braces, prefixes
each term in the output with the <em>same number</em> of zeroes.</p>
<pre class="literal-block">
bash4$ echo {010..15}
010 011 012 013 014 015


bash4$ echo {000..10}
000 001 002 003 004 005 006 007 008 009 010
</pre>
</li>
<li><p class="first"><a class="reference external" href="bashver4.html#SUBSTREXTREF4">*Substring extraction* on *positional
parameters*</a> now starts with
<a class="reference external" href="othertypesv.html#SCRNAMEPARAM">$0</a> as the <em>zero-index</em>. (This
corrects an inconsistency in the treatment of positional parameters.)</p>
<pre class="literal-block">
#!/bin/bash
# show-params.bash
# Requires version 4+ of Bash.

# Invoke this scripts with at least one positional parameter.

E_BADPARAMS=99

if [ -z &quot;$1&quot; ]
then
  echo &quot;Usage $0 param1 ...&quot;
  exit $E_BADPARAMS
fi

echo ${&#64;:0}

# bash3 show-params.bash4 one two three
# one two three

# bash4 show-params.bash4 one two three
# show-params.bash4 one two three

# $0                $1  $2  $3
</pre>
</li>
<li><p class="first">The new ** <a class="reference external" href="globbingref.html">globbing</a> operator matches
filenames and directories
<a class="reference external" href="localvar.html#RECURSIONREF0">recursively</a>.</p>
<pre class="literal-block">
#!/bin/bash4
# filelist.bash4

shopt -s globstar  # Must enable globstar, otherwise ** doesn't work.
                   # The globstar shell option is new to version 4 of Bash.

echo &quot;Using *&quot;; echo
for filename in *
do
  echo &quot;$filename&quot;
done   # Lists only files in current directory ($PWD).

echo; echo &quot;--------------&quot;; echo

echo &quot;Using **&quot;
for filename in **
do
  echo &quot;$filename&quot;
done   # Lists complete file tree, recursively.

exit

Using *

allmyfiles
filelist.bash4

--------------

Using **

allmyfiles
allmyfiles/file.index.txt
allmyfiles/my_music
allmyfiles/my_music/me-singing-60s-folksongs.ogg
allmyfiles/my_music/me-singing-opera.ogg
allmyfiles/my_music/piano-lesson.1.ogg
allmyfiles/my_pictures
allmyfiles/my_pictures/at-beach-with-Jade.png
allmyfiles/my_pictures/picnic-with-Melissa.png
filelist.bash4
</pre>
</li>
<li><p class="first">The new <a class="reference external" href="internalvariables.html#BASHPIDREF">$BASHPID</a> internal
variable.</p>
</li>
<li><p class="first">There is a new <a class="reference external" href="internal.html#BUILTINREF">builtin</a> error-handling
function named <strong>command_not_found_handle</strong>.</p>
<pre class="literal-block">
#!/bin/bash4

command_not_found_handle ()
{ # Accepts implicit parameters.
  echo &quot;The following command is not valid: \&quot;&quot;$1\&quot;&quot;&quot;
  echo &quot;With the following argument(s): \&quot;&quot;$2\&quot;&quot; \&quot;&quot;$3\&quot;&quot;&quot;   # $4, $5 ...
} # $1, $2, etc. are not explicitly passed to the function.

bad_command arg1 arg2

# The following command is not valid: &quot;bad_command&quot;
# With the following argument(s): &quot;arg1&quot; &quot;arg2&quot;
</pre>
</li>
</ul>
<p><em>Editorial comment</em></p>
<p>Associative arrays? Coprocesses? Whatever happened to the lean and mean
Bash we have come to know and love? Could it be suffering from
(horrors!) &quot;feature creep&quot;? Or perhaps even Korn shell envy?</p>
<p><em>Note to Chet Ramey:</em> Please add only <em>essential</em> features in future
Bash releases -- perhaps <em>for-each</em> loops and support for
multi-dimensional arrays. <a class="reference external" href="bashver4.html#FTN.AEN20987">[5]</a> Most Bash
users won't need, won't use, and likely won't greatly appreciate complex
&quot;features&quot; like built-in debuggers, Perl interfaces, and bolt-on rocket
boosters.</p>
<div class="section" id="bash-version-4-1">
<h2>37.3.1. Bash, version 4.1</h2>
<p>Version 4.1 of Bash, released in May, 2010, was primarily a bugfix
update.</p>
<ul>
<li><p class="first">The <a class="reference external" href="internal.html#PRINTFREF">printf</a> command now accepts a <tt class="docutils literal"><span class="pre">-v</span></tt>
option for setting <a class="reference external" href="arrays.html#ARRAYREF">array</a> indices.</p>
</li>
<li><p class="first">Within <a class="reference external" href="testconstructs.html#DBLBRACKETS">double brackets</a>, the
<strong>&gt;</strong> and <strong>&lt;</strong> string comparison operators now conform to the
<a class="reference external" href="localization.html#LOCALEREF">locale</a>. Since the locale setting may
affect the sorting order of string expressions, this has side-effects
on comparison tests within <em>[[ ... ]]</em> expressions.</p>
</li>
<li><p class="first">The <a class="reference external" href="internal.html#READREF">read</a> builtin now takes a <tt class="docutils literal"><span class="pre">-N</span></tt> option
(<em>read -N chars</em>), which causes the <em>read</em> to terminate after <em>chars</em>
characters.</p>
<p><strong>Example 37-8. Reading N characters</strong></p>
<pre class="literal-block">
#!/bin/bash
# Requires Bash version -ge 4.1 ...

num_chars=61

read -N $num_chars var &lt; $0   # Read first 61 characters of script!
echo &quot;$var&quot;
exit

####### Output of Script #######

#!/bin/bash
# Requires Bash version -ge 4.1 ...

num_chars=61
</pre>
</li>
<li><p class="first"><a class="reference external" href="here-docs.html#HEREDOCREF">Here documents</a> embedded in
<tt class="docutils literal">`$( ... )</tt> command
substitution &lt;varassignment.html#COMMANDSUBREF0&gt;`_ constructs may
terminate with a simple <strong>)</strong>.</p>
<p><strong>Example 37-9. Using a *here document* to set a variable</strong></p>
<pre class="literal-block">
#!/bin/bash
# here-commsub.sh
# Requires Bash version -ge 4.1 ...

multi_line_var=$( cat &lt;&lt;ENDxxx
------------------------------
This is line 1 of the variable
This is line 2 of the variable
This is line 3 of the variable
------------------------------
ENDxxx)

#  Rather than what Bash 4.0 requires:
#+ that the terminating limit string and
#+ the terminating close-parenthesis be on separate lines.

# ENDxxx
# )


echo &quot;$multi_line_var&quot;

#  Bash still emits a warning, though.
#  warning: here-document at line 10 delimited
#+ by end-of-file (wanted `ENDxxx')
</pre>
</li>
</ul>
</div>
<div class="section" id="bash-version-4-2">
<h2>37.3.2. Bash, version 4.2</h2>
<p>Version 4.2 of Bash, released in February, 2011, contains a number of
new features and enhancements, in addition to bugfixes.</p>
<ul>
<li><p class="first">Bash now supports the the <tt class="docutils literal">\u</tt> and <tt class="docutils literal">\U</tt> <em>Unicode</em> escape.</p>
<p>Unicode is a cross-platform standard for encoding into numerical
values letters and graphic symbols. This permits representing and
displaying characters in foreign alphabets and unusual fonts.</p>
<pre class="literal-block">
echo -e '\u2630'   # Horizontal triple bar character.
# Equivalent to the more roundabout:
echo -e &quot;\xE2\x98\xB0&quot;
                   # Recognized by earlier Bash versions.

echo -e '\u220F'   # PI (Greek letter and mathematical symbol)
echo -e '\u0416'   # Capital &quot;ZHE&quot; (Cyrillic letter)
echo -e '\u2708'   # Airplane (Dingbat font) symbol

echo -e &quot;The amplifier circuit requires a 100 \u2126 pull-up resistor.&quot;


unicode_var='\u2640'
echo -e $unicode_var      # Female symbol
printf &quot;$unicode_var \n&quot;  # Female symbol, with newline


#  And for something a bit more elaborate . . .

#  We can store Unicode symbols in an associative array,
#+ then retrieve them by name.
#  Run this in a gnome-terminal or a terminal with a large, bold font
#+ for better legibility.

declare -A symbol  # Associative array.

symbol[script_E]='\u2130'
symbol[script_F]='\u2131'
symbol[script_J]='\u2110'
symbol[script_M]='\u2133'
symbol[Rx]='\u211E'
symbol[TEL]='\u2121'
symbol[FAX]='\u213B'
symbol[care_of]='\u2105'
symbol[account]='\u2100'
symbol[trademark]='\u2122'


echo -ne &quot;${symbol[script_E]}   &quot;
echo -ne &quot;${symbol[script_F]}   &quot;
echo -ne &quot;${symbol[script_J]}   &quot;
echo -ne &quot;${symbol[script_M]}   &quot;
echo -ne &quot;${symbol[Rx]}   &quot;
echo -ne &quot;${symbol[TEL]}   &quot;
echo -ne &quot;${symbol[FAX]}   &quot;
echo -ne &quot;${symbol[care_of]}   &quot;
echo -ne &quot;${symbol[account]}   &quot;
echo -ne &quot;${symbol[trademark]}   &quot;
echo
</pre>
<div class="figure align-center">
<img alt="Note" src="http://tldp.org/LDP/abs/images/note.gif" />
<p class="caption">Note</p>
</div>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/bashver4.ca.rst</tt>, line 655)</p>
<p>Explicit markup ends without a blank line; unexpected unindent.</p>
</div>
<p>The above example uses the <a class="reference external" href="escapingsection.html#STRQ">**$' ...
'**</a> <em>string-expansion</em> construct.</p>
</li>
<li><p class="first">When the <tt class="docutils literal">lastpipe</tt> shell option is set, the last command in a
<a class="reference external" href="special-chars.html#PIPEREF">pipe</a> <em>doesn't run in a subshell</em>.</p>
<p><strong>Example 37-10. Piping input to a `read &lt;internal.html#READREF&gt;`_</strong></p>
<pre class="literal-block">
#!/bin/bash
# lastpipe-option.sh

line=''                   # Null value.
echo &quot;\$line = &quot;$line&quot;&quot;   # $line =

echo

shopt -s lastpipe         # Error on Bash version -lt 4.2.
echo &quot;Exit status of attempting to set \&quot;lastpipe\&quot; option is $?&quot;
#     1 if Bash version -lt 4.2, 0 otherwise.

echo

head -1 $0 | read line    # Pipe the first line of the script to read.
#            ^^^^^^^^^      Not in a subshell!!!

echo &quot;\$line = &quot;$line&quot;&quot;
# Older Bash releases       $line =
# Bash version 4.2          $line = #!/bin/bash
</pre>
<p>This option offers possible &quot;fixups&quot; for these example scripts:
<a class="reference external" href="gotchas.html#BADREAD">Example 34-3</a> and <a class="reference external" href="internal.html#READPIPE">Example
15-8</a>.</p>
</li>
<li><p class="first">Negative <a class="reference external" href="arrays.html#ARRAYREF">array</a> indices permit counting
backwards from the end of an array.</p>
<p><strong>Example 37-11. Negative array indices</strong></p>
<pre class="literal-block">
#!/bin/bash
# neg-array.sh
# Requires Bash, version -ge 4.2.

array=( zero one two three four five )   # Six-element array.
#         0    1   2    3    4    5
#        -6   -5  -4   -3   -2   -1

# Negative array indices now permitted.
echo ${array[-1]}   # five
echo ${array[-2]}   # four
# ...
echo ${array[-6]}   # zero
# Negative array indices count backward from the last element+1.

# But, you cannot index past the beginning of the array.
echo ${array[-7]}   # array: bad array subscript


# So, what is this new feature good for?

echo &quot;The last element in the array is &quot;${array[-1]}&quot;&quot;
# Which is quite a bit more straightforward than:
echo &quot;The last element in the array is &quot;${array[${#array[*]}-1]}&quot;&quot;
echo

# And ...

index=0
let &quot;neg_element_count = 0 - ${#array[*]}&quot;
# Number of elements, converted to a negative number.

while [ $index -gt $neg_element_count ]; do
  ((index--)); echo -n &quot;${array[index]} &quot;
done  # Lists the elements in the array, backwards.
      # We have just simulated the &quot;tac&quot; command on this array.

echo

# See also neg-offset.sh.
</pre>
</li>
<li><p class="first"><a class="reference external" href="string-manipulation.html#SUBSTREXTR01">Substring extraction</a> uses
a negative <em>length</em> parameter to specify an offset from the <em>end</em> of
the target string.</p>
<p><strong>Example 37-12. Negative parameter in string-extraction construct</strong></p>
<pre class="literal-block">
#!/bin/bash
# Bash, version -ge 4.2
# Negative length-index in substring extraction.
# Important: It changes the interpretation of this construct!

stringZ=abcABC123ABCabc

echo ${stringZ}                              # abcABC123ABCabc
#                   Position within string:    0123456789.....
echo ${stringZ:2:3}                          #   cAB
#  Count 2 chars forward from string beginning, and extract 3 chars.
#  ${string:position:length}

#  So far, nothing new, but now ...

                                             # abcABC123ABCabc
#                   Position within string:    0123....6543210
echo ${stringZ:3:-6}                         #    ABC123
#                ^
#  Index 3 chars forward from beginning and 6 chars backward from end,
#+ and extract everything in between.
#  ${string:offset-from-front:offset-from-end}
#  When the &quot;length&quot; parameter is negative,
#+ it serves as an offset-from-end parameter.

#  See also neg-array.sh.
</pre>
</li>
</ul>
<div class="section" id="notes">
<h3>Notes</h3>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/bashver4.ca.rst</tt>, line 10); <em><a href="#id10">backlink</a></em></p>
Duplicate explicit target name: &quot;[1]&quot;.</div>
<p><a class="reference external" href="bashver4.html#AEN20834">[1]</a></p>
<p>To be more specific, Bash 4+ has <em>limited</em> support for associative
arrays. It's a bare-bones implementation, and it lacks the much of the
functionality of such arrays in other programming languages.</p>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/bashver4.ca.rst</tt>, line 10); <em><a href="#id11">backlink</a></em></p>
Duplicate explicit target name: &quot;[2]&quot;.</div>
<p><a class="reference external" href="bashver4.html#AEN20876">[2]</a></p>
<p>Copyright 1995-2009 by Chester Ramey.</p>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/bashver4.ca.rst</tt>, line 10); <em><a href="#id12">backlink</a></em></p>
Duplicate explicit target name: &quot;[3]&quot;.</div>
<p><a class="reference external" href="bashver4.html#AEN20904">[3]</a></p>
<p>This only works with <a class="reference external" href="special-chars.html#PIPEREF">pipes</a> and certain
other <em>special</em> files.</p>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/bashver4.ca.rst</tt>, line 10); <em><a href="#id13">backlink</a></em></p>
Duplicate explicit target name: &quot;[4]&quot;.</div>
<p><a class="reference external" href="bashver4.html#AEN20909">[4]</a></p>
<p>But only in conjunction with <a class="reference external" href="internal.html#READLINEREF">readline</a>,
i.e., from the command-line.</p>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/bashver4.ca.rst</tt>, line 10); <em><a href="#id14">backlink</a></em></p>
Duplicate explicit target name: &quot;[5]&quot;.</div>
<p><a class="reference external" href="bashver4.html#AEN20987">[5]</a></p>
<p>And while you're at it, consider fixing the notorious <a class="reference external" href="internal.html#PIPEREADREF0">piped
read</a> problem.</p>
<hr class="docutils" />
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="31%" />
<col width="35%" />
</colgroup>
<tbody valign="top">
<tr><td><a class="reference external" href="bashver3.html">Prev</a></td>
<td><a class="reference external" href="index.html">Home</a></td>
<td><a class="reference external" href="endnotes.html">Next</a></td>
</tr>
<tr><td>Bash, version 3</td>
<td><a class="reference external" href="bash2.html">Up</a></td>
<td>Endnotes</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</body>
</html>
