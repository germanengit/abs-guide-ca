<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.8.1: http://docutils.sourceforge.net/" />
<title></title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7056 2011-06-17 10:50:48Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">rst-ca/complexfunct.ca.rst</tt>, line 1)</p>
<p>Malformed table.</p>
<pre class="literal-block">
+----------------------------------+-------------------------+---------------------------+
| Advanced Bash-Scripting Guide:   |
+==================================+=========================+===========================+
| `Prev &lt;functions.html&gt;`_         | Chapter 24. Functions   | `Next &lt;localvar.html&gt;`_   |
+----------------------------------+-------------------------+---------------------------+
</pre>
</div>
<hr class="docutils" />
<div class="section" id="complex-functions-and-function-complexities">
<h1>24.1. Complex Functions and Function Complexities</h1>
<p>Functions may process arguments passed to them and return an <a class="reference external" href="exit-status.html#EXITSTATUSREF">exit
status</a> to the script for further
processing.</p>
<pre class="literal-block">
function_name $arg1 $arg2
</pre>
<p>The function refers to the passed arguments by position (as if they were
<a class="reference external" href="internalvariables.html#POSPARAMREF">positional parameters</a>), that is,
<tt class="docutils literal">$1</tt>, <tt class="docutils literal">$2</tt>, and so forth.</p>
<p><strong>Example 24-2. Function Taking Parameters</strong></p>
<pre class="literal-block">
#!/bin/bash
# Functions and parameters

DEFAULT=default                             # Default param value.

func2 () {
   if [ -z &quot;$1&quot; ]                           # Is parameter #1 zero length?
   then
     echo &quot;-Parameter #1 is zero length.-&quot;  # Or no parameter passed.
   else
     echo &quot;-Param #1 is \&quot;$1\&quot;.-&quot;
   fi

   variable=${1-$DEFAULT}                   #  What does
   echo &quot;variable = $variable&quot;              #+ parameter substitution show?
                                            #  ---------------------------
                                            #  It distinguishes between
                                            #+ no param and a null param.

   if [ &quot;$2&quot; ]
   then
     echo &quot;-Parameter #2 is \&quot;$2\&quot;.-&quot;
   fi

   return 0
}

echo

echo &quot;Nothing passed.&quot;
func2                          # Called with no params
echo


echo &quot;Zero-length parameter passed.&quot;
func2 &quot;&quot;                       # Called with zero-length param
echo

echo &quot;Null parameter passed.&quot;
func2 &quot;$uninitialized_param&quot;   # Called with uninitialized param
echo

echo &quot;One parameter passed.&quot;
func2 first           # Called with one param
echo

echo &quot;Two parameters passed.&quot;
func2 first second    # Called with two params
echo

echo &quot;\&quot;\&quot; \&quot;second\&quot; passed.&quot;
func2 &quot;&quot; second       # Called with zero-length first parameter
echo                  # and ASCII string as a second one.

exit 0
</pre>
<div class="figure align-center">
<img alt="Important" src="http://tldp.org/LDP/abs/images/important.gif" />
<p class="caption">Important</p>
</div>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/complexfunct.ca.rst</tt>, line 89)</p>
Explicit markup ends without a blank line; unexpected unindent.</div>
<p>The <a class="reference external" href="othertypesv.html#SHIFTREF">shift</a> command works on arguments
passed to functions (see <a class="reference external" href="assortedtips.html#MULTIPLICATION">Example
36-16</a>).</p>
<p>But, what about command-line arguments passed to the script? Does a
function see them? Well, let's clear up the confusion.</p>
<p><strong>Example 24-3. Functions and command-line args passed to the script</strong></p>
<pre class="literal-block">
#!/bin/bash
# func-cmdlinearg.sh
#  Call this script with a command-line argument,
#+ something like $0 arg1.


func ()

{
echo &quot;$1&quot;   # Echoes first arg passed to the function.
}           # Does a command-line arg qualify?

echo &quot;First call to function: no arg passed.&quot;
echo &quot;See if command-line arg is seen.&quot;
func
# No! Command-line arg not seen.

echo &quot;============================================================&quot;
echo
echo &quot;Second call to function: command-line arg passed explicitly.&quot;
func $1
# Now it's seen!

exit 0
</pre>
<p>In contrast to certain other programming languages, shell scripts
normally pass only value parameters to functions. Variable names (which
are actually <em>pointers</em>), if passed as parameters to functions, will be
treated as string literals. <em>Functions interpret their arguments
literally.</em></p>
<p><a class="reference external" href="ivr.html#IVRREF">Indirect variable references</a> (see <a class="reference external" href="bashver2.html#EX78">Example
37-2</a>) provide a clumsy sort of mechanism for
passing variable pointers to functions.</p>
<p><strong>Example 24-4. Passing an indirect reference to a function</strong></p>
<pre class="literal-block">
#!/bin/bash
# ind-func.sh: Passing an indirect reference to a function.

echo_var ()
{
echo &quot;$1&quot;
}

message=Hello
Hello=Goodbye

echo_var &quot;$message&quot;        # Hello
# Now, let's pass an indirect reference to the function.
echo_var &quot;${!message}&quot;     # Goodbye

echo &quot;-------------&quot;

# What happens if we change the contents of &quot;hello&quot; variable?
Hello=&quot;Hello, again!&quot;
echo_var &quot;$message&quot;        # Hello
echo_var &quot;${!message}&quot;     # Hello, again!

exit 0
</pre>
<p>The next logical question is whether parameters can be dereferenced
<em>after</em> being passed to a function.</p>
<p><strong>Example 24-5. Dereferencing a parameter passed to a function</strong></p>
<pre class="literal-block">
#!/bin/bash
# dereference.sh
# Dereferencing parameter passed to a function.
# Script by Bruce W. Clare.

dereference ()
{
     y=\$&quot;$1&quot;   # Name of variable (not value!).
     echo $y    # $Junk

     x=`eval &quot;expr \&quot;$y\&quot; &quot;`
     echo $1=$x
     eval &quot;$1=\&quot;Some Different Text \&quot;&quot;  # Assign new value.
}

Junk=&quot;Some Text&quot;
echo $Junk &quot;before&quot;    # Some Text before

dereference Junk
echo $Junk &quot;after&quot;     # Some Different Text after

exit 0
</pre>
<p><strong>Example 24-6. Again, dereferencing a parameter passed to a function</strong></p>
<pre class="literal-block">
#!/bin/bash
# ref-params.sh: Dereferencing a parameter passed to a function.
#                (Complex Example)

ITERATIONS=3  # How many times to get input.
icount=1

my_read () {
  #  Called with my_read varname,
  #+ outputs the previous value between brackets as the default value,
  #+ then asks for a new value.

  local local_var

  echo -n &quot;Enter a value &quot;
  eval 'echo -n &quot;[$'$1'] &quot;'  #  Previous value.
# eval echo -n &quot;[\$$1] &quot;     #  Easier to understand,
                             #+ but loses trailing space in user prompt.
  read local_var
  [ -n &quot;$local_var&quot; ] &amp;&amp; eval $1=\$local_var

  # &quot;And-list&quot;: if &quot;local_var&quot; then set &quot;$1&quot; to its value.
}

echo

while [ &quot;$icount&quot; -le &quot;$ITERATIONS&quot; ]
do
  my_read var
  echo &quot;Entry #$icount = $var&quot;
  let &quot;icount += 1&quot;
  echo
done


# Thanks to Stephane Chazelas for providing this instructive example.

exit 0
</pre>
<p><strong>Exit and Return</strong></p>
<dl class="docutils">
<dt><strong>exit status</strong></dt>
<dd>Functions return a value, called an <em>exit status</em>. This is analogous
to the <a class="reference external" href="exit-status.html#EXITSTATUSREF">exit status</a> returned by a
command. The exit status may be explicitly specified by a <strong>return</strong>
statement, otherwise it is the exit status of the last command in
the function (0 if successful, and a non-zero error code if not).
This <a class="reference external" href="exit-status.html#EXITSTATUSREF">exit status</a> may be used in
the script by referencing it as
<a class="reference external" href="internalvariables.html#XSTATVARREF">$?</a>. This mechanism
effectively permits script functions to have a &quot;return value&quot;
similar to C functions.</dd>
</dl>
<p><strong>return</strong></p>
<blockquote>
<p>Terminates a function. A <strong>return</strong> command
<a class="reference external" href="complexfunct.html#FTN.AEN18337">[1]</a> optionally takes an
<em>integer</em> argument, which is returned to the calling script as the
&quot;exit status&quot; of the function, and this exit status is assigned to
the variable <a class="reference external" href="internalvariables.html#XSTATVARREF">$?</a>.</p>
<p><strong>Example 24-7. Maximum of two numbers</strong></p>
<pre class="literal-block">
#!/bin/bash
# max.sh: Maximum of two integers.

E_PARAM_ERR=250    # If less than 2 params passed to function.
EQUAL=251          # Return value if both params equal.
#  Error values out of range of any
#+ params that might be fed to the function.

max2 ()             # Returns larger of two numbers.
{                   # Note: numbers compared must be less than 250.
if [ -z &quot;$2&quot; ]
then
  return $E_PARAM_ERR
fi

if [ &quot;$1&quot; -eq &quot;$2&quot; ]
then
  return $EQUAL
else
  if [ &quot;$1&quot; -gt &quot;$2&quot; ]
  then
    return $1
  else
    return $2
  fi
fi
}

max2 33 34
return_val=$?

if [ &quot;$return_val&quot; -eq $E_PARAM_ERR ]
then
  echo &quot;Need to pass two parameters to the function.&quot;
elif [ &quot;$return_val&quot; -eq $EQUAL ]
  then
    echo &quot;The two numbers are equal.&quot;
else
    echo &quot;The larger of the two numbers is $return_val.&quot;
fi


exit 0

#  Exercise (easy):
#  ---------------
#  Convert this to an interactive script,
#+ that is, have the script ask for input (two numbers).
</pre>
<div class="figure align-center">
<img alt="Tip" src="http://tldp.org/LDP/abs/images/tip.gif" />
<p class="caption">Tip</p>
</div>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/complexfunct.ca.rst</tt>, line 316)</p>
Explicit markup ends without a blank line; unexpected unindent.</div>
<p>For a function to return a string or array, use a dedicated
variable.</p>
<pre class="literal-block">
count_lines_in_etc_passwd()
{
  [[ -r /etc/passwd ]] &amp;&amp; REPLY=$(echo $(wc -l &lt; /etc/passwd))
  #  If /etc/passwd is readable, set REPLY to line count.
  #  Returns both a parameter value and status information.
  #  The 'echo' seems unnecessary, but . . .
  #+ it removes excess whitespace from the output.
}

if count_lines_in_etc_passwd
then
  echo &quot;There are $REPLY lines in /etc/passwd.&quot;
else
  echo &quot;Cannot count lines in /etc/passwd.&quot;
fi

# Thanks, S.C.
</pre>
<p><strong>Example 24-8. Converting numbers to Roman numerals</strong></p>
<pre class="literal-block">
#!/bin/bash

# Arabic number to Roman numeral conversion
# Range: 0 - 200
# It's crude, but it works.

# Extending the range and otherwise improving the script is left as an exercise.

# Usage: roman number-to-convert

LIMIT=200
E_ARG_ERR=65
E_OUT_OF_RANGE=66

if [ -z &quot;$1&quot; ]
then
  echo &quot;Usage: `basename $0` number-to-convert&quot;
  exit $E_ARG_ERR
fi

num=$1
if [ &quot;$num&quot; -gt $LIMIT ]
then
  echo &quot;Out of range!&quot;
  exit $E_OUT_OF_RANGE
fi

to_roman ()   # Must declare function before first call to it.
{
number=$1
factor=$2
rchar=$3
let &quot;remainder = number - factor&quot;
while [ &quot;$remainder&quot; -ge 0 ]
do
  echo -n $rchar
  let &quot;number -= factor&quot;
  let &quot;remainder = number - factor&quot;
done

return $number
       # Exercises:
       # ---------
       # 1) Explain how this function works.
       #    Hint: division by successive subtraction.
       # 2) Extend to range of the function.
       #    Hint: use &quot;echo&quot; and command-substitution capture.
}


to_roman $num 100 C
num=$?
to_roman $num 90 LXXXX
num=$?
to_roman $num 50 L
num=$?
to_roman $num 40 XL
num=$?
to_roman $num 10 X
num=$?
to_roman $num 9 IX
num=$?
to_roman $num 5 V
num=$?
to_roman $num 4 IV
num=$?
to_roman $num 1 I
# Successive calls to conversion function!
# Is this really necessary??? Can it be simplified?

echo

exit
</pre>
<p>See also <a class="reference external" href="testbranch.html#ISALPHA">Example 11-28</a>.</p>
<div class="figure align-center">
<img alt="Important" src="http://tldp.org/LDP/abs/images/important.gif" />
<p class="caption">Important</p>
</div>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/complexfunct.ca.rst</tt>, line 424)</p>
Explicit markup ends without a blank line; unexpected unindent.</div>
<p>The largest positive integer a function can return is 255. The
<strong>return</strong> command is closely tied to the concept of <a class="reference external" href="exit-status.html#EXITSTATUSREF">exit
status</a>, which accounts for this
particular limitation. Fortunately, there are various
<a class="reference external" href="assortedtips.html#RVT">workarounds</a> for those situations
requiring a large integer return value from a function.</p>
<p><strong>Example 24-9. Testing large return values in a function</strong></p>
<pre class="literal-block">
#!/bin/bash
# return-test.sh

# The largest positive value a function can return is 255.

return_test ()         # Returns whatever passed to it.
{
  return $1
}

return_test 27         # o.k.
echo $?                # Returns 27.

return_test 255        # Still o.k.
echo $?                # Returns 255.

return_test 257        # Error!
echo $?                # Returns 1 (return code for miscellaneous error).

# ======================================================
return_test -151896    # Do large negative numbers work?
echo $?                # Will this return -151896?
                       # No! It returns 168.
#  Version of Bash before 2.05b permitted
#+ large negative integer return values.
#  Newer versions of Bash plug this loophole.
#  This may break older scripts.
#  Caution!
# ======================================================

exit 0
</pre>
<p>A workaround for obtaining large integer &quot;return values&quot; is to
simply assign the &quot;return value&quot; to a global variable.</p>
<pre class="literal-block">
Return_Val=   # Global variable to hold oversize return value of function.

alt_return_test ()
{
  fvar=$1
  Return_Val=$fvar
  return   # Returns 0 (success).
}

alt_return_test 1
echo $?                              # 0
echo &quot;return value = $Return_Val&quot;    # 1

alt_return_test 256
echo &quot;return value = $Return_Val&quot;    # 256

alt_return_test 257
echo &quot;return value = $Return_Val&quot;    # 257

alt_return_test 25701
echo &quot;return value = $Return_Val&quot;    #25701
</pre>
<p>A more elegant method is to have the function <strong>echo</strong> its &quot;return
value to <tt class="docutils literal">stdout</tt>,&quot; and then capture it by <a class="reference external" href="commandsub.html#COMMANDSUBREF">command
substitution</a>. See the <a class="reference external" href="assortedtips.html#RVT">discussion
of this</a> in <a class="reference external" href="assortedtips.html">Section
36.7</a>.</p>
<p><strong>Example 24-10. Comparing two large integers</strong></p>
<pre class="literal-block">
#!/bin/bash
# max2.sh: Maximum of two LARGE integers.

#  This is the previous &quot;max.sh&quot; example,
#+ modified to permit comparing large integers.

EQUAL=0             # Return value if both params equal.
E_PARAM_ERR=-99999  # Not enough params passed to function.
#           ^^^^^^    Out of range of any params that might be passed.

max2 ()             # &quot;Returns&quot; larger of two numbers.
{
if [ -z &quot;$2&quot; ]
then
  echo $E_PARAM_ERR
  return
fi

if [ &quot;$1&quot; -eq &quot;$2&quot; ]
then
  echo $EQUAL
  return
else
  if [ &quot;$1&quot; -gt &quot;$2&quot; ]
  then
    retval=$1
  else
    retval=$2
  fi
fi

echo $retval        # Echoes (to stdout), rather than returning value.
                    # Why?
}


return_val=$(max2 33001 33997)
#            ^^^^             Function name
#                 ^^^^^ ^^^^^ Params passed
#  This is actually a form of command substitution:
#+ treating a function as if it were a command,
#+ and assigning the stdout of the function to the variable &quot;return_val.&quot;


# ========================= OUTPUT ========================
if [ &quot;$return_val&quot; -eq &quot;$E_PARAM_ERR&quot; ]
  then
  echo &quot;Error in parameters passed to comparison function!&quot;
elif [ &quot;$return_val&quot; -eq &quot;$EQUAL&quot; ]
  then
    echo &quot;The two numbers are equal.&quot;
else
    echo &quot;The larger of the two numbers is $return_val.&quot;
fi
# =========================================================

exit 0

#  Exercises:
#  ---------
#  1) Find a more elegant way of testing
#+    the parameters passed to the function.
#  2) Simplify the if/then structure at &quot;OUTPUT.&quot;
#  3) Rewrite the script to take input from command-line parameters.
</pre>
<p>Here is another example of capturing a function &quot;return value.&quot;
Understanding it requires some knowledge of
<a class="reference external" href="awk.html#AWKREF">awk</a>.</p>
<pre class="literal-block">
month_length ()  # Takes month number as an argument.
{                # Returns number of days in month.
monthD=&quot;31 28 31 30 31 30 31 31 30 31 30 31&quot;  # Declare as local?
echo &quot;$monthD&quot; | awk '{ print $'&quot;${1}&quot;' }'    # Tricky.
#                             ^^^^^^^^^
# Parameter passed to function  ($1 -- month number), then to awk.
# Awk sees this as &quot;print $1 . . . print $12&quot; (depending on month number)
# Template for passing a parameter to embedded awk script:
#                                 $'&quot;${script_parameter}&quot;'

#    Here's a slightly simpler awk construct:
#    echo $monthD | awk -v month=$1 '{print $(month)}'
#    Uses the -v awk option, which assigns a variable value
#+   prior to execution of the awk program block.
#    Thank you, Rich.

#  Needs error checking for correct parameter range (1-12)
#+ and for February in leap year.
}

# ----------------------------------------------
# Usage example:
month=4        # April, for example (4th month).
days_in=$(month_length $month)
echo $days_in  # 30
# ----------------------------------------------
</pre>
<p>See also <a class="reference external" href="contributed-scripts.html#DAYSBETWEEN">Example A-7</a> and
<a class="reference external" href="contributed-scripts.html#STDDEV">Example A-37</a>.</p>
<p><tt class="docutils literal">Exercise:</tt> Using what we have just learned, extend the previous
<a class="reference external" href="complexfunct.html#EX61">Roman numerals example</a> to accept
arbitrarily large input.</p>
</blockquote>
<p><strong>Redirection</strong></p>
<dl class="docutils">
<dt><tt class="docutils literal">Redirecting the stdin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; of a function</tt></dt>
<dd><p class="first">A function is essentially a <a class="reference external" href="special-chars.html#CODEBLOCKREF">code
block</a>, which means its <tt class="docutils literal">stdin</tt>
can be redirected (as in <a class="reference external" href="special-chars.html#EX8">Example 3-1</a>).</p>
<p><strong>Example 24-11. Real name from username</strong></p>
<pre class="literal-block">
#!/bin/bash
# realname.sh
#
# From username, gets &quot;real name&quot; from /etc/passwd.


ARGCOUNT=1       # Expect one arg.
E_WRONGARGS=85

file=/etc/passwd
pattern=$1

if [ $# -ne &quot;$ARGCOUNT&quot; ]
then
  echo &quot;Usage: `basename $0` USERNAME&quot;
  exit $E_WRONGARGS
fi

file_excerpt ()    #  Scan file for pattern,
{                  #+ then print relevant portion of line.
  while read line  # &quot;while&quot; does not necessarily need [ condition ]
  do
    echo &quot;$line&quot; | grep $1 | awk -F&quot;:&quot; '{ print $5 }'
    # Have awk use &quot;:&quot; delimiter.
  done
} &lt;$file  # Redirect into function's stdin.

file_excerpt $pattern

# Yes, this entire script could be reduced to
#       grep PATTERN /etc/passwd | awk -F&quot;:&quot; '{ print $5 }'
# or
#       awk -F: '/PATTERN/ {print $5}'
# or
#       awk -F: '($1 == &quot;username&quot;) { print $5 }' # real name from username
# However, it might not be as instructive.

exit 0
</pre>
<p>There is an alternate, and perhaps less confusing method of
redirecting a function's <tt class="docutils literal">stdin</tt>. This involves redirecting the
<tt class="docutils literal">stdin</tt> to an embedded bracketed code block within the function.</p>
<pre class="literal-block">
# Instead of:
Function ()
{
 ...
 } &lt; file

# Try this:
Function ()
{
  {
    ...
   } &lt; file
}

# Similarly,

Function ()  # This works.
{
  {
   echo $*
  } | tr a b
}

Function ()  # This doesn't work.
{
  echo $*
} | tr a b   # A nested code block is mandatory here.


# Thanks, S.C.
</pre>
<div class="figure align-center">
<img alt="Note" src="http://tldp.org/LDP/abs/images/note.gif" />
<p class="caption">Note</p>
</div>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/complexfunct.ca.rst</tt>, line 701)</p>
Explicit markup ends without a blank line; unexpected unindent.</div>
<p class="last">Emmanuel Rouat's <cite>sample ``bashrc`</cite> file &lt;sample-bashrc.html&gt;`_
contains some instructive examples of functions.</p>
</dd>
</dl>
<div class="section" id="notes">
<h2>Notes</h2>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/complexfunct.ca.rst</tt>, line 10); <em><a href="#id7">backlink</a></em></p>
Duplicate explicit target name: &quot;[1]&quot;.</div>
<p><a class="reference external" href="complexfunct.html#AEN18337">[1]</a></p>
<p>The <strong>return</strong> command is a Bash <a class="reference external" href="internal.html#BUILTINREF">builtin</a>.</p>
<hr class="docutils" />
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="32%" />
<col width="33%" />
</colgroup>
<tbody valign="top">
<tr><td><a class="reference external" href="functions.html">Prev</a></td>
<td><a class="reference external" href="index.html">Home</a></td>
<td><a class="reference external" href="localvar.html">Next</a></td>
</tr>
<tr><td>Functions</td>
<td><a class="reference external" href="functions.html">Up</a></td>
<td>Local Variables</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</body>
</html>
