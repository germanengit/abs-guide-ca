<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.8.1: http://docutils.sourceforge.net/" />
<title></title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7056 2011-06-17 10:50:48Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<p><a class="reference external" href="index.ca.html">Inici</a> :  Guia avançada de Bash-Scripting</p>
<p><a class="reference external" href="external.ca.html">Amunt</a> : Capítol 16. Filtres externs, programes i
comandes</p>
<p><a class="reference external" href="moreadv.ca.html">Anterior</a> : Comandes complexes</p>
<p><a class="reference external" href="textproc.ca.html">Següent</a> : Comandes de processament de text</p>
<hr class="docutils" />
<div class="section" id="comandes-de-data-i-hora">
<h1>16.3. Comandes de data i hora</h1>
<p><strong>Les comandes time, date i el càlcul de temps</strong></p>
<dl class="docutils">
<dt><strong>date</strong></dt>
<dd><p class="first">Invocant-la directament, <strong>date</strong> escriu la data i l'hora a la
sortida estàndard (<tt class="docutils literal">stdout</tt>). Aquesta comanda es torna més
interessant quan es fan servir les opcions de formatat i anàlisi.</p>
<p><strong>Exemple 16-10. Ús de *date*</strong></p>
<pre class="literal-block">
#!/bin/bash
# Ús de la comanda 'date'

echo &quot;El nombre de dies des de l'inici de l'any és `date +%j`.&quot;
# Cal un '+' per invocar el formatat.
# %j retorna el dia de l'any.

echo &quot;El nombre de segons que ha passat des de 01/01/1970 és `date +%s`.&quot;
#  %s genera el nombre de segons des de que va començar l' &quot;UNIX epoch&quot;,
#+ Però, de què ens pot servir això?

prefix=temp
suffix=$(date +%s)  # L'opció &quot;+%s&quot; de 'date' és específica de GNU.
filename=$prefix.$suffix
echo &quot;Nom de fitxer temporal = $filename&quot;
#  És perfecte per crear fitxers temporals amb noms &quot;únics i aleatoris&quot;,
#+ fins i tot millor que fer servir $$.

# Llegiu la pàgina man de 'date' per a conèixer més opcions de formatat.

exit 0
</pre>
<p>L'opció <tt class="docutils literal"><span class="pre">-u</span></tt> retorna l' UTC o Temps Universal Coordinat (Universal
Coordinated Time).</p>
<pre class="literal-block">
bash$ date
Fri Mar 29 21:07:39 MST 2002



bash$ date -u
Sat Mar 30 04:07:42 UTC 2002
</pre>
<p>Aquesta opció facilita el càlcul del temps entre diferents dates.</p>
<p><strong>Exemple 16-11. Càlculs amb *Date*</strong></p>
<pre class="literal-block">
#!/bin/bash
# date-calc.sh
# Autor: Nathan Coulter

MPHR=60    # Minuts per hora.
HPD=24     # Hores per dia.

diff () {
        printf '%s' $(( $(date -u -d&quot;$TARGET&quot; +%s) -
                        $(date -u -d&quot;$CURRENT&quot; +%s)))
#                       %d = dia del mes
}


CURRENT=$(date -u -d '2007-09-01 17:30:24' '+%F %T.%N %Z')
TARGET=$(date -u -d'2007-12-25 12:30:00' '+%F %T.%N %Z')
# %F = data completa, %T = %H:%M:%S, %N = nanosegons, %Z = zona horària.

printf '\nEl %s de 2007 ' \
       &quot;$(date -d&quot;$CURRENT +
        $(( $(diff) /$MPHR /$MPHR /$HPD / 2 )) days&quot; '+%d %B')&quot;
#       %B = nom del mes                ^ mig camí
printf 'estava a mig camí entre  %s ' &quot;$(date -d&quot;$CURRENT&quot; '+%d %B')&quot;
printf 'i %s\n' &quot;$(date -d&quot;$TARGET&quot; '+%d %B')&quot;

printf '\nEl %s a les %s hi quedaven\n' \
        $(date -u -d&quot;$CURRENT&quot; +%F) $(date -u -d&quot;$CURRENT&quot; +%T)
DAYS=$(( $(diff) / $MPHR / $MPHR / $HPD ))
CURRENT=$(date -d&quot;$CURRENT +$DAYS days&quot; '+%F %T.%N %Z')
HOURS=$(( $(diff) / $MPHR / $MPHR ))
CURRENT=$(date -d&quot;$CURRENT +$HOURS hours&quot; '+%F %T.%N %Z')
MINUTES=$(( $(diff) / $MPHR ))
CURRENT=$(date -d&quot;$CURRENT +$MINUTES minutes&quot; '+%F %T.%N %Z')
printf '%s dies, %s hores, ' &quot;$DAYS&quot; &quot;$HOURS&quot;
printf '%s minuts, i %s segons ' &quot;$MINUTES&quot; &quot;$(diff)&quot;
printf 'fins el dinar de Nadal!\n\n'

#  Exercici:
#  --------
#  Reescriu la funció diff () de manera que accepti paràmetres en comptes de variables globals.
#+ NdT. Realitza els canvis que calguin per mostrar l'article davant els noms dels mesos.
</pre>
<p>La comanda <em>date</em> disposa d'un bon nombre d'opcions de sortida
(<em>output</em>). Per exemple <tt class="docutils literal">%N</tt> retorna la part dels nanosegons del
temps actual. Això pot ser útil, per exemple, per generar d'enters
aleatoris.</p>
<pre class="literal-block">
date +%N | sed -e 's/000$//' -e 's/^0//'
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
#  Elimina els zeros que hi puguin haver a l'inici i al final.
#  La longitud de l'enter generat depèn de
#+ quants zeros s'hagin eliminat.,

# 115281032
# 63408725
# 394504284
</pre>
<p>Hi ha moltes altres opcions (mira <strong>man date</strong>).</p>
<pre class="literal-block">
date +%j
# Mostra el dia de l'any (dies que han passat des del 1 de gener).

date +%k%M
# Mostra l'hora i el minut en format 24-hores en un únic string.



# El paràmetre 'TZ' permet reemplaçar la zona horària per defecte.
date                 # Mon Mar 28 21:42:16 MST 2005
TZ=EST date          # Mon Mar 28 23:42:16 EST 2005



FaSisDies=$(date --date='6 days ago')
FaUnMes=$(date --date='1 month ago')  # Quatre setmanes abans (no un mes!)
FaUnAny=$(date --date='1 year ago')
</pre>
<p class="last">Mira també l' <a class="reference external" href="special-chars.ca.html#EX58">Exemple 3-4</a> i <a class="reference external" href="contributed-scripts.ca.html#STOPWATCH">Exemple
A-43</a>.</p>
</dd>
<dt><strong>zdump</strong></dt>
<dd><p class="first">Mostra el temps en la zona horària que se li especifiqui.</p>
<pre class="last literal-block">
bash$ zdump EST
EST  Tue Sep 18 22:09:22 2001 EST
</pre>
</dd>
<dt><strong>time</strong></dt>
<dd><p class="first">Mostra estadístiques detallades de temps de l'execució d'una
comanda.</p>
<p><tt class="docutils literal">time ls <span class="pre">-l</span> /</tt> retorna quelcom similar a:</p>
<pre class="literal-block">
real    0m0.067s
 user    0m0.004s
 sys     0m0.005s
</pre>
<p>Mira també a la secció anterior la comanda (molt semblant)
<a class="reference external" href="x9445.ca.html#TIMESREF">times</a>.</p>
<p class="last"><em>Atenció</em>: Des de la <a class="reference external" href="bashver2.ca.html#BASH2REF">versió 2.0</a> de
Bash, <strong>time</strong> és una paraula reservada. Presenta un comportament
lleugerament diferent amb pipelines.</p>
</dd>
<dt><strong>touch</strong></dt>
<dd><p class="first">Utilitat que modifica els temps de darrera modificació i accés d'un
fitxer al temps del sistema o bé a un d'especificat. També és útil
per a crear un nou fitxer. La comanda <tt class="docutils literal">touch zzz</tt> crea un nou
fitxer de longitud zero, amb el nom <tt class="docutils literal">zzz</tt> sempre, és clar, que no
existeixi ja <tt class="docutils literal">zzz</tt>. És útil deixar marques de temps d'aquesta
manera en fitxers buits de manera que es pugui fer seguiment dels
moments de modificació d'un projecte.</p>
<p><em>Atenció</em>: La comanda <strong>touch</strong> equival a <tt class="docutils literal">: &gt;&gt; newfile</tt> o <tt class="docutils literal">&gt;&gt;
newfile</tt> (en el cas de fitxers ordinaris).</p>
<p><em>Truc</em>: Abans de fer <a class="reference external" href="basic.ca.html#CPREF">cp -u</a> (<em>copia /
actualitza</em>), fes servir <strong>touch</strong> per a actualitzar la marca de
temps d'aquells fitxers que no vulguis sobreescriure.</p>
<p class="last">Per exemple, si el directori <tt class="docutils literal">/home/bozo/tax_audit</tt> conté els
fitxers <tt class="docutils literal"><span class="pre">calculs-051606.data</span></tt>, <tt class="docutils literal"><span class="pre">calculs-051706.data</span></tt>, i
<tt class="docutils literal"><span class="pre">calculs-051806.data</span></tt>, llavors fent un <strong>touch calculs*.data</strong>
protegirà aquests fitxers de ser sobreescrits per fitxers amb el
mateix nom durant l'execució de <strong>cp -u
/home/bozo/financial_info/calculs*data /home/bozo/tax_audit</strong>.</p>
</dd>
<dt><strong>at</strong></dt>
<dd><p class="first">La comanda de control de treballs <strong>at</strong> executa un conjunt de
comandes donat en el moment especificat. Recorda al
<a class="reference external" href="system.ca.html#CRONREF">cron</a> però <strong>at</strong> és realment útil quan
volem executar un únic cop un conjunt de comandes.</p>
<p><tt class="docutils literal">at 2pm January 15</tt> demana per un conjunt de comandes a ser
executades en el moment indicat. Aquestes comandes han de ser
compatibles amb shell-script donat que, a efectes pràctics, l'usuari
està escrivint un script de shell línia a línia. L'entrada finalitza
amb <a class="reference external" href="special-chars.ca.html#CTLDREF">Ctl-D</a>.</p>
<p><strong>at</strong> llegeix la llista de comandes des d'un fitxer tant indicant
l'opció <tt class="docutils literal"><span class="pre">-f</span></tt> com redireccionant l'entrada (&lt;), El fitxer contindrà
un shell script tot qualsevol, per suposat sempre i quant no sigui
interactiu. Resulta particularment adequat incloure la comanda
<a class="reference external" href="extmisc.ca.html#RUNPARTSREF">run-parts</a> al fitxer per a executar un
conjunt diferent de scripts.</p>
<pre class="last literal-block">
bash$ at 2:30 am Friday &lt; at-jobs.list
job 2 at 2000-10-27 02:30
</pre>
</dd>
<dt><strong>batch</strong></dt>
<dd><p class="first">La comanda de control de treballs <strong>batch</strong> és similar a <strong>at</strong>, Es
diferencia del segon en que executa la llista de comandes quan la
càrrega del sistema cau per sota de <tt class="docutils literal">.8</tt>. Al igual que <strong>at</strong>, pot
llegir comandes d'un fitxer amb l'opció <tt class="docutils literal"><span class="pre">-f</span></tt>.</p>
<p class="last">El concepte de processament en segon pla o <em>batch processing</em> data
de l'era de les computadores mainframe. Vol dir, executar un conjunt
de comandes sense intervenció de l'usuari.</p>
</dd>
<dt><strong>cal</strong></dt>
<dd>Mostra un calendari ben formatat per sortida estàndard (
<tt class="docutils literal">stdout</tt>). Funciona tant per l'any actual com per un ampli rang
d'anys al passat i al futur,</dd>
<dt><strong>sleep</strong></dt>
<dd><p class="first">És l'equivalent per la shell d'un <em>bucle d'espera</em>. Es queda en
pausa durant el nombre especificat de segons sense fer res. Pot ser
útil per calcular temps i també en processos que s'executen en segon
pla comprovant un esdeveniment amb certa freqüència (polling), com
ara a l'<a class="reference external" href="debugging.ca.html#ONLINE">Exemple 31-6</a>.</p>
<pre class="literal-block">
sleep 3     # Pausa 3 segons.
</pre>
<p><em>Atenció</em>: Per defecte la comanda <strong>sleep</strong> funciona amb segons,
però es pot especificar també minuts, hores o dies.</p>
<pre class="literal-block">
sleep 3 h   # Pausa 3 hores!
</pre>
<p class="last"><em>Atenció</em>: La comanda <a class="reference external" href="system.ca.html#WATCHREF">watch</a> pot ser una
millor elecció que <strong>sleep</strong> quan el que volem és executar
comandes cada cert interval de temps.</p>
</dd>
<dt><strong>usleep</strong></dt>
<dd><blockquote class="first">
<p><em>Microsleep</em> (la <em>u</em> es llegeix com la lletra grega <em>mu</em>, o el
prefix <em>micro-</em>). És el mateix que <strong>sleep</strong>, però amb intervals de
microsegons. Pot ser usada per càlcul de temps amb precisió, o bé
per controlar un procés amb un interval molt freqüent.</p>
<pre class="literal-block">
usleep 30     # Pausa 30 microsegons.
</pre>
<p>Aquesta comanda és part dels paquet de Red Hat <em>initscripts /
rc-scripts</em>.</p>
</blockquote>
<p class="last"><em>Compte!</em>: La comanda <strong>usleep</strong> no ofereix un càlcul de temps
particularment precís i , per tant, no és adequada per a bucles on
el temps sigui crític.</p>
</dd>
<dt><strong>hwclock</strong>, <strong>clock</strong></dt>
<dd><p class="first">La comanda <strong>hwclock</strong> accedeix o ajusta el rellotge físic de la
màquina. Algunes opcions requereixen privilegis de <em>root</em>. El fitxer
d'inici <tt class="docutils literal">/etc/rc.d/rc.sysinit</tt> fa servir <strong>hwclock</strong> per a
assignar durant l'arrancada l'hora del sistema a partir del rellotge
de la màquina.</p>
<p class="last">La comanda <strong>clock</strong> s'anomena també <strong>hwclock</strong>.</p>
</dd>
</dl>
<hr class="docutils" />
<p><a class="reference external" href="index.ca.html">Inici</a> :  Guia avançada de Bash-Scripting</p>
<p><a class="reference external" href="external.ca.html">Amunt</a> : Capítol 16. Filtres externs, programes i
comandes</p>
<p><a class="reference external" href="moreadv.ca.html">Anterior</a> : Comandes complexes</p>
<p><a class="reference external" href="textproc.ca.html">Següent</a> : Comandes de processament de text</p>
</div>
</div>
</body>
</html>
