<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.8.1: http://docutils.sourceforge.net/" />
<title></title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7056 2011-06-17 10:50:48Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">rst-ca/gotchas.ca.rst</tt>, line 1)</p>
<p>Malformed table.</p>
<pre class="literal-block">
+----------------------------------+----+---------------------------+
| Advanced Bash-Scripting Guide:   |
+==================================+====+===========================+
| `Prev &lt;options.html&gt;`_           |    | `Next &lt;scrstyle.html&gt;`_   |
+----------------------------------+----+---------------------------+
</pre>
</div>
<hr class="docutils" />
<div class="section" id="chapter-34-gotchas">
<h1>Chapter 34. Gotchas</h1>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a></p>
<div class="system-message" id="id1">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/gotchas.ca.rst</tt>, line 12); <em><a href="#id2">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<p><em>Turandot: *Gli enigmi sono tre, la morte una!*</em></p>
<p><em>Caleph: *No, no! Gli enigmi sono tre, una la vita!*</em></p>
<p><em>--Puccini</em></p>
<p>Here are some (non-recommended!) scripting practices that will bring
excitement into an otherwise dull life.</p>
<ul>
<li><p class="first">Assigning reserved words or characters to variable names.</p>
<pre class="literal-block">
case=value0       # Causes problems.
23skidoo=value1   # Also problems.
# Variable names starting with a digit are reserved by the shell.
# Try _23skidoo=value1. Starting variables with an underscore is okay.

# However . . .   using just an underscore will not work.
_=25
echo $_           # $_ is a special variable set to last arg of last command.
# But . . .       _ is a valid function name!

xyz((!*=value2    # Causes severe problems.
# As of version 3 of Bash, periods are not allowed within variable names.
</pre>
</li>
<li><p class="first">Using a hyphen or other reserved characters in a variable name (or
function name).</p>
<pre class="literal-block">
var-1=23
# Use 'var_1' instead.

function-whatever ()   # Error
# Use 'function_whatever ()' instead.


# As of version 3 of Bash, periods are not allowed within function names.
function.whatever ()   # Error
# Use 'functionWhatever ()' instead.
</pre>
</li>
<li><p class="first">Using the same name for a variable and a function. This can make a
script difficult to understand.</p>
<pre class="literal-block">
do_something ()
{
  echo &quot;This function does something with \&quot;$1\&quot;.&quot;
}

do_something=do_something

do_something do_something

# All this is legal, but highly confusing.
</pre>
</li>
<li><p class="first">Using <a class="reference external" href="special-chars.html#WHITESPACEREF">whitespace</a>
inappropriately. In contrast to other programming languages, Bash can
be quite finicky about whitespace.</p>
<pre class="literal-block">
var1 = 23   # 'var1=23' is correct.
# On line above, Bash attempts to execute command &quot;var1&quot;
# with the arguments &quot;=&quot; and &quot;23&quot;.

let c = $a - $b   # Instead:   let c=$a-$b   or   let &quot;c = $a - $b&quot;

if [ $a -le 5]    # if [ $a -le 5 ]   is correct.
#           ^^      if [ &quot;$a&quot; -le 5 ]   is even better.
                  # [[ $a -le 5 ]] also works.
</pre>
</li>
<li><p class="first">Not terminating with a <a class="reference external" href="special-chars.html#SEMICOLONREF">semicolon</a>
the final command in a <a class="reference external" href="special-chars.html#CODEBLOCKREF">code block within curly
brackets</a>.</p>
<pre class="literal-block">
{ ls -l; df; echo &quot;Done.&quot; }
# bash: syntax error: unexpected end of file

{ ls -l; df; echo &quot;Done.&quot;; }
#                        ^     ### Final command needs semicolon.
</pre>
</li>
<li><p class="first">Assuming uninitialized variables (variables before a value is
assigned to them) are &quot;zeroed out&quot;. An uninitialized variable has a
value of <em>null</em>, <em>not</em> zero.</p>
<pre class="literal-block">
#!/bin/bash

echo &quot;uninitialized_var = $uninitialized_var&quot;
# uninitialized_var =

# However . . .
# if $BASH_VERSION ≥ 4.2; then

if [[ ! -v uninitialized_var ]]
then
  uninitialized_var=0   # Initialize it to zero!
fi
</pre>
</li>
<li><p class="first">Mixing up <em>=</em> and <em>-eq</em> in a test. Remember, <em>=</em> is for comparing
literal variables and <em>-eq</em> for integers.</p>
<pre class="literal-block">
if [ &quot;$a&quot; = 273 ]      # Is $a an integer or string?
if [ &quot;$a&quot; -eq 273 ]    # If $a is an integer.

# Sometimes you can interchange -eq and = without adverse consequences.
# However . . .


a=273.0   # Not an integer.

if [ &quot;$a&quot; = 273 ]
then
  echo &quot;Comparison works.&quot;
else
  echo &quot;Comparison does not work.&quot;
fi    # Comparison does not work.

# Same with   a=&quot; 273&quot;  and a=&quot;0273&quot;.


# Likewise, problems trying to use &quot;-eq&quot; with non-integer values.

if [ &quot;$a&quot; -eq 273.0 ]
then
  echo &quot;a = $a&quot;
fi  # Aborts with an error message.
# test.sh: [: 273.0: integer expression expected
</pre>
</li>
<li><p class="first">Misusing <a class="reference external" href="comparison-ops.html#SCOMPARISON1">string comparison</a>
operators.</p>
<p><strong>Example 34-1. Numerical and string comparison are not equivalent</strong></p>
<pre class="literal-block">
#!/bin/bash
# bad-op.sh: Trying to use a string comparison on integers.

echo
number=1

#  The following while-loop has two errors:
#+ one blatant, and the other subtle.

while [ &quot;$number&quot; &lt; 5 ]    # Wrong! Should be:  while [ &quot;$number&quot; -lt 5 ]
do
  echo -n &quot;$number &quot;
  let &quot;number += 1&quot;
done
#  Attempt to run this bombs with the error message:
#+ bad-op.sh: line 10: 5: No such file or directory
#  Within single brackets, &quot;&lt;&quot; must be escaped,
#+ and even then, it's still wrong for comparing integers.

echo &quot;---------------------&quot;

while [ &quot;$number&quot; \&lt; 5 ]    #  1 2 3 4
do                          #
  echo -n &quot;$number &quot;        #  It *seems* to work, but . . .
  let &quot;number += 1&quot;         #+ it actually does an ASCII comparison,
done                        #+ rather than a numerical one.

echo; echo &quot;---------------------&quot;

# This can cause problems. For example:

lesser=5
greater=105

if [ &quot;$greater&quot; \&lt; &quot;$lesser&quot; ]
then
  echo &quot;$greater is less than $lesser&quot;
fi                          # 105 is less than 5
#  In fact, &quot;105&quot; actually is less than &quot;5&quot;
#+ in a string comparison (ASCII sort order).

echo

exit 0
</pre>
</li>
<li><p class="first">Attempting to use <a class="reference external" href="internal.html#LETREF">let</a> to set string
variables.</p>
<pre class="literal-block">
let &quot;a = hello, you&quot;
echo &quot;$a&quot;   # 0
</pre>
</li>
<li><p class="first">Sometimes variables within &quot;test&quot; brackets ([ ]) need to be quoted
(double quotes). Failure to do so may cause unexpected behavior. See
<a class="reference external" href="comparison-ops.html#STRTEST">Example 7-6</a>, <a class="reference external" href="redircb.html#REDIR2">Example
20-5</a>, and <a class="reference external" href="internalvariables.html#ARGLIST">Example
9-6</a>.</p>
</li>
<li><p class="first">Quoting a variable containing whitespace <a class="reference external" href="quotingvar.html#WSQUO">prevents
splitting</a>. Sometimes this produces
<a class="reference external" href="quotingvar.html#VARSPLITTING">unintended consequences</a>.</p>
</li>
<li><p class="first">Commands issued from a script may fail to execute because the script
owner lacks execute permission for them. If a user cannot invoke a
command from the command-line, then putting it into a script will
likewise fail. Try changing the attributes of the command in
question, perhaps even setting the suid bit (as <em>root</em>, of course).</p>
</li>
<li><p class="first">Attempting to use <strong>-</strong> as a redirection operator (which it is not)
will usually result in an unpleasant surprise.</p>
<pre class="literal-block">
command1 2&gt; - | command2
# Trying to redirect error output of command1 into a pipe . . .
# . . . will not work.

command1 2&gt;&amp; - | command2  # Also futile.

Thanks, S.C.
</pre>
</li>
<li><p class="first">Using Bash <a class="reference external" href="bashver2.html#BASH2REF">version 2+</a> functionality may
cause a bailout with error messages. Older Linux machines may have
version 1.XX of Bash as the default installation.</p>
<pre class="literal-block">
#!/bin/bash

minimum_version=2
# Since Chet Ramey is constantly adding features to Bash,
# you may set $minimum_version to 2.XX, 3.XX, or whatever is appropriate.
E_BAD_VERSION=80

if [ &quot;$BASH_VERSION&quot; \&lt; &quot;$minimum_version&quot; ]
then
  echo &quot;This script works only with Bash, version $minimum or greater.&quot;
  echo &quot;Upgrade strongly recommended.&quot;
  exit $E_BAD_VERSION
fi

...
</pre>
</li>
<li><p class="first">Using Bash-specific functionality in a <a class="reference external" href="why-shell.html#BASHDEF">Bourne
shell</a> script (<tt class="docutils literal"><span class="pre">#!/bin/sh</span></tt>) on a
non-Linux machine <a class="reference external" href="gotchas.html#BINSH">may cause unexpected
behavior</a>. A Linux system usually aliases
<strong>sh</strong> to <strong>bash</strong>, but this does not necessarily hold true for a
generic UNIX machine.</p>
</li>
<li><p class="first">Using undocumented features in Bash turns out to be a dangerous
practice. In previous releases of this book there were several
scripts that depended on the &quot;feature&quot; that, although the maximum
value of an <a class="reference external" href="exit-status.html#EXITSTATUSREF">exit</a> or
<a class="reference external" href="complexfunct.html#RETURNREF">return</a> value was 255, that limit did
not apply to <em>negative</em> integers. Unfortunately, in version 2.05b and
later, that loophole disappeared. See <a class="reference external" href="complexfunct.html#RETURNTEST">Example
24-9</a>.</p>
</li>
<li><p class="first">In certain contexts, a misleading <a class="reference external" href="exit-status.html#EXITSTATUSREF">exit
status</a> may be returned. This may
occur when <a class="reference external" href="localvar.html#EXITVALANOMALY01">setting a local variable within a
function</a> or when <a class="reference external" href="internal.html#EXITVALANOMALY02">assigning an
arithmetic value to a variable</a>.</p>
</li>
<li><p class="first">The <a class="reference external" href="testconstructs.html#ARXS">exit status of an arithmetic
expression</a> is <em>not</em> equivalent to an
<em>error code</em>.</p>
<pre class="literal-block">
var=1 &amp;&amp; ((--var)) &amp;&amp; echo $var
#        ^^^^^^^^^ Here the and-list terminates with exit status 1.
#                     $var doesn't echo!
echo $?   # 1
</pre>
</li>
<li><p class="first">A script with DOS-type newlines (<tt class="docutils literal">\r\n</tt>) will fail to execute,
since <tt class="docutils literal"><span class="pre">#!/bin/bash\r\n</span></tt> is <em>not</em> recognized, <em>not</em> the same as the
expected <tt class="docutils literal"><span class="pre">#!/bin/bash\n</span></tt>. The fix is to convert the script to
UNIX-style newlines.</p>
<pre class="literal-block">
#!/bin/bash

echo &quot;Here&quot;

unix2dos $0    # Script changes itself to DOS format.
chmod 755 $0   # Change back to execute permission.
               # The 'unix2dos' command removes execute permission.

./$0           # Script tries to run itself again.
               # But it won't work as a DOS file.

echo &quot;There&quot;

exit 0
</pre>
</li>
<li><p class="first">A shell script headed by <tt class="docutils literal"><span class="pre">#!/bin/sh</span></tt> will not run in full
Bash-compatibility mode. Some Bash-specific functions might be
disabled. Scripts that need complete access to all the Bash-specific
extensions should start with <tt class="docutils literal"><span class="pre">#!/bin/bash</span></tt>.</p>
</li>
<li><p class="first"><a class="reference external" href="here-docs.html#INDENTEDLS">Putting whitespace in front of the terminating limit
string</a> of a <a class="reference external" href="here-docs.html#HEREDOCREF">here
document</a> will cause unexpected behavior
in a script.</p>
</li>
<li><p class="first">Putting more than one <em>echo</em> statement in a function <a class="reference external" href="assortedtips.html#RVT">whose output is
captured</a>.</p>
<pre class="literal-block">
add2 ()
{
  echo &quot;Whatever ... &quot;   # Delete this line!
  let &quot;retval = $1 + $2&quot;
    echo $retval
    }

    num1=12
    num2=43
    echo &quot;Sum of $num1 and $num2 = $(add2 $num1 $num2)&quot;

#   Sum of 12 and 43 = Whatever ...
#   55

#        The &quot;echoes&quot; concatenate.
</pre>
<p>This <a class="reference external" href="assortedtips.html#RVTCAUTION">will not work</a>.</p>
</li>
<li><p class="first">A script may not <strong>export</strong> variables back to its <a class="reference external" href="internal.html#FORKREF">parent
process</a>, the shell, or to the environment.
Just as we learned in biology, a child process can inherit from a
parent, but not vice versa.</p>
<pre class="literal-block">
WHATEVER=/home/bozo
export WHATEVER
exit 0
</pre>
<pre class="literal-block">
bash$ echo $WHATEVER

bash$
</pre>
<p>Sure enough, back at the command prompt, $WHATEVER remains unset.</p>
</li>
<li><p class="first">Setting and manipulating variables in a
<a class="reference external" href="subshells.html#SUBSHELLSREF">subshell</a>, then attempting to use
those same variables outside the scope of the subshell will result an
unpleasant surprise.</p>
<p><strong>Example 34-2. Subshell Pitfalls</strong></p>
<pre class="literal-block">
#!/bin/bash
# Pitfalls of variables in a subshell.

outer_variable=outer
echo
echo &quot;outer_variable = $outer_variable&quot;
echo

(
# Begin subshell

echo &quot;outer_variable inside subshell = $outer_variable&quot;
inner_variable=inner  # Set
echo &quot;inner_variable inside subshell = $inner_variable&quot;
outer_variable=inner  # Will value change globally?
echo &quot;outer_variable inside subshell = $outer_variable&quot;

# Will 'exporting' make a difference?
#    export inner_variable
#    export outer_variable
# Try it and see.

# End subshell
)

echo
echo &quot;inner_variable outside subshell = $inner_variable&quot;  # Unset.
echo &quot;outer_variable outside subshell = $outer_variable&quot;  # Unchanged.
echo

exit 0

# What happens if you uncomment lines 19 and 20?
# Does it make a difference?
</pre>
</li>
<li><p class="first"><a class="reference external" href="special-chars.html#PIPEREF">Piping</a> <strong>echo</strong> output to a
<a class="reference external" href="internal.html#READREF">read</a> may produce unexpected results. In
this scenario, the <strong>read</strong> acts as if it were running in a subshell.
Instead, use the <a class="reference external" href="internal.html#SETREF">set</a> command (as in
<a class="reference external" href="internal.html#SETPOS">Example 15-18</a>).</p>
<p><strong>Example 34-3. Piping the output of *echo* to a *read*</strong></p>
<pre class="literal-block">
#!/bin/bash
#  badread.sh:
#  Attempting to use 'echo and 'read'
#+ to assign variables non-interactively.

#   shopt -s lastpipe

a=aaa
b=bbb
c=ccc

echo &quot;one two three&quot; | read a b c
# Try to reassign a, b, and c.

echo
echo &quot;a = $a&quot;  # a = aaa
echo &quot;b = $b&quot;  # b = bbb
echo &quot;c = $c&quot;  # c = ccc
# Reassignment failed.

### However . . .
##  Uncommenting line 6:
#   shopt -s lastpipe
##+ fixes the problem!
### This is a new feature in Bash, version 4.2.

# ------------------------------

# Try the following alternative.

var=`echo &quot;one two three&quot;`
set -- $var
a=$1; b=$2; c=$3

echo &quot;-------&quot;
echo &quot;a = $a&quot;  # a = one
echo &quot;b = $b&quot;  # b = two
echo &quot;c = $c&quot;  # c = three
# Reassignment succeeded.

# ------------------------------

#  Note also that an echo to a 'read' works within a subshell.
#  However, the value of the variable changes *only* within the subshell.

a=aaa          # Starting all over again.
b=bbb
c=ccc

echo; echo
echo &quot;one two three&quot; | ( read a b c;
echo &quot;Inside subshell: &quot;; echo &quot;a = $a&quot;; echo &quot;b = $b&quot;; echo &quot;c = $c&quot; )
# a = one
# b = two
# c = three
echo &quot;-----------------&quot;
echo &quot;Outside subshell: &quot;
echo &quot;a = $a&quot;  # a = aaa
echo &quot;b = $b&quot;  # b = bbb
echo &quot;c = $c&quot;  # c = ccc
echo

exit 0
</pre>
<p>In fact, as Anthony Richardson points out, piping to <em>any</em> loop can
cause a similar problem.</p>
<pre class="literal-block">
# Loop piping troubles.
#  This example by Anthony Richardson,
#+ with addendum by Wilbert Berendsen.


foundone=false
find $HOME -type f -atime +30 -size 100k |
while true
do
   read f
   echo &quot;$f is over 100KB and has not been accessed in over 30 days&quot;
   echo &quot;Consider moving the file to archives.&quot;
   foundone=true
   # ------------------------------------
     echo &quot;Subshell level = $BASH_SUBSHELL&quot;
   # Subshell level = 1
   # Yes, we're inside a subshell.
   # ------------------------------------
done

#  foundone will always be false here since it is
#+ set to true inside a subshell
if [ $foundone = false ]
then
   echo &quot;No files need archiving.&quot;
fi

# =====================Now, here is the correct way:=================

foundone=false
for f in $(find $HOME -type f -atime +30 -size 100k)  # No pipe here.
do
   echo &quot;$f is over 100KB and has not been accessed in over 30 days&quot;
   echo &quot;Consider moving the file to archives.&quot;
   foundone=true
done

if [ $foundone = false ]
then
   echo &quot;No files need archiving.&quot;
fi

# ==================And here is another alternative==================

#  Places the part of the script that reads the variables
#+ within a code block, so they share the same subshell.
#  Thank you, W.B.

find $HOME -type f -atime +30 -size 100k | {
     foundone=false
     while read f
     do
       echo &quot;$f is over 100KB and has not been accessed in over 30 days&quot;
       echo &quot;Consider moving the file to archives.&quot;
       foundone=true
     done

     if ! $foundone
     then
       echo &quot;No files need archiving.&quot;
     fi
}
</pre>
<p>A lookalike problem occurs when trying to write the <tt class="docutils literal">stdout</tt> of a
<strong>tail -f</strong> piped to <a class="reference external" href="textproc.html#GREPREF">grep</a>.</p>
<pre class="literal-block">
tail -f /var/log/messages | grep &quot;$ERROR_MSG&quot; &gt;&gt; error.log
#  The &quot;error.log&quot; file will not have anything written to it.
#  As Samuli Kaipiainen points out, this results from grep
#+ buffering its output.
#  The fix is to add the &quot;--line-buffered&quot; parameter to grep.
</pre>
</li>
<li><p class="first">Using &quot;suid&quot; commands within scripts is risky, as it may compromise
system security. <a class="reference external" href="gotchas.html#FTN.AEN19856">[1]</a></p>
</li>
<li><p class="first">Using shell scripts for CGI programming may be problematic. Shell
script variables are not &quot;typesafe,&quot; and this can cause undesirable
behavior as far as CGI is concerned. Moreover, it is difficult to
&quot;cracker-proof&quot; shell scripts.</p>
</li>
<li><p class="first">Bash does not handle the <a class="reference external" href="internal.html#DOUBLESLASHREF">double slash (//)
string</a> correctly.</p>
</li>
<li><p class="first">Bash scripts written for Linux or BSD systems may need fixups to run
on a commercial UNIX (or Apple OSX) machine. Such scripts often
employ the GNU set of commands and filters, which have greater
functionality than their generic UNIX counterparts. This is
particularly true of such text processing utilites as
<a class="reference external" href="textproc.html#TRREF">tr</a>.</p>
</li>
</ul>
<p><a href="#id4"><span class="problematic" id="id5">**</span></a></p>
<div class="system-message" id="id4">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/gotchas.ca.rst</tt>, line 627); <em><a href="#id5">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<p><em>Danger is near thee --</em></p>
<p><em>Beware, beware, beware, beware.</em></p>
<p><em>Many brave hearts are asleep in the deep.</em></p>
<p><em>So beware --</em></p>
<p><em>Beware.</em></p>
<p><em>--A.J. Lamb and H.W. Petrie</em></p>
<div class="section" id="notes">
<h2>Notes</h2>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/gotchas.ca.rst</tt>, line 10); <em><a href="#id6">backlink</a></em></p>
Duplicate explicit target name: &quot;[1]&quot;.</div>
<p><a class="reference external" href="gotchas.html#AEN19856">[1]</a></p>
<p>Setting the <a class="reference external" href="fto.html#SUIDREF">suid</a> permission on the script itself
has no effect in Linux and most other UNIX flavors.</p>
<hr class="docutils" />
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="31%" />
<col width="35%" />
</colgroup>
<tbody valign="top">
<tr><td><a class="reference external" href="options.html">Prev</a></td>
<td><a class="reference external" href="index.html">Home</a></td>
<td><a class="reference external" href="scrstyle.html">Next</a></td>
</tr>
<tr><td>Options</td>
<td><a class="reference external" href="part5.html">Up</a></td>
<td>Scripting With Style</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</body>
</html>
