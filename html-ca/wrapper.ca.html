<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.8.1: http://docutils.sourceforge.net/" />
<title></title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7056 2011-06-17 10:50:48Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">rst-ca/wrapper.ca.rst</tt>, line 1)</p>
<p>Malformed table.</p>
<pre class="literal-block">
+----------------------------------+--------------------------+--------------------------------------+
| Advanced Bash-Scripting Guide:   |
+==================================+==========================+======================================+
| `Prev &lt;intandnonint.html&gt;`_      | Chapter 36. Miscellany   | `Next &lt;testsandcomparisons.html&gt;`_   |
+----------------------------------+--------------------------+--------------------------------------+
</pre>
</div>
<hr class="docutils" />
<div class="section" id="shell-wrappers">
<h1>36.2. Shell Wrappers</h1>
<p>A <em>wrapper</em> is a shell script that embeds a system command or utility,
that accepts and passes a set of parameters to that command.
<a class="reference external" href="wrapper.html#FTN.AEN19987">[1]</a> Wrapping a script around a complex
command-line simplifies invoking it. This is expecially useful with
<a class="reference external" href="sedawk.html#SEDREF">sed</a> and <a class="reference external" href="awk.html#AWKREF">awk</a>.</p>
<p>A <strong>sed</strong> or <strong>awk</strong> script would normally be invoked from the
command-line by a <tt class="docutils literal">sed <span class="pre">-e</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'commands'</tt> or
<tt class="docutils literal">awk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'commands'</tt>. Embedding such a script in a Bash script
permits calling it more simply, and makes it <em>reusable</em>. This also
enables combining the functionality of <em>sed</em> and <em>awk</em>, for example
<a class="reference external" href="special-chars.html#PIPEREF">piping</a> the output of a set of <em>sed</em>
commands to <em>awk</em>. As a saved executable file, you can then repeatedly
invoke it in its original form or modified, without the inconvenience of
retyping it on the command-line.</p>
<p><strong>Example 36-1. *shell wrapper*</strong></p>
<pre class="literal-block">
#!/bin/bash

# This simple script removes blank lines from a file.
# No argument checking.
#
# You might wish to add something like:
#
# E_NOARGS=85
# if [ -z &quot;$1&quot; ]
# then
#  echo &quot;Usage: `basename $0` target-file&quot;
#  exit $E_NOARGS
# fi



sed -e /^$/d &quot;$1&quot;
# Same as
#    sed -e '/^$/d' filename
# invoked from the command-line.

#  The '-e' means an &quot;editing&quot; command follows (optional here).
#  '^' indicates the beginning of line, '$' the end.
#  This matches lines with nothing between the beginning and the end --
#+ blank lines.
#  The 'd' is the delete command.

#  Quoting the command-line arg permits
#+ whitespace and special characters in the filename.

#  Note that this script doesn't actually change the target file.
#  If you need to do that, redirect its output.

exit
</pre>
<p><strong>Example 36-2. A slightly more complex *shell wrapper*</strong></p>
<pre class="literal-block">
#!/bin/bash

#  subst.sh: a script that substitutes one pattern for
#+ another in a file,
#+ i.e., &quot;sh subst.sh Smith Jones letter.txt&quot;.
#                     Jones replaces Smith.

ARGS=3         # Script requires 3 arguments.
E_BADARGS=85   # Wrong number of arguments passed to script.

if [ $# -ne &quot;$ARGS&quot; ]
then
  echo &quot;Usage: `basename $0` old-pattern new-pattern filename&quot;
  exit $E_BADARGS
fi

old_pattern=$1
new_pattern=$2

if [ -f &quot;$3&quot; ]
then
    file_name=$3
else
    echo &quot;File \&quot;$3\&quot; does not exist.&quot;
    exit $E_BADARGS
fi


# -----------------------------------------------
#  Here is where the heavy work gets done.
sed -e &quot;s/$old_pattern/$new_pattern/g&quot; $file_name
# -----------------------------------------------

#  's' is, of course, the substitute command in sed,
#+ and /pattern/ invokes address matching.
#  The 'g,' or global flag causes substitution for EVERY
#+ occurence of $old_pattern on each line, not just the first.
#  Read the 'sed' docs for an in-depth explanation.

exit $?  # Redirect the output of this script to write to a file.
</pre>
<p><strong>Example 36-3. A generic *shell wrapper* that writes to a logfile</strong></p>
<pre class="literal-block">
#!/bin/bash
#  Generic shell wrapper that performs an operation
#+ and logs it.

# Must set the following two variables.
OPERATION=
#         Can be a complex chain of commands,
#+        for example an awk script or a pipe . . .
LOGFILE=
#         Command-line arguments, if any, for the operation.


OPTIONS=&quot;$&#64;&quot;


# Log it.
echo &quot;`date` + `whoami` + $OPERATION &quot;$&#64;&quot;&quot; &gt;&gt; $LOGFILE
# Now, do it.
exec $OPERATION &quot;$&#64;&quot;

# It's necessary to do the logging before the operation.
# Why?
</pre>
<p><strong>Example 36-4. A *shell wrapper* around an awk script</strong></p>
<pre class="literal-block">
#!/bin/bash
# pr-ascii.sh: Prints a table of ASCII characters.

START=33   # Range of printable ASCII characters (decimal).
END=127    # Will not work for unprintable characters (&gt; 127).

echo &quot; Decimal   Hex     Character&quot;   # Header.
echo &quot; -------   ---     ---------&quot;

for ((i=START; i&lt;=END; i++))
do
  echo $i | awk '{printf(&quot;  %3d       %2x         %c\n&quot;, $1, $1, $1)}'
# The Bash printf builtin will not work in this context:
#     printf &quot;%c&quot; &quot;$i&quot;
done

exit 0


#  Decimal   Hex     Character
#  -------   ---     ---------
#    33       21         !
#    34       22         &quot;
#    35       23         #
#    36       24         $
#
#    . . .
#
#   122       7a         z
#   123       7b         {
#   124       7c         |
#   125       7d         }


#  Redirect the output of this script to a file
#+ or pipe it to &quot;more&quot;:  sh pr-asc.sh | more
</pre>
<p><strong>Example 36-5. A *shell wrapper* around another awk script</strong></p>
<pre class="literal-block">
#!/bin/bash

# Adds up a specified column (of numbers) in the target file.
# Floating-point (decimal) numbers okay, because awk can handle them.

ARGS=2
E_WRONGARGS=85

if [ $# -ne &quot;$ARGS&quot; ] # Check for proper number of command-line args.
then
   echo &quot;Usage: `basename $0` filename column-number&quot;
   exit $E_WRONGARGS
fi

filename=$1
column_number=$2

#  Passing shell variables to the awk part of the script is a bit tricky.
#  One method is to strong-quote the Bash-script variable
#+ within the awk script.
#     $'$BASH_SCRIPT_VAR'
#      ^                ^
#  This is done in the embedded awk script below.
#  See the awk documentation for more details.

# A multi-line awk script is here invoked by
#   awk '
#   ...
#   ...
#   ...
#   '


# Begin awk script.
# -----------------------------
awk '

{ total += $'&quot;${column_number}&quot;'
}
END {
     print total
}

' &quot;$filename&quot;
# -----------------------------
# End awk script.


#   It may not be safe to pass shell variables to an embedded awk script,
#+  so Stephane Chazelas proposes the following alternative:
#   ---------------------------------------
#   awk -v column_number=&quot;$column_number&quot; '
#   { total += $column_number
#   }
#   END {
#       print total
#   }' &quot;$filename&quot;
#   ---------------------------------------


exit 0
</pre>
<p>For those scripts needing a single do-it-all tool, a Swiss army knife,
there is <em>Perl</em>. Perl combines the capabilities of
<a class="reference external" href="sedawk.html#SEDREF">sed</a> and <a class="reference external" href="awk.html#AWKREF">awk</a>, and throws in
a large subset of <strong>C</strong>, to boot. It is modular and contains support for
everything ranging from object-oriented programming up to and including
the kitchen sink. Short Perl scripts lend themselves to embedding within
shell scripts, and there may be some substance to the claim that Perl
can totally replace shell scripting (though the author of the <em>ABS
Guide</em> remains skeptical).</p>
<p><strong>Example 36-6. Perl embedded in a *Bash* script</strong></p>
<pre class="literal-block">
#!/bin/bash

# Shell commands may precede the Perl script.
echo &quot;This precedes the embedded Perl script within \&quot;$0\&quot;.&quot;
echo &quot;===============================================================&quot;

perl -e 'print &quot;This line prints from an embedded Perl script.\n&quot;;'
# Like sed, Perl also uses the &quot;-e&quot; option.

echo &quot;===============================================================&quot;
echo &quot;However, the script may also contain shell and system commands.&quot;

exit
</pre>
<p>It is even possible to combine a Bash script and Perl script within the
same file. Depending on how the script is invoked, either the Bash part
or the Perl part will execute.</p>
<p><strong>Example 36-7. Bash and Perl scripts combined</strong></p>
<pre class="literal-block">
#!/bin/bash
# bashandperl.sh

echo &quot;Greetings from the Bash part of the script, $0.&quot;
# More Bash commands may follow here.

exit
# End of Bash part of the script.

# =======================================================

#!/usr/bin/perl
# This part of the script must be invoked with
#    perl -x bashandperl.sh

print &quot;Greetings from the Perl part of the script, $0.\n&quot;;
#      Perl doesn't seem to like &quot;echo&quot; ...
# More Perl commands may follow here.

# End of Perl part of the script.
</pre>
<pre class="literal-block">
bash$ bash bashandperl.sh
Greetings from the Bash part of the script.


bash$ perl -x bashandperl.sh
Greetings from the Perl part of the script.
</pre>
<p>One interesting example of a complex shell wrapper is Martin Matusiak's
<a class="reference external" href="http://www.matusiak.eu/numerodix/blog/index.php/">*undvd* script</a>,
which provides an easy-to-use command-line interface to the complex
<a class="reference external" href="http://www.mplayerhq.hu/DOCS/HTML/en/mencoder.html">mencoder</a>
utility. Another example is Itzchak Rehberg's
<a class="reference external" href="http://projects.izzysoft.de/trac/ext3undel">Ext3Undel</a>, a set of
scripts to recover deleted file on an <em>ext3</em> filesystem.</p>
<div class="section" id="notes">
<h2>Notes</h2>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/wrapper.ca.rst</tt>, line 10); <em><a href="#id4">backlink</a></em></p>
Duplicate explicit target name: &quot;[1]&quot;.</div>
<p><a class="reference external" href="wrapper.html#AEN19987">[1]</a></p>
<p>Quite a number of Linux utilities are, in fact, shell wrappers. Some
examples are <tt class="docutils literal">/usr/bin/pdf2ps</tt>, <tt class="docutils literal">/usr/bin/batch</tt>, and
<tt class="docutils literal">/usr/bin/xmkmf</tt>.</p>
<hr class="docutils" />
<table border="1" class="docutils">
<colgroup>
<col width="45%" />
<col width="23%" />
<col width="33%" />
</colgroup>
<tbody valign="top">
<tr><td><a class="reference external" href="intandnonint.html">Prev</a></td>
<td><a class="reference external" href="index.html">Home</a></td>
<td><a class="reference external" href="testsandcomparisons.html">Next</a></td>
</tr>
<tr><td>Interactive and non-interactive shells and scripts</td>
<td><a class="reference external" href="miscellany.html">Up</a></td>
<td>Tests and Comparisons: Alternatives</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</body>
</html>
