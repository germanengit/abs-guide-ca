<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.8.1: http://docutils.sourceforge.net/" />
<title></title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7056 2011-06-17 10:50:48Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">rst-ca/communications.ca.rst</tt>, line 1)</p>
<p>Malformed table.</p>
<pre class="literal-block">
+----------------------------------+-------------------------------------------------------+--------------------------------+
| Advanced Bash-Scripting Guide:   |
+==================================+=======================================================+================================+
| `Prev &lt;filearchiv.html&gt;`_        | Chapter 16. External Filters, Programs and Commands   | `Next &lt;terminalccmds.html&gt;`_   |
+----------------------------------+-------------------------------------------------------+--------------------------------+
</pre>
</div>
<hr class="docutils" />
<div class="section" id="communications-commands">
<h1>16.6. Communications Commands</h1>
<p>Certain of the following commands find use in network data transfer and
analysis, as well as in <a class="reference external" href="writingscripts.html#CSPAMMERS">chasing
spammers</a>.</p>
<p><strong>Information and Statistics</strong></p>
<dl class="docutils">
<dt><strong>host</strong></dt>
<dd><p class="first">Searches for information about an Internet host by name or IP
address, using DNS.</p>
<pre class="last literal-block">
bash$ host surfacemail.com
surfacemail.com. has address 202.92.42.236
</pre>
</dd>
<dt><strong>ipcalc</strong></dt>
<dd><p class="first">Displays IP information for a host. With the <tt class="docutils literal"><span class="pre">-h</span></tt> option,
<strong>ipcalc</strong> does a reverse DNS lookup, finding the name of the host
(server) from the IP address.</p>
<pre class="last literal-block">
bash$ ipcalc -h 202.92.42.236
HOSTNAME=surfacemail.com
</pre>
</dd>
<dt><strong>nslookup</strong></dt>
<dd><p class="first">Do an Internet &quot;name server lookup&quot; on a host by IP address. This is
essentially equivalent to <strong>ipcalc -h</strong> or <strong>dig -x</strong>. The command
may be run either interactively or noninteractively, i.e., from
within a script.</p>
<p>The <strong>nslookup</strong> command has allegedly been &quot;deprecated,&quot; but it is
still useful.</p>
<pre class="last literal-block">
bash$ nslookup -sil 66.97.104.180
nslookup kuhleersparnis.ch
 Server:         135.116.137.2
 Address:        135.116.137.2#53

 Non-authoritative answer:
 Name:   kuhleersparnis.ch
</pre>
</dd>
<dt><strong>dig</strong></dt>
<dd><p class="first"><strong>D**omain **I**nformation **G**roper. Similar to **nslookup</strong>,
<em>dig</em> does an Internet <em>name server lookup</em> on a host. May be run
from the command-line or from within a script.</p>
<p>Some interesting options to <em>dig</em> are <tt class="docutils literal">+time=N</tt> for setting a
query timeout to <tt class="docutils literal">N</tt> seconds, <tt class="docutils literal">+nofail</tt> for continuing to query
servers until a reply is received, and <tt class="docutils literal"><span class="pre">-x</span></tt> for doing a reverse
address lookup.</p>
<p>Compare the output of <strong>dig -x</strong> with <strong>ipcalc -h</strong> and
<strong>nslookup</strong>.</p>
<pre class="literal-block">
bash$ dig -x 81.9.6.2
;; Got answer:
 ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NXDOMAIN, id: 11649
 ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 0

 ;; QUESTION SECTION:
 ;2.6.9.81.in-addr.arpa.         IN      PTR

 ;; AUTHORITY SECTION:
 6.9.81.in-addr.arpa.    3600    IN      SOA     ns.eltel.net. noc.eltel.net.
 2002031705 900 600 86400 3600

 ;; Query time: 537 msec
 ;; SERVER: 135.116.137.2#53(135.116.137.2)
 ;; WHEN: Wed Jun 26 08:35:24 2002
 ;; MSG SIZE  rcvd: 91
</pre>
<p><strong>Example 16-40. Finding out where to report a spammer</strong></p>
<pre class="literal-block">
#!/bin/bash
# spam-lookup.sh: Look up abuse contact to report a spammer.
# Thanks, Michael Zick.

# Check for command-line arg.
ARGCOUNT=1
E_WRONGARGS=85
if [ $# -ne &quot;$ARGCOUNT&quot; ]
then
  echo &quot;Usage: `basename $0` domain-name&quot;
  exit $E_WRONGARGS
fi


dig +short $1.contacts.abuse.net -c in -t txt
# Also try:
#     dig +nssearch $1
#     Tries to find &quot;authoritative name servers&quot; and display SOA records.

# The following also works:
#     whois -h whois.abuse.net $1
#           ^^ ^^^^^^^^^^^^^^^  Specify host.
#     Can even lookup multiple spammers with this, i.e.&quot;
#     whois -h whois.abuse.net $spamdomain1 $spamdomain2 . . .


#  Exercise:
#  --------
#  Expand the functionality of this script
#+ so that it automatically e-mails a notification
#+ to the responsible ISP's contact address(es).
#  Hint: use the &quot;mail&quot; command.

exit $?

# spam-lookup.sh chinatietong.com
#                A known spam domain.

# &quot;crnet_mgr&#64;chinatietong.com&quot;
# &quot;crnet_tec&#64;chinatietong.com&quot;
# &quot;postmaster&#64;chinatietong.com&quot;


#  For a more elaborate version of this script,
#+ see the SpamViz home page, http://www.spamviz.net/index.html.
</pre>
<p><strong>Example 16-41. Analyzing a spam domain</strong></p>
<pre class="literal-block">
#! /bin/bash
# is-spammer.sh: Identifying spam domains

# $Id: is-spammer, v 1.4 2004/09/01 19:37:52 mszick Exp $
# Above line is RCS ID info.
#
#  This is a simplified version of the &quot;is_spammer.bash
#+ script in the Contributed Scripts appendix.

# is-spammer &lt;domain.name&gt;

# Uses an external program: 'dig'
# Tested with version: 9.2.4rc5

# Uses functions.
# Uses IFS to parse strings by assignment into arrays.
# And even does something useful: checks e-mail blacklists.

# Use the domain.name(s) from the text body:
# http://www.good_stuff.spammer.biz/just_ignore_everything_else
#                       ^^^^^^^^^^^
# Or the domain.name(s) from any e-mail address:
# Really_Good_Offer&#64;spammer.biz
#
# as the only argument to this script.
#(PS: have your Inet connection running)
#
# So, to invoke this script in the above two instances:
#       is-spammer.sh spammer.biz


# Whitespace == :Space:Tab:Line Feed:Carriage Return:
WSP_IFS=$'\x20'$'\x09'$'\x0A'$'\x0D'

# No Whitespace == Line Feed:Carriage Return
No_WSP=$'\x0A'$'\x0D'

# Field separator for dotted decimal ip addresses
ADR_IFS=${No_WSP}'.'

# Get the dns text resource record.
# get_txt &lt;error_code&gt; &lt;list_query&gt;
get_txt() {

    # Parse $1 by assignment at the dots.
    local -a dns
    IFS=$ADR_IFS
    dns=( $1 )
    IFS=$WSP_IFS
    if [ &quot;${dns[0]}&quot; == '127' ]
    then
        # See if there is a reason.
        echo $(dig +short $2 -t txt)
    fi
}

# Get the dns address resource record.
# chk_adr &lt;rev_dns&gt; &lt;list_server&gt;
chk_adr() {
    local reply
    local server
    local reason

    server=${1}${2}
    reply=$( dig +short ${server} )

    # If reply might be an error code . . .
    if [ ${#reply} -gt 6 ]
    then
        reason=$(get_txt ${reply} ${server} )
        reason=${reason:-${reply}}
    fi
    echo ${reason:-' not blacklisted.'}
}

# Need to get the IP address from the name.
echo 'Get address of: '$1
ip_adr=$(dig +short $1)
dns_reply=${ip_adr:-' no answer '}
echo ' Found address: '${dns_reply}

# A valid reply is at least 4 digits plus 3 dots.
if [ ${#ip_adr} -gt 6 ]
then
    echo
    declare query

    # Parse by assignment at the dots.
    declare -a dns
    IFS=$ADR_IFS
    dns=( ${ip_adr} )
    IFS=$WSP_IFS

    # Reorder octets into dns query order.
    rev_dns=&quot;${dns[3]}&quot;'.'&quot;${dns[2]}&quot;'.'&quot;${dns[1]}&quot;'.'&quot;${dns[0]}&quot;'.'

# See: http://www.spamhaus.org (Conservative, well maintained)
    echo -n 'spamhaus.org says: '
    echo $(chk_adr ${rev_dns} 'sbl-xbl.spamhaus.org')

# See: http://ordb.org (Open mail relays)
    echo -n '   ordb.org  says: '
    echo $(chk_adr ${rev_dns} 'relays.ordb.org')

# See: http://www.spamcop.net/ (You can report spammers here)
    echo -n ' spamcop.net says: '
    echo $(chk_adr ${rev_dns} 'bl.spamcop.net')

# # # other blacklist operations # # #

# See: http://cbl.abuseat.org.
    echo -n ' abuseat.org says: '
    echo $(chk_adr ${rev_dns} 'cbl.abuseat.org')

# See: http://dsbl.org/usage (Various mail relays)
    echo
    echo 'Distributed Server Listings'
    echo -n '       list.dsbl.org says: '
    echo $(chk_adr ${rev_dns} 'list.dsbl.org')

    echo -n '   multihop.dsbl.org says: '
    echo $(chk_adr ${rev_dns} 'multihop.dsbl.org')

    echo -n 'unconfirmed.dsbl.org says: '
    echo $(chk_adr ${rev_dns} 'unconfirmed.dsbl.org')

else
    echo
    echo 'Could not use that address.'
fi

exit 0

# Exercises:
# --------

# 1) Check arguments to script,
#    and exit with appropriate error message if necessary.

# 2) Check if on-line at invocation of script,
#    and exit with appropriate error message if necessary.

# 3) Substitute generic variables for &quot;hard-coded&quot; BHL domains.

# 4) Set a time-out for the script using the &quot;+time=&quot; option
     to the 'dig' command.
</pre>
<p class="last">For a much more elaborate version of the above script, see <a class="reference external" href="contributed-scripts.html#ISSPAMMER2">Example
A-28</a>.</p>
</dd>
<dt><strong>traceroute</strong></dt>
<dd><p class="first">Trace the route taken by packets sent to a remote host. This command
works within a LAN, WAN, or over the Internet. The remote host may
be specified by an IP address. The output of this command may be
filtered by <a class="reference external" href="textproc.html#GREPREF">grep</a> or
<a class="reference external" href="sedawk.html#SEDREF">sed</a> in a pipe.</p>
<pre class="last literal-block">
bash$ traceroute 81.9.6.2
traceroute to 81.9.6.2 (81.9.6.2), 30 hops max, 38 byte packets
 1  tc43.xjbnnbrb.com (136.30.178.8)  191.303 ms  179.400 ms  179.767 ms
 2  or0.xjbnnbrb.com (136.30.178.1)  179.536 ms  179.534 ms  169.685 ms
 3  192.168.11.101 (192.168.11.101)  189.471 ms  189.556 ms *
 ...
</pre>
</dd>
<dt><strong>ping</strong></dt>
<dd><p class="first">Broadcast an <tt class="docutils literal">ICMP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ECHO_REQUEST</tt> packet to another
machine, either on a local or remote network. This is a diagnostic
tool for testing network connections, and it should be used with
caution.</p>
<pre class="literal-block">
bash$ ping localhost
PING localhost.localdomain (127.0.0.1) from 127.0.0.1 : 56(84) bytes of data.
 64 bytes from localhost.localdomain (127.0.0.1): icmp_seq=0 ttl=255 time=709 usec
 64 bytes from localhost.localdomain (127.0.0.1): icmp_seq=1 ttl=255 time=286 usec

 --- localhost.localdomain ping statistics ---
 2 packets transmitted, 2 packets received, 0% packet loss
 round-trip min/avg/max/mdev = 0.286/0.497/0.709/0.212 ms
</pre>
<p>A successful <em>ping</em> returns an <a class="reference external" href="exit-status.html#EXITSTATUSREF">exit
status</a> of 0. This can be tested
for in a script.</p>
<pre class="last literal-block">
  HNAME=news-15.net  # Notorious spammer.
# HNAME=$HOST     # Debug: test for localhost.
  count=2  # Send only two pings.

if [[ `ping -c $count &quot;$HNAME&quot;` ]]
then
  echo &quot;&quot;$HNAME&quot; still up and broadcasting spam your way.&quot;
else
  echo &quot;&quot;$HNAME&quot; seems to be down. Pity.&quot;
fi
</pre>
</dd>
<dt><strong>whois</strong></dt>
<dd>Perform a DNS (Domain Name System) lookup. The <tt class="docutils literal"><span class="pre">-h</span></tt> option permits
specifying which particular <em>whois</em> server to query. See <a class="reference external" href="othertypesv.html#EX18">Example
4-6</a> and <a class="reference external" href="communications.html#SPAMLOOKUP">Example
16-40</a>.</dd>
<dt><strong>finger</strong></dt>
<dd><p class="first">Retrieve information about users on a network. Optionally, this
command can display a user's <tt class="docutils literal"><span class="pre">~/.plan</span></tt>, <tt class="docutils literal"><span class="pre">~/.project</span></tt>, and
<tt class="docutils literal"><span class="pre">~/.forward</span></tt> files, if present.</p>
<pre class="literal-block">
bash$ finger
Login  Name           Tty      Idle  Login Time   Office     Office Phone
 bozo   Bozo Bozeman   tty1        8  Jun 25 16:59                (:0)
 bozo   Bozo Bozeman   ttyp0          Jun 25 16:59                (:0.0)
 bozo   Bozo Bozeman   ttyp1          Jun 25 17:07                (:0.0)



bash$ finger bozo
Login: bozo                             Name: Bozo Bozeman
 Directory: /home/bozo                   Shell: /bin/bash
 Office: 2355 Clown St., 543-1234
 On since Fri Aug 31 20:13 (MST) on tty1    1 hour 38 minutes idle
 On since Fri Aug 31 20:13 (MST) on pts/0   12 seconds idle
 On since Fri Aug 31 20:13 (MST) on pts/1
 On since Fri Aug 31 20:31 (MST) on pts/2   1 hour 16 minutes idle
 Mail last read Tue Jul  3 10:08 2007 (MST)
 No Plan.
</pre>
<p class="last">Out of security considerations, many networks disable <strong>finger</strong> and
its associated daemon. <a class="reference external" href="communications.html#FTN.AEN13203">[1]</a></p>
</dd>
<dt><strong>chfn</strong></dt>
<dd>Change information disclosed by the <strong>finger</strong> command.</dd>
<dt><strong>vrfy</strong></dt>
<dd><p class="first">Verify an Internet e-mail address.</p>
<p class="last">This command seems to be missing from newer Linux distros.</p>
</dd>
</dl>
<p><strong>Remote Host Access</strong></p>
<dl class="docutils">
<dt><strong>sx</strong>, <strong>rx</strong></dt>
<dd>The <strong>sx</strong> and <strong>rx</strong> command set serves to transfer files to and
from a remote host using the <em>xmodem</em> protocol. These are generally
part of a communications package, such as <strong>minicom</strong>.</dd>
<dt><strong>sz</strong>, <strong>rz</strong></dt>
<dd>The <strong>sz</strong> and <strong>rz</strong> command set serves to transfer files to and
from a remote host using the <em>zmodem</em> protocol. <em>Zmodem</em> has certain
advantages over <em>xmodem</em>, such as faster transmission rate and
resumption of interrupted file transfers. Like <strong>sx</strong> and <strong>rx</strong>,
these are generally part of a communications package.</dd>
<dt><strong>ftp</strong></dt>
<dd>Utility and protocol for uploading / downloading files to or from a
remote host. An ftp session can be automated in a script (see
<a class="reference external" href="here-docs.html#EX72">Example 19-6</a> and <a class="reference external" href="contributed-scripts.html#ENCRYPTEDPW">Example
A-4</a>).</dd>
<dt><strong>uucp</strong>, <strong>uux</strong>, <strong>cu</strong></dt>
<dd><p class="first"><strong>uucp</strong>: <em>UNIX to UNIX copy</em>. This is a communications package for
transferring files between UNIX servers. A shell script is an
effective way to handle a <strong>uucp</strong> command sequence.</p>
<p>Since the advent of the Internet and e-mail, <strong>uucp</strong> seems to have
faded into obscurity, but it still exists and remains perfectly
workable in situations where an Internet connection is not available
or appropriate. The advantage of <strong>uucp</strong> is that it is
fault-tolerant, so even if there is a service interruption the copy
operation will resume where it left off when the connection is
restored.</p>
<p>---</p>
<p><strong>uux</strong>: <em>UNIX to UNIX execute</em>. Execute a command on a remote
system. This command is part of the <strong>uucp</strong> package.</p>
<p>---</p>
<p class="last"><strong>cu</strong>: <strong>C**all **U**p a remote system and connect as a simple
terminal. It is a sort of dumbed-down version of
`telnet &lt;communications.html#TELNETREF&gt;`_. This command is part of
the **uucp</strong> package.</p>
</dd>
<dt><strong>telnet</strong></dt>
<dd><p class="first">Utility and protocol for connecting to a remote host.</p>
<div class="figure align-center">
<img alt="Caution" src="http://tldp.org/LDP/abs/images/caution.gif" />
<p class="caption">Caution</p>
</div>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/communications.ca.rst</tt>, line 445)</p>
Explicit markup ends without a blank line; unexpected unindent.</div>
<p class="last">The <em>telnet</em> protocol contains security holes and should therefore
probably be avoided. Its use within a shell script is <em>not</em>
recommended.</p>
</dd>
<dt><strong>wget</strong></dt>
<dd><p class="first">The <strong>wget</strong> utility <em>noninteractively</em> retrieves or downloads files
from a Web or ftp site. It works well in a script.</p>
<pre class="literal-block">
wget -p http://www.xyz23.com/file01.html
#  The -p or --page-requisite option causes wget to fetch all files
#+ required to display the specified page.

wget -r ftp://ftp.xyz24.net/~bozo/project_files/ -O $SAVEFILE
#  The -r option recursively follows and retrieves all links
#+ on the specified site.

wget -c ftp://ftp.xyz25.net/bozofiles/filename.tar.bz2
#  The -c option lets wget resume an interrupted download.
#  This works with ftp servers and many HTTP sites.
</pre>
<p><strong>Example 16-42. Getting a stock quote</strong></p>
<pre class="literal-block">
#!/bin/bash
# quote-fetch.sh: Download a stock quote.


E_NOPARAMS=86

if [ -z &quot;$1&quot; ]  # Must specify a stock (symbol) to fetch.
  then echo &quot;Usage: `basename $0` stock-symbol&quot;
  exit $E_NOPARAMS
fi

stock_symbol=$1

file_suffix=.html
# Fetches an HTML file, so name it appropriately.
URL='http://finance.yahoo.com/q?s='
# Yahoo finance board, with stock query suffix.

# -----------------------------------------------------------
wget -O ${stock_symbol}${file_suffix} &quot;${URL}${stock_symbol}&quot;
# -----------------------------------------------------------


# To look up stuff on http://search.yahoo.com:
# -----------------------------------------------------------
# URL=&quot;http://search.yahoo.com/search?fr=ush-news&amp;p=${query}&quot;
# wget -O &quot;$savefilename&quot; &quot;${URL}&quot;
# -----------------------------------------------------------
# Saves a list of relevant URLs.

exit $?

# Exercises:
# ---------
#
# 1) Add a test to ensure the user running the script is on-line.
#    (Hint: parse the output of 'ps -ax' for &quot;ppp&quot; or &quot;connect.&quot;
#
# 2) Modify this script to fetch the local weather report,
#+   taking the user's zip code as an argument.
</pre>
<p class="last">See also <a class="reference external" href="contributed-scripts.html#WGETTER2">Example A-30</a> and
<a class="reference external" href="contributed-scripts.html#BASHPODDER">Example A-31</a>.</p>
</dd>
<dt><strong>lynx</strong></dt>
<dd><p class="first">The <strong>lynx</strong> Web and file browser can be used inside a script (with
the <tt class="docutils literal"><span class="pre">-dump</span></tt> option) to retrieve a file from a Web or ftp site
noninteractively.</p>
<pre class="literal-block">
lynx -dump http://www.xyz23.com/file01.html &gt;$SAVEFILE
</pre>
<p class="last">With the <tt class="docutils literal"><span class="pre">-traversal</span></tt> option, <strong>lynx</strong> starts at the HTTP URL
specified as an argument, then &quot;crawls&quot; through all links located on
that particular server. Used together with the <tt class="docutils literal"><span class="pre">-crawl</span></tt> option,
outputs page text to a log file.</p>
</dd>
<dt><strong>rlogin</strong></dt>
<dd><tt class="docutils literal">Remote login</tt>, initates a session on a remote host. This command
has security issues, so use <a class="reference external" href="communications.html#SSHREF">ssh</a>
instead.</dd>
<dt><strong>rsh</strong></dt>
<dd><tt class="docutils literal">Remote shell</tt>, executes command(s) on a remote host. This has
security issues, so use <strong>ssh</strong> instead.</dd>
<dt><strong>rcp</strong></dt>
<dd><tt class="docutils literal">Remote copy</tt>, copies files between two different networked
machines.</dd>
<dt><strong>rsync</strong></dt>
<dd><p class="first"><tt class="docutils literal">Remote synchronize</tt>, updates (synchronizes) files between two
different networked machines.</p>
<pre class="literal-block">
bash$ rsync -a ~/sourcedir/*txt /node1/subdirectory/
</pre>
<p><strong>Example 16-43. Updating FC4</strong></p>
<pre class="literal-block">
#!/bin/bash
# fc4upd.sh

# Script author: Frank Wang.
# Slight stylistic modifications by ABS Guide author.
# Used in ABS Guide with permission.


#  Download Fedora Core 4 update from mirror site using rsync.
#  Should also work for newer Fedora Cores -- 5, 6, . . .
#  Only download latest package if multiple versions exist,
#+ to save space.

URL=rsync://distro.ibiblio.org/fedora-linux-core/updates/
# URL=rsync://ftp.kddilabs.jp/fedora/core/updates/
# URL=rsync://rsync.planetmirror.com/fedora-linux-core/updates/

DEST=${1:-/var/www/html/fedora/updates/}
LOG=/tmp/repo-update-$(/bin/date +%Y-%m-%d).txt
PID_FILE=/var/run/${0##*/}.pid

E_RETURN=85        # Something unexpected happened.


# General rsync options
# -r: recursive download
# -t: reserve time
# -v: verbose

OPTS=&quot;-rtv --delete-excluded --delete-after --partial&quot;

# rsync include pattern
# Leading slash causes absolute path name match.
INCLUDE=(
    &quot;/4/i386/kde-i18n-Chinese*&quot;
#   ^                         ^
# Quoting is necessary to prevent globbing.
)


# rsync exclude pattern
# Temporarily comment out unwanted pkgs using &quot;#&quot; . . .
EXCLUDE=(
    /1
    /2
    /3
    /testing
    /4/SRPMS
    /4/ppc
    /4/x86_64
    /4/i386/debug
   &quot;/4/i386/kde-i18n-*&quot;
   &quot;/4/i386/openoffice.org-langpack-*&quot;
   &quot;/4/i386/*i586.rpm&quot;
   &quot;/4/i386/GFS-*&quot;
   &quot;/4/i386/cman-*&quot;
   &quot;/4/i386/dlm-*&quot;
   &quot;/4/i386/gnbd-*&quot;
   &quot;/4/i386/kernel-smp*&quot;
#  &quot;/4/i386/kernel-xen*&quot;
#  &quot;/4/i386/xen-*&quot;
)


init () {
    # Let pipe command return possible rsync error, e.g., stalled network.
    set -o pipefail                  # Newly introduced in Bash, version 3.

    TMP=${TMPDIR:-/tmp}/${0##*/}.$$  # Store refined download list.
    trap &quot;{
        rm -f $TMP 2&gt;/dev/null
    }&quot; EXIT                          # Clear temporary file on exit.
}


check_pid () {
# Check if process exists.
    if [ -s &quot;$PID_FILE&quot; ]; then
        echo &quot;PID file exists. Checking ...&quot;
        PID=$(/bin/egrep -o &quot;^[[:digit:]]+&quot; $PID_FILE)
        if /bin/ps --pid $PID &amp;&gt;/dev/null; then
            echo &quot;Process $PID found. ${0##*/} seems to be running!&quot;
           /usr/bin/logger -t ${0##*/} \
                 &quot;Process $PID found. ${0##*/} seems to be running!&quot;
            exit $E_RETURN
        fi
        echo &quot;Process $PID not found. Start new process . . .&quot;
    fi
}


#  Set overall file update range starting from root or $URL,
#+ according to above patterns.
set_range () {
    include=
    exclude=
    for p in &quot;${INCLUDE[&#64;]}&quot;; do
        include=&quot;$include --include \&quot;$p\&quot;&quot;
    done

    for p in &quot;${EXCLUDE[&#64;]}&quot;; do
        exclude=&quot;$exclude --exclude \&quot;$p\&quot;&quot;
    done
}


# Retrieve and refine rsync update list.
get_list () {
    echo $$ &gt; $PID_FILE || {
        echo &quot;Can't write to pid file $PID_FILE&quot;
        exit $E_RETURN
    }

    echo -n &quot;Retrieving and refining update list . . .&quot;

    # Retrieve list -- 'eval' is needed to run rsync as a single command.
    # $3 and $4 is the date and time of file creation.
    # $5 is the full package name.
    previous=
    pre_file=
    pre_date=0
    eval /bin/nice /usr/bin/rsync \
        -r $include $exclude $URL | \
        egrep '^dr.x|^-r' | \
        awk '{print $3, $4, $5}' | \
        sort -k3 | \
        { while read line; do
            # Get seconds since epoch, to filter out obsolete pkgs.
            cur_date=$(date -d &quot;$(echo $line | awk '{print $1, $2}')&quot; +%s)
            #  echo $cur_date

            # Get file name.
            cur_file=$(echo $line | awk '{print $3}')
            #  echo $cur_file

            # Get rpm pkg name from file name, if possible.
            if [[ $cur_file == *rpm ]]; then
                pkg_name=$(echo $cur_file | sed -r -e \
                    's/(^([^_-]+[_-])+)[[:digit:]]+\..*[_-].*$/\1/')
            else
                pkg_name=
            fi
            # echo $pkg_name

            if [ -z &quot;$pkg_name&quot; ]; then   #  If not a rpm file,
                echo $cur_file &gt;&gt; $TMP    #+ then append to download list.
            elif [ &quot;$pkg_name&quot; != &quot;$previous&quot; ]; then   # A new pkg found.
                echo $pre_file &gt;&gt; $TMP                  # Output latest file.
                previous=$pkg_name                      # Save current.
                pre_date=$cur_date
                pre_file=$cur_file
            elif [ &quot;$cur_date&quot; -gt &quot;$pre_date&quot; ]; then
                                                #  If same pkg, but newer,
                pre_date=$cur_date              #+ then update latest pointer.
                pre_file=$cur_file
            fi
            done
            echo $pre_file &gt;&gt; $TMP              #  TMP contains ALL
                                                #+ of refined list now.
            # echo &quot;subshell=$BASH_SUBSHELL&quot;

    }       # Bracket required here to let final &quot;echo $pre_file &gt;&gt; $TMP&quot;
            # Remained in the same subshell ( 1 ) with the entire loop.

    RET=$?  # Get return code of the pipe command.

    [ &quot;$RET&quot; -ne 0 ] &amp;&amp; {
        echo &quot;List retrieving failed with code $RET&quot;
        exit $E_RETURN
    }

    echo &quot;done&quot;; echo
}

# Real rsync download part.
get_file () {

    echo &quot;Downloading...&quot;
    /bin/nice /usr/bin/rsync \
        $OPTS \
        --filter &quot;merge,+/ $TMP&quot; \
        --exclude '*'  \
        $URL $DEST     \
        | /usr/bin/tee $LOG

    RET=$?

   #  --filter merge,+/ is crucial for the intention.
   #  + modifier means include and / means absolute path.
   #  Then sorted list in $TMP will contain ascending dir name and
   #+ prevent the following --exclude '*' from &quot;shortcutting the circuit.&quot;

    echo &quot;Done&quot;

    rm -f $PID_FILE 2&gt;/dev/null

    return $RET
}

# -------
# Main
init
check_pid
set_range
get_list
get_file
RET=$?
# -------

if [ &quot;$RET&quot; -eq 0 ]; then
    /usr/bin/logger -t ${0##*/} &quot;Fedora update mirrored successfully.&quot;
else
    /usr/bin/logger -t ${0##*/} \
    &quot;Fedora update mirrored with failure code: $RET&quot;
fi

exit $RET
</pre>
<p>See also <a class="reference external" href="contributed-scripts.html#NIGHTLYBACKUP">Example A-32</a>.</p>
<div class="figure align-center">
<img alt="Note" src="http://tldp.org/LDP/abs/images/note.gif" />
<p class="caption">Note</p>
</div>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/communications.ca.rst</tt>, line 780)</p>
Explicit markup ends without a blank line; unexpected unindent.</div>
<p class="last">Using <a class="reference external" href="communications.html#RCPREF">rcp</a>,
<a class="reference external" href="communications.html#RSYNCREF">rsync</a>, and similar utilities with
security implications in a shell script may not be advisable.
Consider, instead, using <strong>ssh</strong>,
<a class="reference external" href="communications.html#SCPREF">scp</a>, or an <strong>expect</strong> script.</p>
</dd>
<dt><strong>ssh</strong></dt>
<dd><p class="first"><tt class="docutils literal">Secure shell</tt>, logs onto a remote host and executes commands
there. This secure replacement for <strong>telnet</strong>, <strong>rlogin</strong>, <strong>rcp</strong>,
and <strong>rsh</strong> uses identity authentication and encryption. See its
<a class="reference external" href="basic.html#MANREF">manpage</a> for details.</p>
<p><strong>Example 16-44. Using *ssh*</strong></p>
<pre class="literal-block">
#!/bin/bash
# remote.bash: Using ssh.

# This example by Michael Zick.
# Used with permission.


#   Presumptions:
#   ------------
#   fd-2 isn't being captured ( '2&gt;/dev/null' ).
#   ssh/sshd presumes stderr ('2') will display to user.
#
#   sshd is running on your machine.
#   For any 'standard' distribution, it probably is,
#+  and without any funky ssh-keygen having been done.

# Try ssh to your machine from the command-line:
#
# $ ssh $HOSTNAME
# Without extra set-up you'll be asked for your password.
#   enter password
#   when done,  $ exit
#
# Did that work? If so, you're ready for more fun.

# Try ssh to your machine as 'root':
#
#   $  ssh -l root $HOSTNAME
#   When asked for password, enter root's, not yours.
#          Last login: Tue Aug 10 20:25:49 2004 from localhost.localdomain
#   Enter 'exit' when done.

#  The above gives you an interactive shell.
#  It is possible for sshd to be set up in a 'single command' mode,
#+ but that is beyond the scope of this example.
#  The only thing to note is that the following will work in
#+ 'single command' mode.


# A basic, write stdout (local) command.

ls -l

# Now the same basic command on a remote machine.
# Pass a different 'USERNAME' 'HOSTNAME' if desired:
USER=${USERNAME:-$(whoami)}
HOST=${HOSTNAME:-$(hostname)}

#  Now excute the above command-line on the remote host,
#+ with all transmissions encrypted.

ssh -l ${USER} ${HOST} &quot; ls -l &quot;

#  The expected result is a listing of your username's home
#+ directory on the remote machine.
#  To see any difference, run this script from somewhere
#+ other than your home directory.

#  In other words, the Bash command is passed as a quoted line
#+ to the remote shell, which executes it on the remote machine.
#  In this case, sshd does  ' bash -c &quot;ls -l&quot; '   on your behalf.

#  For information on topics such as not having to enter a
#+ password/passphrase for every command-line, see
#+    man ssh
#+    man ssh-keygen
#+    man sshd_config.

exit 0
</pre>
<div class="figure align-center">
<img alt="Caution" src="http://tldp.org/LDP/abs/images/caution.gif" />
<p class="caption">Caution</p>
</div>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/communications.ca.rst</tt>, line 871)</p>
Explicit markup ends without a blank line; unexpected unindent.</div>
<p>Within a loop, <strong>ssh</strong> may cause unexpected behavior. According to a
<a class="reference external" href="http://groups-beta.google.com/group/comp.unix.shell/msg/dcb446b5fff7d230">Usenet
post</a>
in the comp.unix shell archives, <strong>ssh</strong> inherits the loop's
<tt class="docutils literal">stdin</tt>. To remedy this, pass <strong>ssh</strong> either the <tt class="docutils literal"><span class="pre">-n</span></tt> or <tt class="docutils literal"><span class="pre">-f</span></tt>
option.</p>
<p class="last">Thanks, Jason Bechtel, for pointing this out.</p>
</dd>
<dt><strong>scp</strong></dt>
<dd><tt class="docutils literal">Secure copy</tt>, similar in function to <strong>rcp</strong>, copies files
between two different networked machines, but does so using
authentication, and with a security level similar to <strong>ssh</strong>.</dd>
</dl>
<p><strong>Local Network</strong></p>
<dl class="docutils">
<dt><strong>write</strong></dt>
<dd><p class="first">This is a utility for terminal-to-terminal communication. It allows
sending lines from your terminal (console or <em>xterm</em>) to that of
another user. The <a class="reference external" href="system.html#MESGREF">mesg</a> command may, of
course, be used to disable write access to a terminal</p>
<p class="last">Since <strong>write</strong> is interactive, it would not normally find use in a
script.</p>
</dd>
<dt><strong>netconfig</strong></dt>
<dd>A command-line utility for configuring a network adapter (using
<em>DHCP</em>). This command is native to Red Hat centric Linux distros.</dd>
</dl>
<p><strong>Mail</strong></p>
<dl class="docutils">
<dt><strong>mail</strong></dt>
<dd><p class="first">Send or read e-mail messages.</p>
<p>This stripped-down command-line mail client works fine as a command
embedded in a script.</p>
<p><strong>Example 16-45. A script that mails itself</strong></p>
<pre class="last literal-block">
#!/bin/sh
# self-mailer.sh: Self-mailing script

adr=${1:-`whoami`}     # Default to current user, if not specified.
#  Typing 'self-mailer.sh wiseguy&#64;superdupergenius.com'
#+ sends this script to that addressee.
#  Just 'self-mailer.sh' (no argument) sends the script
#+ to the person invoking it, for example, bozo&#64;localhost.localdomain.
#
#  For more on the ${parameter:-default} construct,
#+ see the &quot;Parameter Substitution&quot; section
#+ of the &quot;Variables Revisited&quot; chapter.

# ============================================================================
  cat $0 | mail -s &quot;Script \&quot;`basename $0`\&quot; has mailed itself to you.&quot; &quot;$adr&quot;
# ============================================================================

# --------------------------------------------
#  Greetings from the self-mailing script.
#  A mischievous person has run this script,
#+ which has caused it to mail itself to you.
#  Apparently, some people have nothing better
#+ to do with their time.
# --------------------------------------------

echo &quot;At `date`, script \&quot;`basename $0`\&quot; mailed to &quot;$adr&quot;.&quot;

exit 0

#  Note that the &quot;mailx&quot; command (in &quot;send&quot; mode) may be substituted
#+ for &quot;mail&quot; ... but with somewhat different options.
</pre>
</dd>
<dt><strong>mailto</strong></dt>
<dd>Similar to the <strong>mail</strong> command, <strong>mailto</strong> sends e-mail messages
from the command-line or in a script. However, <strong>mailto</strong> also
permits sending MIME (multimedia) messages.</dd>
<dt><strong>mailstats</strong></dt>
<dd><p class="first">Show <em>mail statistics</em>. This command may be invoked only by <em>root</em>.</p>
<pre class="last literal-block">
root# mailstats
Statistics from Tue Jan  1 20:32:08 2008
  M   msgsfr  bytes_from   msgsto    bytes_to  msgsrej msgsdis msgsqur  Mailer
  4     1682      24118K        0          0K        0       0       0  esmtp
  9      212        640K     1894      25131K        0       0       0  local
 =====================================================================
  T     1894      24758K     1894      25131K        0       0       0
  C      414                    0
</pre>
</dd>
<dt><strong>vacation</strong></dt>
<dd>This utility automatically replies to e-mails that the intended
recipient is on vacation and temporarily unavailable. It runs on a
network, in conjunction with <strong>sendmail</strong>, and is not applicable to
a dial-up POPmail account.</dd>
</dl>
<div class="section" id="notes">
<h2>Notes</h2>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/communications.ca.rst</tt>, line 10); <em><a href="#id2">backlink</a></em></p>
Duplicate explicit target name: &quot;[1]&quot;.</div>
<p><a class="reference external" href="communications.html#AEN13203">[1]</a></p>
<p>A <em>daemon</em> is a background process not attached to a terminal session.
Daemons perform designated services either at specified times or
explicitly triggered by certain events.</p>
<p>The word &quot;daemon&quot; means ghost in Greek, and there is certainly something
mysterious, almost supernatural, about the way UNIX daemons wander about
behind the scenes, silently carrying out their appointed tasks.</p>
<hr class="docutils" />
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="28%" />
<col width="36%" />
</colgroup>
<tbody valign="top">
<tr><td><a class="reference external" href="filearchiv.html">Prev</a></td>
<td><a class="reference external" href="index.html">Home</a></td>
<td><a class="reference external" href="terminalccmds.html">Next</a></td>
</tr>
<tr><td>File and Archiving Commands</td>
<td><a class="reference external" href="external.html">Up</a></td>
<td>Terminal Control Commands</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</body>
</html>
