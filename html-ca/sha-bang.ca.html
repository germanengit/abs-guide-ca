<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.8.1: http://docutils.sourceforge.net/" />
<title></title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7056 2011-06-17 10:50:48Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">rst-ca/sha-bang.ca.rst</tt>, line 1)</p>
<p>Malformed table.</p>
<pre class="literal-block">
+----------------------------------+----+---------------------------+
| Advanced Bash-Scripting Guide:   |
+==================================+====+===========================+
| `Prev &lt;why-shell.html&gt;`_         |    | `Next &lt;invoking.html&gt;`_   |
+----------------------------------+----+---------------------------+
</pre>
</div>
<hr class="docutils" />
<div class="section" id="chapter-2-starting-off-with-a-sha-bang">
<h1>Chapter 2. Starting Off With a Sha-Bang</h1>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a></p>
<div class="system-message" id="id1">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/sha-bang.ca.rst</tt>, line 12); <em><a href="#id2">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<p><em>Shell programming is a 1950s juke box . . .</em></p>
<p><em>--Larry Wall</em></p>
<p><strong>Table of Contents</strong></p>
<p>2.1. <a class="reference external" href="invoking.html">Invoking the script</a></p>
<p>2.2. <a class="reference external" href="prelimexer.html">Preliminary Exercises</a></p>
<p>In the simplest case, a script is nothing more than a list of system
commands stored in a file. At the very least, this saves the effort of
retyping that particular sequence of commands each time it is invoked.</p>
<p><strong>Example 2-1. *cleanup*: A script to clean up log files in /var/log</strong></p>
<pre class="literal-block">
# Cleanup
# Run as root, of course.

cd /var/log
cat /dev/null &gt; messages
cat /dev/null &gt; wtmp
echo &quot;Log files cleaned up.&quot;
</pre>
<p>There is nothing unusual here, only a set of commands that could just as
easily have been invoked one by one from the command-line on the console
or in a terminal window. The advantages of placing the commands in a
script go far beyond not having to retype them time and again. The
script becomes a <em>program</em> -- a <em>tool</em> -- and it can easily be modified
or customized for a particular application.</p>
<p><strong>Example 2-2. *cleanup*: An improved clean-up script</strong></p>
<pre class="literal-block">
#!/bin/bash
# Proper header for a Bash script.

# Cleanup, version 2

# Run as root, of course.
# Insert code here to print error message and exit if not root.

LOG_DIR=/var/log
# Variables are better than hard-coded values.
cd $LOG_DIR

cat /dev/null &gt; messages
cat /dev/null &gt; wtmp


echo &quot;Logs cleaned up.&quot;

exit #  The right and proper method of &quot;exiting&quot; from a script.
     #  A bare &quot;exit&quot; (no parameter) returns the exit status
     #+ of the preceding command.
</pre>
<p>Now <em>that's</em> beginning to look like a real script. But we can go even
farther . . .</p>
<p><strong>Example 2-3. *cleanup*: An enhanced and generalized version of above
scripts.</strong></p>
<pre class="literal-block">
#!/bin/bash
# Cleanup, version 3

#  Warning:
#  -------
#  This script uses quite a number of features that will be explained
#+ later on.
#  By the time you've finished the first half of the book,
#+ there should be nothing mysterious about it.



LOG_DIR=/var/log
ROOT_UID=0     # Only users with $UID 0 have root privileges.
LINES=50       # Default number of lines saved.
E_XCD=86       # Can't change directory?
E_NOTROOT=87   # Non-root exit error.


# Run as root, of course.
if [ &quot;$UID&quot; -ne &quot;$ROOT_UID&quot; ]
then
  echo &quot;Must be root to run this script.&quot;
  exit $E_NOTROOT
fi

if [ -n &quot;$1&quot; ]
# Test whether command-line argument is present (non-empty).
then
  lines=$1
else
  lines=$LINES # Default, if not specified on command-line.
fi


#  Stephane Chazelas suggests the following,
#+ as a better way of checking command-line arguments,
#+ but this is still a bit advanced for this stage of the tutorial.
#
#    E_WRONGARGS=85  # Non-numerical argument (bad argument format).
#
#    case &quot;$1&quot; in
#    &quot;&quot;      ) lines=50;;
#    *[!0-9]*) echo &quot;Usage: `basename $0` file-to-cleanup&quot;; exit $E_WRONGARGS;;
#    *       ) lines=$1;;
#    esac
#
#* Skip ahead to &quot;Loops&quot; chapter to decipher all this.


cd $LOG_DIR

if [ `pwd` != &quot;$LOG_DIR&quot; ]  # or   if [ &quot;$PWD&quot; != &quot;$LOG_DIR&quot; ]
                            # Not in /var/log?
then
  echo &quot;Can't change to $LOG_DIR.&quot;
  exit $E_XCD
fi  # Doublecheck if in right directory before messing with log file.

# Far more efficient is:
#
# cd /var/log || {
#   echo &quot;Cannot change to necessary directory.&quot; &gt;&amp;2
#   exit $E_XCD;
# }




tail -n $lines messages &gt; mesg.temp # Save last section of message log file.
mv mesg.temp messages               # Rename it as system log file.


#  cat /dev/null &gt; messages
#* No longer needed, as the above method is safer.

cat /dev/null &gt; wtmp  #  ': &gt; wtmp' and '&gt; wtmp'  have the same effect.
echo &quot;Log files cleaned up.&quot;
#  Note that there are other log files in /var/log not affected
#+ by this script.

exit 0
#  A zero return value from the script upon exit indicates success
#+ to the shell.
</pre>
<p>Since you may not wish to wipe out the entire system log, this version
of the script keeps the last section of the message log intact. You will
constantly discover ways of fine-tuning previously written scripts for
increased effectiveness.</p>
<p>* * *</p>
<p>The <em>sha-bang</em> ( #!) <a class="reference external" href="sha-bang.html#FTN.AEN201">[1]</a> at the head of a
script tells your system that this file is a set of commands to be fed
to the command interpreter indicated. The #! is actually a two-byte
<a class="reference external" href="sha-bang.html#FTN.AEN210">[2]</a> <em>magic number</em>, a special marker that
designates a file type, or in this case an executable shell script (type
<tt class="docutils literal">man magic</tt> for more details on this fascinating topic). Immediately
following the <em>sha-bang</em> is a <em>path name</em>. This is the path to the
program that interprets the commands in the script, whether it be a
shell, a programming language, or a utility. This command interpreter
then executes the commands in the script, starting at the top (the line
following the <em>sha-bang</em> line), and ignoring comments.
<a class="reference external" href="sha-bang.html#FTN.AEN222">[3]</a></p>
<pre class="literal-block">
#!/bin/sh
#!/bin/bash
#!/usr/bin/perl
#!/usr/bin/tcl
#!/bin/sed -f
#!/bin/awk -f
</pre>
<p>Each of the above script header lines calls a different command
interpreter, be it <tt class="docutils literal">/bin/sh</tt>, the default shell (<strong>bash</strong> in a Linux
system) or otherwise. <a class="reference external" href="sha-bang.html#FTN.AEN238">[4]</a> Using
<tt class="docutils literal"><span class="pre">#!/bin/sh</span></tt>, the default Bourne shell in most commercial variants of
UNIX, makes the script <a class="reference external" href="portabilityissues.html">portable</a> to non-Linux
machines, though you <a class="reference external" href="gotchas.html#BINSH">sacrifice Bash-specific
features</a>. The script will, however, conform to
the POSIX <a class="reference external" href="sha-bang.html#FTN.AEN252">[5]</a> <strong>sh</strong> standard.</p>
<p>Note that the path given at the &quot;sha-bang&quot; must be correct, otherwise an
error message -- usually &quot;Command not found.&quot; -- will be the only result
of running the script. <a class="reference external" href="sha-bang.html#FTN.AEN265">[6]</a></p>
<p>#! can be omitted if the script consists only of a set of generic system
commands, using no internal shell directives. The second example, above,
requires the initial #!, since the variable assignment line,
<tt class="docutils literal">lines=50</tt>, uses a shell-specific construct.
<a class="reference external" href="sha-bang.html#FTN.AEN275">[7]</a> Note again that <tt class="docutils literal"><span class="pre">#!/bin/sh</span></tt> invokes
the default shell interpreter, which defaults to <tt class="docutils literal">/bin/bash</tt> on a
Linux machine.</p>
<div class="figure align-center">
<img alt="Tip" src="http://tldp.org/LDP/abs/images/tip.gif" />
<p class="caption">Tip</p>
</div>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/sha-bang.ca.rst</tt>, line 221)</p>
Explicit markup ends without a blank line; unexpected unindent.</div>
<p>This tutorial encourages a modular approach to constructing a script.
Make note of and collect &quot;boilerplate&quot; code snippets that might be
useful in future scripts. Eventually you will build quite an extensive
library of nifty routines. As an example, the following script prolog
tests whether the script has been invoked with the correct number of
parameters.</p>
<pre class="literal-block">
E_WRONG_ARGS=85
script_parameters=&quot;-a -h -m -z&quot;
#                  -a = all, -h = help, etc.

if [ $# -ne $Number_of_expected_args ]
then
  echo &quot;Usage: `basename $0` $script_parameters&quot;
  # `basename $0` is the script's filename.
  exit $E_WRONG_ARGS
fi
</pre>
<p>Many times, you will write a script that carries out one particular
task. The first script in this chapter is an example. Later, it might
occur to you to generalize the script to do other, similar tasks.
Replacing the literal (&quot;hard-wired&quot;) constants by variables is a step in
that direction, as is replacing repetitive code blocks by
<a class="reference external" href="functions.html#FUNCTIONREF">functions</a>.</p>
<div class="section" id="notes">
<h2>Notes</h2>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/sha-bang.ca.rst</tt>, line 10); <em><a href="#id10">backlink</a></em></p>
Duplicate explicit target name: &quot;[1]&quot;.</div>
<p><a class="reference external" href="sha-bang.html#AEN201">[1]</a></p>
<p>More commonly seen in the literature as <em>she-bang</em> or <em>sh-bang</em>. This
derives from the concatenation of the tokens <em>sharp</em> (#) and <em>bang</em> (!).</p>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/sha-bang.ca.rst</tt>, line 10); <em><a href="#id11">backlink</a></em></p>
Duplicate explicit target name: &quot;[2]&quot;.</div>
<p><a class="reference external" href="sha-bang.html#AEN210">[2]</a></p>
<p>Some flavors of UNIX (those based on 4.2 BSD) allegedly take a four-byte
magic number, requiring a blank after the ! -- <tt class="docutils literal">#! /bin/sh</tt>.
<a class="reference external" href="http://www.in-ulm.de/~mascheck/various/shebang/#details">According to Sven
Mascheck</a>
this is probably a myth.</p>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/sha-bang.ca.rst</tt>, line 10); <em><a href="#id12">backlink</a></em></p>
Duplicate explicit target name: &quot;[3]&quot;.</div>
<p><a class="reference external" href="sha-bang.html#AEN222">[3]</a></p>
<p>The #! line in a shell script will be the first thing the command
interpreter (<strong>sh</strong> or <strong>bash</strong>) sees. Since this line begins with a #,
it will be correctly interpreted as a comment when the command
interpreter finally executes the script. The line has already served its
purpose - calling the command interpreter.</p>
<p>If, in fact, the script includes an <em>extra</em> #! line, then <strong>bash</strong> will
interpret it as a comment.</p>
<pre class="literal-block">
#!/bin/bash

echo &quot;Part 1 of script.&quot;
a=1

#!/bin/bash
# This does *not* launch a new script.

echo &quot;Part 2 of script.&quot;
echo $a  # Value of $a stays at 1.
</pre>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/sha-bang.ca.rst</tt>, line 10); <em><a href="#id13">backlink</a></em></p>
Duplicate explicit target name: &quot;[4]&quot;.</div>
<p><a class="reference external" href="sha-bang.html#AEN238">[4]</a></p>
<p>This allows some cute tricks.</p>
<pre class="literal-block">
#!/bin/rm
# Self-deleting script.

# Nothing much seems to happen when you run this... except that the file disappears.

WHATEVER=85

echo &quot;This line will never print (betcha!).&quot;

exit $WHATEVER  # Doesn't matter. The script will not exit here.
                # Try an echo $? after script termination.
                # You'll get a 0, not a 85.
</pre>
<p>Also, try starting a <tt class="docutils literal">README</tt> file with a <tt class="docutils literal"><span class="pre">#!/bin/more</span></tt>, and making
it executable. The result is a self-listing documentation file. (A <a class="reference external" href="here-docs.html#HEREDOCREF">here
document</a> using <a class="reference external" href="basic.html#CATREF">cat</a>
is possibly a better alternative -- see <a class="reference external" href="here-docs.html#EX71">Example
19-3</a>).</p>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/sha-bang.ca.rst</tt>, line 10); <em><a href="#id14">backlink</a></em></p>
Duplicate explicit target name: &quot;[5]&quot;.</div>
<p><a class="reference external" href="sha-bang.html#AEN252">[5]</a></p>
<p><strong>P**ortable **O**perating **S**ystem *I*nterface, an attempt to
standardize UNI**X</strong>-like OSes. The POSIX specifications are listed on
the <a class="reference external" href="http://www.opengroup.org/onlinepubs/007904975/toc.htm">Open Group
site</a>.</p>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/sha-bang.ca.rst</tt>, line 10); <em><a href="#id15">backlink</a></em></p>
Duplicate explicit target name: &quot;[6]&quot;.</div>
<p><a class="reference external" href="sha-bang.html#AEN265">[6]</a></p>
<p>To avoid this possibility, a script may begin with a <a class="reference external" href="system.html#ENVV2REF">#!/bin/env
bash</a> <em>sha-bang</em> line. This may be useful on
UNIX machines where <em>bash</em> is not located in <tt class="docutils literal">/bin</tt></p>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">rst-ca/sha-bang.ca.rst</tt>, line 10); <em><a href="#id16">backlink</a></em></p>
Duplicate explicit target name: &quot;[7]&quot;.</div>
<p><a class="reference external" href="sha-bang.html#AEN275">[7]</a></p>
<p>If <em>Bash</em> is your default shell, then the #! isn't necessary at the
beginning of a script. However, if launching a script from a different
shell, such as <em>tcsh</em>, then you <em>will</em> need the #!.</p>
<hr class="docutils" />
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="30%" />
<col width="34%" />
</colgroup>
<tbody valign="top">
<tr><td><a class="reference external" href="why-shell.html">Prev</a></td>
<td><a class="reference external" href="index.html">Home</a></td>
<td><a class="reference external" href="invoking.html">Next</a></td>
</tr>
<tr><td>Shell Programming!</td>
<td><a class="reference external" href="part1.html">Up</a></td>
<td>Invoking the script</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</body>
</html>
